<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>Docker总结 | gy的小站</title>

  <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://cdn.jsdelivr.net/gh/inkss/fontawesome@5.15.3/css/all.min.css" rel="stylesheet">
  <link href="/js/swiper/swiper@5.4.1.min.css" rel="stylesheet">
  
  
    <script>
        var themeModelId = '';
        if (themeModelId) {
            localStorage.setItem('modelId', themeModelId);
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/gh/yuang01/live2d-widget@latest/autoload.js"></script>
    <script>
        var live2dOpen = eval('true') || false;
        if (!live2dOpen) {
            localStorage.setItem('waifu-display', 1609323474481);
        }
    </script>
  
  
  
<link rel="stylesheet" href="/css/animate.min.css">

  
<link rel="stylesheet" href="/css/style.css">

  
  
    
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    

    <!-- import link -->
    
        
            
        
            
        
    
    <!-- import script -->
    
        
            
        
            
        
    

<meta name="generator" content="Hexo 5.4.2"></head>

  
  <!-- 依赖于jquery和vue -->
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

  

  
    
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js"></script>

  
  
  <body>
    <!-- 预加载动画 -->
    <!-- 页面预加载动画 -->

<div id='loader'>
  <link rel="stylesheet" href="/js/loaded/index.css" >
  <div class="loading-left-bg"></div>
  <div class="loading-right-bg"></div>
  <div class="spinner-box">
    <div class="configure-border-1">
      <div class="configure-core"></div>
    </div>
    <div class="configure-border-2">
      <div class="configure-core"></div>
    </div>
    <div class="loading-word">加载中...</div>
  </div>
</div>

<script>
  var endLoading = function () {
    document.body.style.overflow = 'auto';
    document.getElementById('loader').classList.add("loading");
  }
  window.addEventListener('DOMContentLoaded',endLoading);
  
</script>

    
    <!-- 判断是否为暗黑风格 -->
    <!-- 判断是否为黑夜模式 -->
<script>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- 需要在上面加载的js -->
    <script>
  function loadScript(src, cb) {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }

  //https://github.com/filamentgroup/loadCSS
  var loadCSS = function (href, before, media, attributes) {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  };

</script> 

<!-- 轮播图所需要的js -->
<script src="/js/swiper/swiper.min.js"></script>
<script src="/js/swiper/vue-awesome-swiper.js"></script>
<script src="/js/swiper/swiper.animate1.0.3.min.js"></script>

<script type="text/javascript">
  Vue.use(window.VueAwesomeSwiper)
</script>


  <script src="/js/vue-typed-js/index.js"></script>


<!-- 首页的公告滚动插件的js需要重新加载 -->
<script src="/js/vue-seamless-scroll/index.js"></script>

<!-- 打字机效果js -->
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>


    <div id="safearea">
      <main class="main" id="pjax-container">
        <!-- 头部导航 -->
        
<header class="header   " 
  id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fas fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo lazyload placeholder" src="/medias/logo.png" class="lazyload placeholder" data-srcset="/medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
      <h3 class="drawer-box-head_title">gy的小站</h3>
      <h5 class="drawer-box-head_desc">滴水穿石不是水的力量,而是坚持的力量</h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/" class="drawer-menu-item-link">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">首页</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/archives" class="drawer-menu-item-link">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/tags" class="drawer-menu-item-link">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">标签</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/categories" class="drawer-menu-item-link">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">分类</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/about" class="drawer-menu-item-link">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">关于</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/friends" class="drawer-menu-item-link">
                  
                  <span class="name">友情链接</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="javascript:;" class="drawer-menu-item-link has-children" @click="openOrCloseMenu(6)">
                  <span>
                    
                      <i class="fas fa-link"></i>
                    
                    <span class="name">更多</span>
                  </span>
                  <i class="fas fa-chevron-left arrow " :class="{'icon-rotate': isOpen(6)}" aria-hidden="true"></i>
                </a>
                <ul class="drawer-sub-menu" v-if="isOpen(6)">
                  
                  <li>
                    <a href="/gallery">
                      
                      <i class="fas fa-music" style="margin-top: -20px;"></i>
                      
                      <span>工大风光</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/huoban">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>资源推荐</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>考研与就业</span>
                    </a>
                  </li>
                  
                  <li>
                    <a target="_blank" rel="noopener" href="http://baidu.com">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>百度</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
        
          <li class="drawer-box-content_item">
            <a target="_blank" rel="noopener" href="https://github.com/gaoyangya">
              <i class="fas fa-github" aria-hidden="true"></i>
              <span>Github</span>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="/medias/logo.png" class="lazyload placeholder" data-srcset="/medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
        </div>
      
      <a href="/" class="logo">gy的小站</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/" class="menu-item-link" title="首页">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">首页</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/archives" class="menu-item-link" title="归档">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/tags" class="menu-item-link" title="标签">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">标签</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/categories" class="menu-item-link" title="分类">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">分类</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/about" class="menu-item-link" title="关于">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">关于</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/friends" class="menu-item-link" title="友情链接">
                  
                  <span class="name">友情链接</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="javascript:;" class="menu-item-link" title="更多">
                  
                    <i class="fas fa-link"></i>
                  
                  <span class="name">更多</span>
                  <i class="fas fa-chevron-down arrow" aria-hidden="true"></i>
                </a>
                <ul class="sub-menu">
                  
                  <li>
                    <a href="/gallery">
                      
                      <i class="fas fa-music" style="margin-top: -20px;"></i>
                      
                      <span>工大风光</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/huoban">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>资源推荐</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>考研与就业</span>
                    </a>
                  </li>
                  
                  <li>
                    <a target="_blank" rel="noopener" href="http://baidu.com">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>百度</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fas fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <h2>
          <span>
            <i class="fas fa-search" aria-hidden="true"></i>
            <span class="title">本地搜索</span>
          </span>
          <i class="fas fa-times close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="请输入关键字"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="/js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
      window.addEventListener('pjax:complete', () => {
        this.cancelDialogVisible();
      })
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- 解决刷新页面闪烁问题，可以在元素上添加display: none, 或者用vue.extend方法，详情：https://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- 下面是搜索基本写法 -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
    <a target="_blank" rel="noopener" href="https://github.com/gaoyangya" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
  
    <div id="he-plugin-simple"></div>
    <script>
      WIDGET = {
        CONFIG: {
          "modules": "012",
          "background": 5,
          "tmpColor": "4A4A4A",
          "tmpSize": 16,
          "cityColor": "4A4A4A",
          "citySize": 16,
          "aqiSize": 16,
          "weatherIconSize": 24,
          "alertIconSize": 18,
          "padding": "10px 10px 10px 10px",
          "shadow": "1",
          "language": "auto",
          "borderRadius": 5,
          "fixed": "false",
          "vertical": "middle",
          "horizontal": "center",
          "key": "2784dd3fcb1e4f0f9a9b579bf69641f2"
        }
      }
    </script>
    <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script> 
    
</header>
        <!-- 内容区域 -->
        
 <!-- prismjs 代码高亮 -->
 
    
    <link href="/js/prism/prism-line-numbers.css" rel="stylesheet">
    
        <link href="/js/prism/prism.min.css" rel="stylesheet">
    

    <style>
        pre[class*="language-"] {
            overflow-y: hidden;
        }
        .line-numbers .line-numbers-rows {
            border: none;
        }
    </style>
  


<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>


  <!-- 文章详情页顶部图片和标题 -->




<div class="post-detail-header" id="thumbnail_canvas" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;background-image:url('/medias/4.jpg')">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        Docker总结
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fas fa-calendar"></i> 发表于：2020-08-23 |
        </span>
      

      
        <span class="post-detail-header_categories">
          <i class="iconfont iconbookmark1"></i> 分类：
          
            <a href="/categories/Docker/" class="post-detail-header_category">
              Docker
            </a>
          
        </span>
      

      
    
  </div>
  
  
    <script src="/js/bubble/bubble.js"></script>
  
</div>





<div class="row justify-position" 
  style="padding-top: 0px;">
  <div class="main-content">
    <article class="post post-detail">
      <div class="post-content">
        <h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><ul>
<li><p>官方文档地址:<a target="_blank" rel="noopener" href="https://www.docker.com/get-started">https://www.docker.com/get-started</a></p>
</li>
<li><p>中文参考手册:<a target="_blank" rel="noopener" href="https://docker_practice.gitee.io/zh-cn/">https://docker_practice.gitee.io/zh-cn/</a></p>
</li>
</ul>
<hr>
<h2 id="1-什么是-Docker"><a href="#1-什么是-Docker" class="headerlink" title="1.什么是 Docker"></a>1.什么是 Docker</h2><h3 id="1-1-官方定义"><a href="#1-1-官方定义" class="headerlink" title="1.1 官方定义"></a>1.1 官方定义</h3><ul>
<li>最新官网首页</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231423724.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231423724.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20201220213306128"></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231423982.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231423982.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20201220214210994"></p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>官方介绍
<span class="token operator">-</span> We have a complete container solution <span class="token keyword">for</span> you <span class="token operator">-</span> no matter who you are <span class="token operator">and</span> <span class="token keyword">where</span> you are on your containerization journey<span class="token punctuation">.</span>
<span class="token operator">-</span> 翻译<span class="token operator">:</span> 我们为你提供了一个完整的容器解决方案<span class="token punctuation">,</span>不管你是谁<span class="token punctuation">,</span>不管你在哪<span class="token punctuation">,</span>你都可以开始容器的的旅程。
<span class="token operator">-</span> 官方定义<span class="token operator">:</span> docker是一个容器技术。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-2-Docker的起源"><a href="#1-2-Docker的起源" class="headerlink" title="1.2 Docker的起源"></a>1.2 Docker的起源</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">Docker 最初是 dotCloud 公司创始人 Solomon Hykes 在法国期间发起的一个公司内部项目，它是基于 dotCloud 公司多年云服务技术的一次革新，并于 <span class="token number">2013</span> 年 <span class="token number">3</span> 月以 Apache <span class="token number">2.0</span> 授权协议开源，主要项目代码在 GitHub 上进行维护。Docker 项目后来还加入了 Linux 基金会，并成立推动 开放容器联盟（OCI）。

Docker 自开源后受到广泛的关注和讨论，至今其 GitHub 项目 已经超过 <span class="token number">5</span> 万 <span class="token number">7</span> 千个星标和一万多个 fork。甚至由于 Docker 项目的火爆，在 <span class="token number">2013</span> 年底，dotCloud 公司决定改名为 Docker。Docker 最初是在 Ubuntu <span class="token number">12.04</span> 上开发实现的；Red Hat 则从 RHEL <span class="token number">6.5</span> 开始对 Docker 进行支持；Google 也在其 PaaS 产品中广泛应用 Docker。

Docker 使用 Google 公司推出的 Go 语言 进行开发实现，基于 Linux 内核的 cgroup，namespace，以及 OverlayFS 类的 Union FS 等技术，对进程进行封装隔离，属于操作系统层面的虚拟化技术。由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-为什么是Docker"><a href="#2-为什么是Docker" class="headerlink" title="2.为什么是Docker"></a>2.为什么是Docker</h2><ul>
<li><p><code>在开发的时候，在本机测试环境可以跑，生产环境跑不起来</code></p>
<p>这里我们拿java Web应用程序举例，我们一个java Web应用程序涉及很多东西，比如jdk、tomcat、mysql等软件环境。当这些其中某一项版本不一致的时候，可能就会导致应用程序跑不起来这种情况。Docker则将程序以及使用软件环境直接打包在一起，无论在那个机器上保证了环境一致。</p>
<p><strong>优势1:  一致的运行环境,更轻松的迁移</strong></p>
</li>
<li><p><code>服务器自己的程序挂了，结果发现是别人程序出了问题把内存吃完了，自己程序因为内存不够就挂了</code></p>
<p>这种也是一种比较常见的情况，如果你的程序重要性不是特别高的话，公司基本上不可能让你的程序独享一台服务器的，这时候你的服务器就会跟公司其他人的程序共享一台服务器，所以不可避免地就会受到其他程序的干扰，导致自己的程序出现问题。Docker就很好解决了环境隔离的问题，别人程序不会影响到自己的程序。</p>
<p><strong>优势2：对进程进行封装隔离,容器与容器之间互不影响,更高效的利用系统资源</strong></p>
</li>
<li><p><code>公司要弄一个活动，可能会有大量的流量进来，公司需要再多部署几十台服务器</code></p>
<p>在没有Docker的情况下，要在几天内部署几十台服务器，这对运维来说是一件非常折磨人的事，而且每台服务器的环境还不一定一样，就会出现各种问题，最后部署地头皮发麻。用Docker的话，我只需要将程序打包到镜像，你要多少台服务，我就给力跑多少容器，极大地提高了部署效率。</p>
<p><strong>优势3: 通过镜像复制N多个环境一致容器</strong></p>
</li>
</ul>
<hr>
<h2 id="3-Docker和虚拟机区别"><a href="#3-Docker和虚拟机区别" class="headerlink" title="3.Docker和虚拟机区别"></a>3.Docker和虚拟机区别</h2><blockquote>
<p>关于Docker与虚拟机的区别，我在网上找到的一张图，非常直观形象地展示出来，话不多说，直接上图。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424588.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424588.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20201220222456675"></p>
<p><code>比较上面两张图，我们发现虚拟机是携带操作系统，本身很小的应用程序却因为携带了操作系统而变得非常大，很笨重</code>。Docker是不携带操作系统的，所以Docker的应用就非常的轻巧。另外在调用宿主机的CPU、磁盘等等这些资源的时候，拿内存举例，虚拟机是利用Hypervisor去虚拟化内存，整个调用过程是虚拟内存-&gt;虚拟物理内存-&gt;真正物理内存，但是Docker是利用Docker Engine去调用宿主的的资源，这时候过程是虚拟内存-&gt;真正物理内存。</p>
<table>
<thead>
<tr>
<th></th>
<th>传统虚拟机</th>
<th>Docker容器</th>
</tr>
</thead>
<tbody><tr>
<td>磁盘占用</td>
<td>几个GB到几十个GB左右</td>
<td>几十MB到几百MB左右</td>
</tr>
<tr>
<td>CPU内存占用</td>
<td>虚拟操作系统非常占用CPU和内存</td>
<td>Docker引擎占用极低</td>
</tr>
<tr>
<td>启动速度</td>
<td>（从开机到运行项目）几分钟</td>
<td>（从开启容器到运行项目）几秒</td>
</tr>
<tr>
<td>安装管理</td>
<td>需要专门的运维技术</td>
<td>安装、管理方便</td>
</tr>
<tr>
<td>应用部署</td>
<td>每次部署都费时费力</td>
<td>从第二次部署开始轻松简捷</td>
</tr>
<tr>
<td>耦合性</td>
<td>多个应用服务安装到一起，容易互相影响</td>
<td>每个应用服务一个容器，达成隔离</td>
</tr>
<tr>
<td>系统依赖</td>
<td>无</td>
<td>需求相同或相似的内核，目前推荐是Linux</td>
</tr>
</tbody></table>
<hr>
<h2 id="4-Docker的安装"><a href="#4-Docker的安装" class="headerlink" title="4.Docker的安装"></a>4.Docker的安装</h2><h3 id="4-1-安装docker-centos7-x"><a href="#4-1-安装docker-centos7-x" class="headerlink" title="4.1 安装docker(centos7.x)"></a>4.1 安装docker(centos7.x)</h3><ul>
<li><p>卸载原始docker</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">$ sudo yum remove docker \
                  docker<span class="token operator">-</span>client \
                  docker<span class="token operator">-</span>client<span class="token operator">-</span>latest \
                  docker<span class="token operator">-</span>common \
                  docker<span class="token operator">-</span>latest \
                  docker<span class="token operator">-</span>latest<span class="token operator">-</span>logrotate \
                  docker<span class="token operator">-</span>logrotate \
                  docker<span class="token operator">-</span>engine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>安装docker依赖</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">$ sudo yum install <span class="token operator">-</span>y yum<span class="token operator">-</span>utils \
  device<span class="token operator">-</span>mapper<span class="token operator">-</span>persistent<span class="token operator">-</span><span class="token keyword">data</span> \
  lvm2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>设置docker的yum源</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">$ sudo yum<span class="token operator">-</span>config<span class="token operator">-</span>manager \
    <span class="token operator">--</span>add<span class="token operator">-</span>repo \
    https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com<span class="token operator">/</span>linux<span class="token operator">/</span>centos<span class="token operator">/</span>docker<span class="token operator">-</span>ce<span class="token punctuation">.</span>repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>安装最新版的docker</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">$ sudo yum install docker<span class="token operator">-</span>ce docker<span class="token operator">-</span>ce<span class="token operator">-</span>cli containerd<span class="token punctuation">.</span>io<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>指定版本安装docker</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">$ yum list docker<span class="token operator">-</span>ce <span class="token operator">--</span>showduplicates | sort <span class="token operator">-</span>r
$ sudo yum install docker<span class="token operator">-</span>ce<span class="token operator">-</span><span class="token operator">&lt;</span>VERSION_STRING<span class="token operator">></span> docker<span class="token operator">-</span>ce<span class="token operator">-</span>cli<span class="token operator">-</span><span class="token operator">&lt;</span>VERSION_STRING<span class="token operator">></span> containerd<span class="token punctuation">.</span>io
$ sudo yum install docker<span class="token operator">-</span>ce<span class="token operator">-</span><span class="token number">18.09</span><span class="token punctuation">.</span><span class="token number">5</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">.</span>el7 docker<span class="token operator">-</span>ce<span class="token operator">-</span>cli<span class="token operator">-</span><span class="token number">18.09</span><span class="token punctuation">.</span><span class="token number">5</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">.</span>el7 containerd<span class="token punctuation">.</span>io<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>启动docker</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">$ sudo systemctl enable docker
$ sudo systemctl start docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p> 关闭docker</p>
</li>
</ul>
  <pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">$ sudo systemctl stop docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><p>测试docker安装</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">$ sudo docker run hello<span class="token operator">-</span>world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h3 id="4-2-bash安装-通用所有平台-star"><a href="#4-2-bash安装-通用所有平台-star" class="headerlink" title="4.2 bash安装(通用所有平台):star:"></a>4.2 bash安装(通用所有平台):star:</h3><ul>
<li><p>在测试或开发环境中 Docker 官方为了简化安装流程，提供了一套便捷的安装脚本，CentOS/Ubuntu 系统上可以使用这套脚本安装，另外可以通过 <code>--mirror</code> 选项使用国内源进行安装：执行这个命令后，脚本就会自动的将一切准备工作做好，并且把 Docker 的稳定(stable)版本安装在系统中。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> -fsSL get.docker.com -o get-docker.sh
<span class="token function">sudo</span> <span class="token function">sh</span> get-docker.sh --mirror Aliyun<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>启动docker</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
<span class="token function">sudo</span> systemctl start <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>创建docker用户组</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">groupadd</span> <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>将当前用户加入docker组</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">usermod</span> -aG <span class="token function">docker</span> <span class="token environment constant">$USER</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>测试docker安装是否正确</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h2 id="5-Docker-的核心架构"><a href="#5-Docker-的核心架构" class="headerlink" title="5.Docker 的核心架构"></a>5.Docker 的核心架构</h2><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424449.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424449.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20200404111908085"></p>
<ul>
<li><code>镜像:</code> 一个镜像代表一个应用环境,他是一个只读的文件,如 mysql镜像,tomcat镜像,nginx镜像等</li>
<li><code>容器:</code> 镜像每次运行之后就是产生一个容器,就是正在运行的镜像,特点就是可读可写</li>
<li><code>仓库:</code>用来存放镜像的位置,类似于maven仓库,也是镜像下载和上传的位置</li>
<li><code>dockerFile:</code>docker生成镜像配置文件,用来书写自定义镜像的一些配置</li>
<li><code>tar:</code>一个对镜像打包的文件,日后可以还原成镜像</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424159.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424159.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908163746009"></p>
<h2 id="6-Docker-配置阿里镜像加速服务"><a href="#6-Docker-配置阿里镜像加速服务" class="headerlink" title="6. Docker 配置阿里镜像加速服务"></a>6. Docker 配置阿里镜像加速服务</h2><h3 id="6-1-docker-运行流程"><a href="#6-1-docker-运行流程" class="headerlink" title="6.1 docker 运行流程"></a>6.1 docker 运行流程</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424157.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424157.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20200404120356784"></p>
<h3 id="6-2-docker配置阿里云镜像加速"><a href="#6-2-docker配置阿里云镜像加速" class="headerlink" title="6.2 docker配置阿里云镜像加速"></a>6.2 docker配置阿里云镜像加速</h3><ul>
<li><code>访问阿里云登录自己账号查看docker镜像加速服务</code></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/docker
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'
&#123;
  "registry-mirrors": ["https://lz2nib3q.mirror.aliyuncs.com"]
&#125;
EOF</span>
<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>验证docker的镜像加速是否生效</code></li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker info</span>
		<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
    <span class="token number">127.0</span>.0.0/8
   Registry Mirrors:
    <span class="token string">'https://lz2nib3q.mirror.aliyuncs.com/'</span>
   Live Restore Enabled: <span class="token boolean">false</span>
   Product License: Community Engine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="7-Docker的入门应用"><a href="#7-Docker的入门应用" class="headerlink" title="7.Docker的入门应用"></a>7.Docker的入门应用</h2><h3 id="7-1-docker-的第一个程序"><a href="#7-1-docker-的第一个程序" class="headerlink" title="7.1 docker 的第一个程序"></a>7.1 docker 的第一个程序</h3><blockquote>
<p>docker  run hello-world</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424046.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424046.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908192330031"></p>
<hr>
<h2 id="8-常用命令"><a href="#8-常用命令" class="headerlink" title="8.常用命令"></a>8.常用命令</h2><h3 id="8-0-linux-screen"><a href="#8-0-linux-screen" class="headerlink" title="8.0 linux screen"></a>8.0 linux screen</h3><p>Linux screen命令用于多重视窗管理程序。</p>
<blockquote>
<p>screen命令可以解决当ssh连接断开时,正在运行的命令被终止的问题</p>
</blockquote>
<h4 id="1-新建会话"><a href="#1-新建会话" class="headerlink" title="1.新建会话"></a>1.新建会话</h4><p>screen  -S 会话名(有特殊字符全部会话名用引号包住)</p>
<h4 id="2-暂时离开会话"><a href="#2-暂时离开会话" class="headerlink" title="2.暂时离开会话"></a>2.暂时离开会话</h4><p>ctrl+A+D</p>
<h4 id="3-回到指定会话"><a href="#3-回到指定会话" class="headerlink" title="3.回到指定会话"></a>3.回到指定会话</h4><p>screen -r 会话名(要求同上)</p>
<h4 id="4-销毁会话-慎用"><a href="#4-销毁会话-慎用" class="headerlink" title="4.销毁会话(慎用)"></a>4.销毁会话(慎用)</h4><p>screen -X 会话名(要求同上)</p>
<h4 id="5-查询正在运行的会话"><a href="#5-查询正在运行的会话" class="headerlink" title="5.查询正在运行的会话"></a>5.查询正在运行的会话</h4><p>screen -ls</p>
<p>screen -list</p>
<h3 id="lsof-部分平台-部分命令可能不通用"><a href="#lsof-部分平台-部分命令可能不通用" class="headerlink" title="lsof(部分平台,部分命令可能不通用)"></a>lsof(部分平台,部分命令可能不通用)</h3><h3 id="systemd-老系统没有这个-systemctl-service"><a href="#systemd-老系统没有这个-systemctl-service" class="headerlink" title="systemd(老系统没有这个)            systemctl             service"></a>systemd(老系统没有这个)            systemctl             service</h3><h3 id="netplan-老系统没有"><a href="#netplan-老系统没有" class="headerlink" title="netplan(老系统没有)"></a>netplan(老系统没有)</h3><h3 id="8-1-辅助命令-amp-启动命令"><a href="#8-1-辅助命令-amp-启动命令" class="headerlink" title="8.1 辅助命令&amp;启动命令"></a>8.1 辅助命令&amp;启动命令</h3><h4 id="启动命令"><a href="#启动命令" class="headerlink" title="启动命令:"></a>启动命令:</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">sudo service docker start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="辅助命令"><a href="#辅助命令" class="headerlink" title="辅助命令:"></a>辅助命令:</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>安装完成辅助命令
		docker version	<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>	查看docker的信息
		docker info		<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>	查看更详细的信息
		docker <span class="token operator">--</span>help	<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>	帮助命令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424823.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424823.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908192357224" style="zoom:67%;" />

<hr>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424506.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424506.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908192457159" style="zoom:67%;" />

<h3 id="8-2-Images-镜像命令"><a href="#8-2-Images-镜像命令" class="headerlink" title="8.2 Images 镜像命令"></a>8.2 Images 镜像命令</h3><h4 id="1-查看本机中所有镜像"><a href="#1-查看本机中所有镜像" class="headerlink" title="1.查看本机中所有镜像"></a>1.查看本机中所有镜像</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker image ls     或者    docker images                列出本地所有镜像  
docker images <span class="token operator">-</span>q                                         只显示镜像id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424439.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424439.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908195452745"></strong></p>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424932.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231424932.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908193133736"></p>
<p><code>查询结果的名词解释:</code></p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
hello<span class="token operator">-</span>world   latest    feb5d9fea6a5   <span class="token number">11</span> months ago   <span class="token number">13</span><span class="token punctuation">.</span>3kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>REPOSITORY       镜像名称</p>
<p>TAG       镜像版本</p>
<p>IMAGE ID    docker为每一个镜像提供的唯一标识</p>
<p>CREATED     镜像创建时间(官方构建的时间,不是我们下载的时间)</p>
<p>SIZE         镜像大小</p>
<p><code>IMAGE ID有三十多位,只写前几位就ok了,比如说三位或者四位啊等等,只要能区分出来就好</code></p>
<blockquote>
<p>如何定位一个镜像</p>
</blockquote>
<p><code>镜像名称:tag </code>    或者   <code> 镜像id</code></p>
<p>eg:定位hello-world=====&gt;   hello-world:latest      或者    feb5d9fea6a5</p>
<h4 id="2-从仓库下载镜像"><a href="#2-从仓库下载镜像" class="headerlink" title="2.从仓库下载镜像"></a>2.从仓库下载镜像</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker pull 镜像名<span class="token operator">:</span>tag     或    docker pull 镜像id<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>如果没有tag版本号,默认为最新的版本</p>
</blockquote>
<p>也就是:<code>docker pull 镜像名</code>&lt;====&gt;<code>docker pull 镜像名:latest</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425726.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425726.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908195156620"></p>
<hr>
<blockquote>
<p>下载指定版本的,就得先去dockerhub查看版本,不能瞎下</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425406.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425406.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908200149992" style="zoom:80%;" />

<h4 id="3-搜索镜像"><a href="#3-搜索镜像" class="headerlink" title="3.搜索镜像"></a>3.搜索镜像</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker search  镜像名<span class="token operator">:</span>tag	 或  docker search 镜像id             	去dockerhub上查询当前镜像
docker search  镜像名<span class="token operator">:</span>tag <span class="token operator">--</span>no<span class="token operator">-</span>trunc   或 docker search 镜像id <span class="token operator">--</span>no<span class="token operator">-</span>trunc	 显示完整的镜像信息<span class="token punctuation">(</span>就是把描述DESCRIPTION展开<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>名词解释:</p>
<p>DESCRIPTION      描述</p>
<p>STARS                   网站上的标星数量</p>
<p> OFFICIAL            是否为官方的镜像</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425145.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425145.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908200519792" style="zoom:67%;" />

<hr>
<blockquote>
<p>但是不能看版本,要是想看版本的话还是要去网站看</p>
</blockquote>
<h4 id="4-删除镜像"><a href="#4-删除镜像" class="headerlink" title="4.删除镜像"></a>4.删除镜像</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker rmi 镜像名<span class="token operator">:</span>tag	 或 docker rmi 镜像id                        删除镜像
docker rmi 镜像名<span class="token operator">:</span>tag <span class="token operator">-</span>f	或 docker rmi 镜像id	                强制删除<span class="token punctuation">(</span>慎用<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425841.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425841.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908201357319"></p>
<blockquote>
<p>docler rmi 镜像名:tag       是正常删除,要求是 必须是没有运行过的镜像:star:</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425521.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425521.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908201914285"></p>
<blockquote>
<p>如果运行过就不能正常删除了,但是强制删除还是要慎用</p>
</blockquote>
<p>可以通过如下三步:</p>
<ol>
<li>停止实例</li>
<li>删除实例    docker rm 镜像名</li>
<li>删除镜像</li>
</ol>
<p>===========================================================</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker image rm <span class="token operator">-</span>f $<span class="token punctuation">(</span>docker images tomcat <span class="token operator">-</span>q<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>先执行这部分$(docker images tomcat -q),得到版本号</p>
<p>然后通过版本号删除镜像</p>
<p>============</p>
<h3 id="8-3-Contrainer-容器命令-star-star"><a href="#8-3-Contrainer-容器命令-star-star" class="headerlink" title="8.3 Contrainer 容器命令:star::star:"></a>8.3 Contrainer 容器命令:star::star:</h3><h4 id="1-查看docker引擎中的容器"><a href="#1-查看docker引擎中的容器" class="headerlink" title="1.查看docker引擎中的容器"></a>1.查看docker引擎中的容器</h4><blockquote>
<p>docker ps                      只能查看<code>正在运行</code>的容器</p>
<p>docker ps -a                 查看全部</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker ps				列出所有正在运行的容器
docker ps <span class="token operator">-</span>a			正在运行的和历史运行过的容器
docker ps <span class="token operator">-</span>q			静默模式，只显示容器编号<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425788.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425788.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908203759684"></p>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425273.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425273.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909103631100"></p>
<h4 id="2-运行容器"><a href="#2-运行容器" class="headerlink" title="2.运行容器"></a>2.运行容器</h4><blockquote>
<p>不能通过docker run,这样与外界无联系</p>
</blockquote>
<blockquote>
<p>docker run -p 宿主机端口号:容器端口号 镜像名:tag      或     docker run -p 宿主机端口号:容器端口号 镜像id</p>
</blockquote>
<p>docler  run -p  8080：8080 tomcat：8.0</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker run <span class="token operator">-</span>p 宿主机端口号<span class="token operator">:</span>容器端口号 镜像名<span class="token operator">:</span>tag	  或     docker run <span class="token operator">-</span>p 宿主机端口号<span class="token operator">:</span>容器端口号 镜像id
docker run 镜像名<span class="token operator">:</span>tag	     或           docker run 镜像id             	镜像名新建并启动容器
docker run 镜像名<span class="token operator">:</span>tag <span class="token operator">--</span>name 	或		docker run 镜像id <span class="token operator">--</span>name		   别名为容器起一个名字
docker run 镜像名<span class="token operator">:</span>tag <span class="token operator">-</span>d		或		docker run 镜像id <span class="token operator">-</span>d		      启动守护式容器（在后台启动容器）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>docker run 镜像名:tag          如果这个镜像没有下载,使用docker run 镜像名会先给你下载下来,然后再去运行 </p>
</blockquote>
<blockquote>
<p>不能通过docker run 镜像名:tag   去运行容器,这样的话与外界无交互:star::star::star:</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425889.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425889.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908220638284"></p>
<p><code>查询名词解释</code></p>
<p>CONTAINER ID           容器id</p>
<p>IMAGE                          当前容器基于那个容器运行的</p>
<p>COMMAND                  容器内启动该服务的命令</p>
<p>CREATED                      容器创建时间</p>
<p>STATUS                          容器状态</p>
<p>PORTS                           容器内服务监听的端口</p>
<p>NAMES                           容器的名称(默认会起名字)</p>
<p>========================================================</p>
<h4 id="3-docker运行tomcat-浏览器访问tomcat"><a href="#3-docker运行tomcat-浏览器访问tomcat" class="headerlink" title="3.docker运行tomcat,浏览器访问tomcat"></a>3.docker运行tomcat,浏览器访问tomcat</h4><h4 id="不能通过docker-run-镜像名-tag去运行容器的举例"><a href="#不能通过docker-run-镜像名-tag去运行容器的举例" class="headerlink" title="不能通过docker run 镜像名:tag去运行容器的举例"></a>不能通过docker run 镜像名:tag去运行容器的举例</h4><blockquote>
<p>tomcat镜像已经启动起来了</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425124.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425124.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908222444142"></p>
<blockquote>
<p>运行容器,同时设置容器与宿主机(安装docker的linux)端口的映射关系</p>
</blockquote>
<p>tomcat是运行在docker容器里面,而容器是操作系统层面的隔离,就相当于docker在这个基础之上,又给起了一个操作系统</p>
<p>也就是说,tomcat是跑在docker这个操作系统里,如下:</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425854.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425854.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908222828927"></p>
<p>而在浏览器的地址栏里输入<a target="_blank" rel="noopener" href="http://192.168.88.3:8080/,%E6%98%AF%E8%AE%BF%E9%97%AElinux%E7%9A%848080%E7%AB%AF%E5%8F%A3,%E5%A6%82%E4%B8%8B">http://192.168.88.3:8080/,是访问linux的8080端口,如下</a>:</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425146.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425146.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908223926278"></p>
<p>这台机器上没有8080端口,8080端口在docker里面</p>
<p>===&gt;<code>解决方法</code></p>
<p><code>把docker容器的8080端口映射到linux系统的8888端口</code></p>
<p><strong><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425549.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425549.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909094141535"></strong></p>
<blockquote>
<p>去浏览器查看</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425353.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425353.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909094241078"></p>
<hr>
<hr>
<h4 id="4停止-杀死-重启容器"><a href="#4停止-杀死-重启容器" class="headerlink" title="4停止|杀死|重启容器"></a>4停止|杀死|重启容器</h4><blockquote>
<p>镜像名字NAMES是指通过docker ps查出来的Names,而不是指’镜像:版本号’:star::star::star:</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker start   镜像名字NAMES或者容器id  <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> 开启容器
docker restart 镜像名NAMES或者容器id    <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> 重启容器
docker stop  镜像名NAMES或者容器id 	    <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 正常停止容器运行
docker kill  镜像名NAMES或者容器id      <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 立即停止容器运行
docker pause 镜像名NAMES或者容器id   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>暂停容器
docker unpause 镜像名NAMES或者容器id   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>恢复被暂停的容器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>正常停止容器运行</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425684.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425684.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909110153283"></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425428.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231425428.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909105616594"></p>
<blockquote>
<p>开启容器</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426292.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426292.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909104819663"></p>
<h4 id="5-停止容器-stop-与杀死容器-kill-与删除容器-rm-的区别"><a href="#5-停止容器-stop-与杀死容器-kill-与删除容器-rm-的区别" class="headerlink" title="5.停止容器(stop)与杀死容器(kill)与删除容器(rm)的区别"></a>5.停止容器(stop)与杀死容器(kill)与删除容器(rm)的区别</h4><ol>
<li><p>stop命令是用于停止容器的。</p>
<p>docker stop: 先发 SIGTERM 信号给容器，允许其在一定时间（默认 10s）内进行一些操作，若这段时间内容器未停止，则发送 SIGKILL 信号强行杀掉容器；</p>
</li>
<li><p>rm命令是删除指令，直接使用的话就是删除对应容器,再使用docker ps查的话就没有该容器了</p>
</li>
<li><p>kill命令是不给时间进行一些操作,直接杀死</p>
</li>
</ol>
<h4 id="6-删除容器"><a href="#6-删除容器" class="headerlink" title="6..删除容器"></a>6..删除容器</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker rm 容器id或容器名NAMES        <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>删除已经停止运行的容器
docker rm <span class="token operator">-</span>f 容器id或容器名NAMES     <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>强制删除<span class="token punctuation">(</span>即使在运行的容器也能删除<span class="token punctuation">)</span>
docker rm <span class="token operator">-</span>f $<span class="token punctuation">(</span>docker ps <span class="token operator">-</span>aq<span class="token punctuation">)</span>		<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>	删除所有容器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="7-查看容器的运行日志"><a href="#7-查看容器的运行日志" class="headerlink" title="7.查看容器的运行日志"></a>7.查看容器的运行日志</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker logs 容器id或容器名NAMES                  <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 查看容器日志
   docker logs <span class="token operator">-</span>t 容器id或容器名NAMES			  <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>加入时间戳
   docker logs <span class="token operator">-</span>f 容器id或容器名NAMES			  <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>跟随最新的日志打印
   docker logs <span class="token operator">--</span>tail 数字 容器id或容器名NAMES	     <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>显示最后多少条<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426004.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426004.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909113640034"></p>
<p>​    <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426458.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426458.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909113115759"></p>
<p>  <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426320.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426320.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909114014034"></p>
<h4 id="8-进入容器内部-star"><a href="#8-进入容器内部-star" class="headerlink" title="8.进入容器内部:star:"></a>8.进入容器内部:star:</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker exec  容器id或容器NAMES 容器内命令 <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 进入容器执行命令   #但是这个用不了
docker exec it 容器id或容器NAMES bash 	<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 进入容器执行命令 
exit                                     <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>退出容器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>-i        以交互模式运行容器，通常与-t一起使用<br>-t        分配一个伪终端    shell窗口   bash</p>
</blockquote>
<p><code>在linux系统里面安装了docker引擎,在docker引擎里面又安装了一个个的容器</code></p>
<p><code>这个容器和宿主机操作系统可以认为是两个独立的操作系统</code></p>
<p> <code>常用的命令如ls,rm是由宿主机的操作系统给的响应,那如果想进入tomcat01所在的操作系统(或者说所在的容器)</code>======exec命令</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426420.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426420.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909115609653"></p>
<p>============</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426477.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426477.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909123106297"></p>
<p>===========</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426345.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426345.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909120349800"></p>
<p>=============&gt;解释了一个问题:  <code>为什么直接安装tomcat就几十MB,而使用docker安装有几百MB那么大?</code></p>
<blockquote>
<p>因为docker创建出来的容器是一个操作系统,该操作系统只装了对应程序的镜像文件 :star::star::star:</p>
<p>或者说镜像分两部分:操作系统镜像＋对应程序的二进制文件</p>
<p>但是它不是一个完整的操作系统,只是有一个完整的操作系统的内核,docker实例与宿主机共用同一个内核:star::star::star:</p>
</blockquote>
<h4 id="9-容器和宿主机之间复制文件"><a href="#9-容器和宿主机之间复制文件" class="headerlink" title="9.容器和宿主机之间复制文件"></a>9.容器和宿主机之间复制文件</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker cp 文件|目录 容器id或容器NAMES<span class="token operator">:</span>复制到容器具体位置的路径<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>   将宿主机复制到容器内部     #在宿主机上操作
docker cp 容器id或容器NAMES<span class="token operator">:</span>容器内资源路径 宿主机目录路径     <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>   将容器内资源拷贝到宿主机上    #在宿主机上操作<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p><code>docker cp 容器id或容器NAMES:容器内资源路径 宿主机目录路径</code>  —————–   将容器内资源拷贝到宿主机上    </p>
<p>注意这个命 令是在宿主机上操作:star:</p>
</blockquote>
<p><code>拷贝文件</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426760.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426760.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909123539392"></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426632.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426632.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909123750360"></p>
<p><code>拷贝目录</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426509.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426509.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909124028561"></p>
<blockquote>
<p>docker cp 文件|目录 容器id或容器NAMES:复制到容器具体位置的路径—————–   将宿主机复制到容器内部     </p>
<p>注意在宿主机上操作:star:</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426150.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426150.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909124549957"></p>
<h4 id="10-查看容器内进程"><a href="#10-查看容器内进程" class="headerlink" title="10.查看容器内进程"></a>10.查看容器内进程</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker top 容器id或者容器名NAMES <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 查看容器内的进程<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>eg:查看tomcat容器内的进程</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426977.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426977.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909125827929"></p>
<h4 id="11-查看查看容器内部细节"><a href="#11-查看查看容器内部细节" class="headerlink" title="11. 查看查看容器内部细节"></a>11. 查看查看容器内部细节</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker inspect 容器id 		<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 查看容器内部细节<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426766.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426766.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909130534809" style="zoom:80%;" />

<p> 出来了好多好多内容</p>
<h4 id="12-容器数据卷机制-star"><a href="#12-容器数据卷机制-star" class="headerlink" title="12.容器数据卷机制:star:"></a>12.容器数据卷机制:star:</h4><blockquote>
<p>原先用cp命令在容器和宿主机之间复制文件,非常的麻烦</p>
<p>例如做项目部署的时候,有一个war包或者是jar包,要每一次把war包复制进tomcat容器的webapp里面,删掉旧的,才能让最新的生效=========&gt;数据卷横空出世</p>
</blockquote>
<p>数据卷: data volume</p>
<p>作用: 用来实现<code>容器中数据</code>和<code>宿主机中数据</code>进行<code>映射(同步)</code></p>
<p><font color=blue>数据卷使用必须在容器<code>首次</code>启动时设置</font> </p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token number">1</span><span class="token punctuation">.</span>使用绝对路径设置数据卷
	<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>docker run <span class="token operator">-</span>v 宿主机绝对路径<span class="token operator">:</span>容器内路径 镜像名<span class="token operator">:</span>tag或镜像id
       注意<span class="token operator">:</span>这种方法会将容器路径的原始内容全部清空<span class="token punctuation">,</span>始终以宿主机路径为主
    <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>docker run <span class="token operator">-</span>v 宿主机绝对路径<span class="token operator">:</span>容器内路径 ro 镜像名<span class="token operator">:</span>tag或镜像id
	   如果在设置数据卷时指定<span class="token function">ro</span><span class="token punctuation">(</span>read only<span class="token punctuation">)</span><span class="token punctuation">,</span>代表日后容器内路径是只读的
	   这样宿主机改变会影响容器<span class="token punctuation">,</span>反之不会
 <span class="token number">2</span><span class="token punctuation">.</span>使用别名方式设置数据卷
     docker run <span class="token operator">-</span>v aa<span class="token operator">:</span>容器内路径 镜像名<span class="token operator">:</span>tag或镜像id
        aa代表docker数据卷的别名    注<span class="token operator">:</span>这个别名如果存在docker中<span class="token punctuation">,</span>直接使用<span class="token punctuation">;</span>aa不存在自动创建
	    使用别名方式保留容器路径原始内容<span class="token punctuation">,</span>前提别名对应路径不能存在内容
		根据别名创建目录在哪<span class="token operator">:</span>默认在 <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>docker<span class="token operator">/</span>volumes<span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="使用绝对路径设置数据卷"><a href="#使用绝对路径设置数据卷" class="headerlink" title="使用绝对路径设置数据卷"></a>使用绝对路径设置数据卷</h5><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426070.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426070.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909132132532" style="zoom:80%;" />如果使用<code>绝对路径</code>把apps和webapps做一个映射,使用数据卷机制,webapps文件内的内容会被清空,apps内的内容会被复制过来</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426115.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426115.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909142011486"></p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8081</span><span class="token operator">:</span><span class="token number">8080</span> <span class="token operator">--</span>name tomcat01 <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>apps<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>tomcat<span class="token operator">/</span>webapps tomcat<span class="token operator">:</span><span class="token number">8.0</span>
根本<span class="token operator">:</span> docker run tomcat<span class="token operator">:</span><span class="token number">8.0</span>  运行容器
	 后台启动<span class="token operator">:</span>    docker run <span class="token operator">-</span>d tomcat<span class="token operator">:</span><span class="token number">8.0</span>
	 端口映射<span class="token operator">:</span>	  docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8081</span><span class="token operator">:</span><span class="token number">8080</span> tomcat<span class="token operator">:</span><span class="token number">8.0</span>
	 起名<span class="token operator">:</span>	   docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8081</span><span class="token operator">:</span><span class="token number">8080</span> <span class="token operator">--</span>name tomcat01 tomcat<span class="token operator">:</span><span class="token number">8.0</span> 
	 数据卷机制<span class="token operator">:</span>  docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8081</span><span class="token operator">:</span><span class="token number">8080</span> <span class="token operator">--</span>name tomcat01 <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>apps<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>tomcat<span class="token operator">/</span>webapps tomcat<span class="token operator">:</span><span class="token number">8.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>数据卷启动以后,容器的变化会影响宿主机 ,反之亦然,除非加上ro</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426511.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231426511.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909154041833"></p>
<hr>
<hr>
<p><code>所以以后利用数据卷,只需要把war包放到linux的某一位置即可,数据卷会自动同步</code></p>
<h5 id="使用别名方式设置数据卷"><a href="#使用别名方式设置数据卷" class="headerlink" title="使用别名方式设置数据卷"></a>使用别名方式设置数据卷</h5><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427295.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427295.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909155952474"></p>
<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427818.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427818.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909160906194"></p>
<h5 id="数据卷应用场景-star-star"><a href="#数据卷应用场景-star-star" class="headerlink" title="数据卷应用场景:star::star:"></a>数据卷应用场景:star::star:</h5><blockquote>
<p>日后运行的服务,自身要是持有数据的话,都要用到数据卷</p>
<p>换句话说,所用到的服务只要存储数据,都要用到数据卷,比如redis,tomcat,mysql,es</p>
</blockquote>
<p>eg:mysql是一个数据库,如果直接以一个容器的方式运行,没有数据卷,那么数据放到哪?????==&gt;数据被容器内存储</p>
<p>mysql存储的数据可是很重要的,如果有一天不小心把容器给删除了,数据就没了</p>
<p>但是如果用数据卷做了映射,就是不小心销毁了容器,也可以再映射回来</p>
<h4 id="13-将容器打包成一个新的镜像-star"><a href="#13-将容器打包成一个新的镜像-star" class="headerlink" title="13.将容器打包成一个新的镜像:star:"></a>13.将容器打包成一个新的镜像:star:</h4><h5 id="为什么要将容器打包成一个新的镜像"><a href="#为什么要将容器打包成一个新的镜像" class="headerlink" title="为什么要将容器打包成一个新的镜像"></a>为什么要将容器打包成一个新的镜像</h5><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427495.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427495.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909162554821"></p>
<p><code>镜像与容器是一对多的关系,镜像每运行一次就会形成一个新的容器</code></p>
<hr>
<hr>
<p>举例</p>
<p>日后运行tomcat,要把自己导的war包放进去才可以,但如果换台电脑或者说别人从github上下载下来,还需要把上图的过程重新再来一遍,很是麻烦=========&gt;</p>
<blockquote>
<p><code>把正在用的容器(已经导进去需要的数据等等)重新打包成一个镜像,下次直接下载镜像run就ok了,不需要重新向容器导入数据了</code></p>
</blockquote>
<blockquote>
<p>把容器打包成一个镜像的原因:<code>容器可读可写,基于这个特性,我们可以对容器进行自己的深度定制</code></p>
</blockquote>
<h5 id="如何将容-器打包成一个镜像"><a href="#如何将容-器打包成一个镜像" class="headerlink" title="如何将容 器打包成一个镜像"></a>如何将容 器打包成一个镜像</h5><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427151.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427151.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909163850968" style="zoom:80%;" />

<hr>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker commit <span class="token operator">-</span>m <span class="token string-literal singleline"><span class="token string">"描述信息"</span></span> <span class="token operator">-</span>a <span class="token string-literal singleline"><span class="token string">"作者信息"</span></span> 容器id或容器名称NAMES 打包的镜像名称<span class="token punctuation">(</span>自取<span class="token punctuation">)</span><span class="token operator">:</span>标签<span class="token punctuation">(</span>最好和原容器版本对应<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427197.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427197.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909164741486"></p>
<h4 id="14-镜像的备份和恢复"><a href="#14-镜像的备份和恢复" class="headerlink" title="14.镜像的备份和恢复"></a>14.镜像的备份和恢复</h4><blockquote>
<p>需求</p>
</blockquote>
<p>公司有一个镜像,不允许开源到github上,但是还想给其他人用</p>
<p> ====&gt;<code>docker提供了镜像备份和还原的机制</code></p>
<p>====&gt;<code>通过save指令将镜像打包成一个tar包;通过load指令将tar包还原成镜像</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427754.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427754.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909170906900"></p>
<hr>
<hr>
<h5 id="备份镜像-镜像-gt-tar包"><a href="#备份镜像-镜像-gt-tar包" class="headerlink" title="备份镜像(镜像-&gt;tar包)"></a>备份镜像(镜像-&gt;tar包)</h5><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker save 镜像名<span class="token operator">:</span>tag <span class="token operator">-</span>o  tar包存放的路径<span class="token operator">+</span>tar包名称<span class="token punctuation">.</span>tar
docker save 镜像名<span class="token operator">:</span>tag <span class="token operator">-</span>o  tar包名称<span class="token punctuation">.</span>tar
#不写存放路径默认存放到当前目录

#tar包名称<span class="token punctuation">.</span>tar  中的名称推荐使用 镜像名字<span class="token operator">:</span>tag 要不然恢复的时候不知道是干嘛的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427466.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427466.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909171519473"></p>
<h5 id="恢复镜像"><a href="#恢复镜像" class="headerlink" title="恢复镜像"></a>恢复镜像</h5><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker load <span class="token operator">-</span>i   名称<span class="token punctuation">.</span>tar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427530.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427530.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909171715710"></p>
<hr>
<h2 id="9-docker的镜像原理"><a href="#9-docker的镜像原理" class="headerlink" title="9.docker的镜像原理"></a>9.docker的镜像原理</h2><h3 id="9-1-镜像是什么？"><a href="#9-1-镜像是什么？" class="headerlink" title="9.1 镜像是什么？"></a>9.1 镜像是什么？</h3><blockquote>
<p>镜像是一种轻量级的，可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，<code>包括代码、运行时所需的库、环境变量和配置文件</code>。</p>
</blockquote>
<h3 id="9-2-为什么一个镜像会那么大？"><a href="#9-2-为什么一个镜像会那么大？" class="headerlink" title="9.2 为什么一个镜像会那么大？"></a>9.2 为什么一个镜像会那么大？</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427755.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427755.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20200404142950068"></p>
<p><code>镜像就是花卷</code></p>
<ul>
<li><p>UnionFS（联合文件系统）:</p>
<p>Union文件系统是一种分层，轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下。Union文件系统是Docker镜像的基础。这种文件系统特性:就是一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录 。    </p>
</li>
</ul>
<h3 id="9-3-Docker镜像原理"><a href="#9-3-Docker镜像原理" class="headerlink" title="9.3 Docker镜像原理"></a>9.3 Docker镜像原理</h3><blockquote>
<p><code>docker的镜像实际是由一层一层的文件系统组成。</code></p>
</blockquote>
<ul>
<li><p>bootfs（boot file system）主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统。在docker镜像的最底层就是bootfs。这一层与Linux/Unix 系统是一样的，包含boot加载器（bootloader）和内核（kernel）。当boot加载完,后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时会卸载bootfs。</p>
</li>
<li><p>rootfs（root file system），在bootfs之上，包含的就是典型的linux系统中的/dev，/proc，/bin，/etc等标准的目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu/CentOS等等。</p>
</li>
<li><p>我们平时安装进虚拟机的centos都有1到几个GB，为什么docker这里才200MB？对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令，工具，和程序库就可以了，因为底层直接使用Host的Kernal，自己只需要提供rootfs就行了。由此可见不同的linux发行版，他们的bootfs是一致的，rootfs会有差别。因此不同的发行版可以共用bootfs。</p>
</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427161.jpg" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427161.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<h3 id="9-4-为什么docker镜像要采用这种分层结构呢"><a href="#9-4-为什么docker镜像要采用这种分层结构呢" class="headerlink" title="9.4 为什么docker镜像要采用这种分层结构呢?"></a>9.4 为什么docker镜像要采用这种分层结构呢?</h3><blockquote>
<p><code>最大的一个好处就是资源共享</code></p>
</blockquote>
<ul>
<li>比如：有多个镜像都是从相同的base镜像构建而来的，那么宿主机只需在磁盘中保存一份base镜像。同时内存中也只需要加载一份base镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。Docker镜像都是只读的。当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称为容器层，容器层之下都叫镜像层。</li>
</ul>
<hr>
<h2 id="10-Docker安装常用服务"><a href="#10-Docker安装常用服务" class="headerlink" title="10.Docker安装常用服务"></a>10.Docker安装常用服务</h2><h3 id="10-1-安装mysql"><a href="#10-1-安装mysql" class="headerlink" title="10.1 安装mysql"></a>10.1 安装mysql</h3><h4 id="1-下载mysql"><a href="#1-下载mysql" class="headerlink" title="1.下载mysql"></a>1.下载mysql</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker pull mysql<span class="token operator">:</span><span class="token number">5.7</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427411.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427411.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909204326065"></p>
<h4 id="2-运行mysql"><a href="#2-运行mysql" class="headerlink" title="2.运行mysql"></a>2.运行mysql</h4><blockquote>
<p>开放端口映射</p>
</blockquote>
<p><code>因为linux里装了mysql了,所以在对docker端口映射的时候,宿主机的端口号就不能是3306了,要不然会冲突</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427878.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427878.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909213219786"></p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker run <span class="token operator">-</span>p <span class="token number">3307</span><span class="token operator">:</span><span class="token number">3306</span> mysql<span class="token operator">:</span><span class="token number">5.7</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427443.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427443.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909205059820"></p>
<p><code>启动的时候默认是root用户,但是没有密码啊,所以肯定启动会失败</code></p>
<p>看看报错信息:</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">You need <span class="token keyword">to</span> specify one of the following<span class="token operator">:</span>
    <span class="token operator">-</span> MYSQL_ROOT_PASSWORD                      <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 输入mysql的root对应密码
    <span class="token operator">-</span> MYSQL_ALLOW_EMPTY_PASSWORD               <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 允许root密码为空
    <span class="token operator">-</span> MYSQL_RANDOM_ROOT_PASSWORD               <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>允许随机生成root密码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>=========&gt;去dockerhub官网找到mysql:5.7看看官网的说明</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427366.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231427366.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909205659678" style="zoom:80%;" />

<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker run <span class="token operator">--</span>name mysql <span class="token operator">-</span>e MYSQL_ROOT_PASSWORD<span class="token operator">=</span><span class="token number">123456</span> <span class="token operator">-</span>p <span class="token number">3307</span><span class="token operator">:</span><span class="token number">3306</span> <span class="token operator">-</span>d  mysql<span class="token operator">:</span><span class="token number">5.7</span>
<span class="token operator">-</span>d 是后台运行<span class="token punctuation">,</span>别忘了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>密码是自己设的,和windows的保持一致吧,用123456</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428701.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428701.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909210352624"></p>
<blockquote>
<p>拓展一个参数(本次未使用)</p>
</blockquote>
 <pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token operator">--</span>restart<span class="token operator">=</span>always    总是随着docker引擎的重启而重启
docker run <span class="token operator">--</span>name mysql <span class="token operator">-</span>e MYSQL_ROOT_PASSWORD<span class="token operator">=</span><span class="token number">123456</span> <span class="token operator">-</span>p <span class="token number">3307</span><span class="token operator">:</span><span class="token number">3306</span> <span class="token operator">-</span>d <span class="token operator">--</span>restart<span class="token operator">=</span>always  mysql<span class="token operator">:</span><span class="token number">5.7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>进入mysql容器看看</p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428131.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428131.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909210659666" style="zoom:80%;" />

<h4 id="3-使用navicat连接mysql容器"><a href="#3-使用navicat连接mysql容器" class="headerlink" title="3.使用navicat连接mysql容器"></a>3.使用navicat连接mysql容器</h4><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428907.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428907.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909211750393" style="zoom: 67%;" />

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428878.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428878.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909211827577"></p>
<hr>
<h4 id="4-通过数据卷机制-把容器管理的数据交给宿主机"><a href="#4-通过数据卷机制-把容器管理的数据交给宿主机" class="headerlink" title="4.通过数据卷机制,把容器管理的数据交给宿主机"></a>4.通过数据卷机制,把容器管理的数据交给宿主机</h4><blockquote>
<p>放到宿主机那边好说,关键是数据在docker的mysql容器的哪个位置?</p>
<p>去官网找</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428766.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428766.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909212345633"></p>
<p>====&gt;<code>/var/lib/mysql</code></p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>mysql<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>将容器数据位置与宿主机位置挂载保证数据安全    </p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker run <span class="token operator">--</span>name mysql <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>mysql<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>mysql <span class="token operator">-</span>e MYSQL_ROOT_PASSWORD<span class="token operator">=</span><span class="token number">123456</span> <span class="token operator">-</span>p <span class="token number">3307</span><span class="token operator">:</span><span class="token number">3306</span> <span class="token operator">-</span>d mysql<span class="token operator">:</span><span class="token number">5.7</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>报错了</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428749.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428749.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909212847567"><br>是因为上一步已经run了一个mysql:5.7,应该先把那个删除掉再run</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428908.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428908.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909213347463"></p>
<blockquote>
<p>ok,记住以后数据就备份到宿主机linux的<code>/root/mysql/data</code>下</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428940.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428940.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909213528256"></p>
<h4 id="5-将mysql数据库备份为sql文件"><a href="#5-将mysql数据库备份为sql文件" class="headerlink" title="5.将mysql数据库备份为sql文件"></a>5.将mysql数据库备份为sql文件</h4><blockquote>
<p>数据卷虽然能备份数据,但是数据卷是将底层文件系统做的备份,好多东西可能是只有数据库才能识别的文件</p>
<p>若两个系统数据库版本不一样,那就寄了</p>
</blockquote>
<blockquote>
<p>①利用mysql官方命令mysqldump</p>
</blockquote>
<p>导出全部数据:</p>
<p><code>sql文件生成后放在了/root/all-databases.sql</code></p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker exec mysql容器的id sh <span class="token operator">-</span>c 'exec mysqldump <span class="token operator">--</span>all<span class="token operator">-</span>databases <span class="token operator">-</span>uroot <span class="token operator">-</span>p<span class="token string-literal singleline"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">MYSQL_ROOT_PASSWORD</span></span><span class="token string">"</span></span>' <span class="token operator">></span> <span class="token operator">/</span>root<span class="token operator">/</span>all<span class="token operator">-</span>databases<span class="token punctuation">.</span>sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 导出指定库数据:</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker exec mysql容器的id sh <span class="token operator">-</span>c 'exec mysqldump <span class="token operator">--</span>databases 库表名字 <span class="token operator">-</span>uroot <span class="token operator">-</span>p<span class="token string-literal singleline"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">MYSQL_ROOT_PASSWORD</span></span><span class="token string">"</span></span>' <span class="token operator">></span> <span class="token operator">/</span>root<span class="token operator">/</span>all<span class="token operator">-</span>databases<span class="token punctuation">.</span>sql <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  导出指定库数据(库表结构)不要数据:</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker exec mysql sh <span class="token operator">-</span>c 'exec mysqldump <span class="token operator">--</span>no<span class="token operator">-</span><span class="token keyword">data</span> <span class="token operator">--</span>databases 库表 <span class="token operator">-</span>uroot <span class="token operator">-</span>p<span class="token string-literal singleline"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">MYSQL_ROOT_PASSWORD</span></span><span class="token string">"</span></span>' <span class="token operator">></span> <span class="token operator">/</span>root<span class="token operator">/</span>all<span class="token operator">-</span>databases<span class="token punctuation">.</span>sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>②使用Navicat图形化工具</p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428188.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428188.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909215434976" style="zoom:80%;" />

<hr>
<hr>
<h4 id="6-使用自定义配置参数"><a href="#6-使用自定义配置参数" class="headerlink" title="6.使用自定义配置参数"></a>6.使用自定义配置参数</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker run <span class="token operator">--</span>name mysql <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>mysql<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>mysql<span class="token operator">/</span>conf<span class="token punctuation">.</span>d <span class="token operator">-</span>e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>root <span class="token operator">-</span>d mysql<span class="token operator">:</span>tag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="10-2-安装Redis服务"><a href="#10-2-安装Redis服务" class="headerlink" title="10.2 安装Redis服务"></a>10.2 安装Redis服务</h3><h4 id="1-下载redis"><a href="#1-下载redis" class="headerlink" title="1.下载redis"></a>1.下载redis</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker pull redis<span class="token operator">:</span><span class="token number">6.2</span><span class="token punctuation">.</span><span class="token number">7</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428970.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428970.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909222934005"></p>
<h4 id="2-运行redis"><a href="#2-运行redis" class="headerlink" title="2.运行redis"></a>2.运行redis</h4><p>因为linux里已经有redis了==&gt;宿主机的6379端口已经被占用了,所以我们给映射到6380</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker run <span class="token operator">--</span>name redis <span class="token operator">-</span>p <span class="token number">6380</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token operator">-</span>d redis<span class="token operator">:</span><span class="token number">6.2</span><span class="token punctuation">.</span><span class="token number">7</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428364.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428364.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220909223524290"></p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>在docker hub搜索redis镜像
	docker search redis

# <span class="token number">2</span><span class="token punctuation">.</span>拉取redis镜像到本地
	docker pull redis

# <span class="token number">3</span><span class="token punctuation">.</span>启动redis服务运行容器
	docker run <span class="token operator">--</span>name redis <span class="token operator">-</span>d redis<span class="token operator">:</span><span class="token function">tag</span> <span class="token punctuation">(</span>没有暴露外部端口<span class="token punctuation">)</span>
	docker run <span class="token operator">--</span>name redis <span class="token operator">-</span>p <span class="token number">6379</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token operator">-</span>d redis<span class="token operator">:</span><span class="token function">tag</span> <span class="token punctuation">(</span>暴露外部宿主机端口为<span class="token number">6379</span>进行连接<span class="token punctuation">)</span> 

# <span class="token number">4</span><span class="token punctuation">.</span>查看启动日志
	docker logs <span class="token operator">-</span>t <span class="token operator">-</span>f 容器id|容器名称

# <span class="token number">5</span><span class="token punctuation">.</span>进入容器内部查看
	docker exec <span class="token operator">-</span>it 容器id|名称 bash  

# <span class="token number">6</span><span class="token punctuation">.</span>加载外部自定义配置启动redis容器
	默认情况下redis官方镜像中没有redis<span class="token punctuation">.</span>conf配置文件 需要去官网下载指定版本的配置文件
	<span class="token number">1</span><span class="token punctuation">.</span> wget http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>io<span class="token operator">/</span>releases<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">5.0</span><span class="token punctuation">.</span><span class="token number">8</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz  下载官方安装包
	<span class="token number">2</span><span class="token punctuation">.</span> 将官方安装包中配置文件进行复制到宿主机指定目录中如 <span class="token operator">/</span>root<span class="token operator">/</span>redis<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf文件
	<span class="token number">3</span><span class="token punctuation">.</span> 修改需要自定义的配置
		 bind <span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">0.0</span> 开启远程权限
		 appenonly yes 开启aof持久化
	<span class="token number">4</span><span class="token punctuation">.</span> 加载配置启动
	docker run <span class="token operator">--</span>name redis <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>redis<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>redis <span class="token operator">-</span>p <span class="token number">6379</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token operator">-</span>d redis redis<span class="token operator">-</span>server <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf  

# <span class="token number">7</span><span class="token punctuation">.</span>将数据目录挂在到本地保证数据安全
	docker run <span class="token operator">--</span>name redis <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>redis<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">data</span> <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>redis<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf <span class="token operator">-</span>p <span class="token number">6379</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token operator">-</span>d redis redis<span class="token operator">-</span>server 					<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="10-3-安装Nginx"><a href="#10-3-安装Nginx" class="headerlink" title="10.3 安装Nginx"></a>10.3 安装Nginx</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>在docker hub搜索nginx
	docker search nginx

# <span class="token number">2</span><span class="token punctuation">.</span>拉取nginx镜像到本地
	<span class="token punctuation">[</span><span class="token label symbol">root@</span>localhost ~<span class="token punctuation">]</span># docker pull nginx
    Using default tag<span class="token operator">:</span> latest
    latest<span class="token operator">:</span> Pulling from library<span class="token operator">/</span>nginx
    afb6ec6fdc1c<span class="token operator">:</span> Pull complete 
    b90c53a0b692<span class="token operator">:</span> Pull complete 
    11fa52a0fdc0<span class="token operator">:</span> Pull complete 
    Digest<span class="token operator">:</span> sha256<span class="token operator">:</span>30dfa439718a17baafefadf16c5e7c9d0a1cde97b4fd84f63b69e13513be7097
    Status<span class="token operator">:</span> Downloaded newer image <span class="token keyword">for</span> nginx<span class="token operator">:</span>latest
    docker<span class="token punctuation">.</span>io<span class="token operator">/</span>library<span class="token operator">/</span>nginx<span class="token operator">:</span>latest

# <span class="token number">3</span><span class="token punctuation">.</span>启动nginx容器
		docker run <span class="token operator">-</span>p <span class="token number">80</span><span class="token operator">:</span><span class="token number">80</span> <span class="token operator">--</span>name nginx01 <span class="token operator">-</span>d nginx

# <span class="token number">4</span><span class="token punctuation">.</span>进入容器
		docker exec <span class="token operator">-</span>it nginx01 <span class="token operator">/</span>bin<span class="token operator">/</span>bash
		查找目录<span class="token operator">:</span>  whereis nginx
		配置文件<span class="token operator">:</span>  <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>nginx<span class="token punctuation">.</span>conf

# <span class="token number">5</span><span class="token punctuation">.</span>复制配置文件到宿主机
		docker cp <span class="token function">nginx01</span><span class="token punctuation">(</span>容器id|容器名称<span class="token punctuation">)</span><span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>nginx<span class="token punctuation">.</span>conf 宿主机名录

# <span class="token number">6</span><span class="token punctuation">.</span>挂在nginx配置以及html到宿主机外部
		docker run <span class="token operator">--</span>name nginx02 <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>nginx<span class="token operator">/</span>nginx<span class="token punctuation">.</span>conf<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>nginx<span class="token punctuation">.</span>conf <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html <span class="token operator">-</span>p <span class="token number">80</span><span class="token operator">:</span><span class="token number">80</span> <span class="token operator">-</span>d nginx		<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="10-4-安装Tomcat"><a href="#10-4-安装Tomcat" class="headerlink" title="10.4 安装Tomcat"></a>10.4 安装Tomcat</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>在docker hub搜索tomcat
	docker search tomcat

# <span class="token number">2</span><span class="token punctuation">.</span>下载tomcat镜像
	docker pull tomcat

# <span class="token number">3</span><span class="token punctuation">.</span>运行tomcat镜像
	docker run <span class="token operator">-</span>p <span class="token number">8080</span><span class="token operator">:</span><span class="token number">8080</span> <span class="token operator">-</span>d <span class="token operator">--</span>name mytomcat tomcat

# <span class="token number">4</span><span class="token punctuation">.</span>进入tomcat容器
	docker exec <span class="token operator">-</span>it mytomcat <span class="token operator">/</span>bin<span class="token operator">/</span>bash

# <span class="token number">5</span><span class="token punctuation">.</span>将webapps目录挂载在外部
	docker run <span class="token operator">-</span>p <span class="token number">8080</span><span class="token operator">:</span><span class="token number">8080</span> <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>webapps<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>tomcat<span class="token operator">/</span>webapps <span class="token operator">-</span>d <span class="token operator">--</span>name mytomcat tomcat
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="10-5-安装MongoDB数据库"><a href="#10-5-安装MongoDB数据库" class="headerlink" title="10.5 安装MongoDB数据库"></a>10.5 安装MongoDB数据库</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>运行mongDB
	docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">27017</span><span class="token operator">:</span><span class="token number">27017</span> <span class="token operator">--</span>name mymongo mongo  <span class="token operator">--</span><span class="token operator">-</span>无须权限
	docker logs <span class="token operator">-</span>f mymongo <span class="token operator">--</span>查看mongo运行日志

# <span class="token number">2</span><span class="token punctuation">.</span>进入mongodb容器
	docker exec <span class="token operator">-</span>it mymongo <span class="token operator">/</span>bin<span class="token operator">/</span>bash
		直接执行mongo命令进行操作

# <span class="token number">3</span><span class="token punctuation">.</span>常见具有权限的容器
	docker run <span class="token operator">--</span>name  mymongo  <span class="token operator">-</span>p <span class="token number">27017</span><span class="token operator">:</span><span class="token number">27017</span>  <span class="token operator">-</span>d mongo <span class="token operator">--</span>auth

# <span class="token number">4</span><span class="token punctuation">.</span>进入容器配置用户名密码
	mongo
	use admin 选择admin库
	db<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>user<span class="token operator">:</span><span class="token string-literal singleline"><span class="token string">"root"</span></span><span class="token punctuation">,</span>pwd<span class="token operator">:</span><span class="token string-literal singleline"><span class="token string">"root"</span></span><span class="token punctuation">,</span>roles<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>role<span class="token operator">:</span>'root'<span class="token punctuation">,</span>db<span class="token operator">:</span>'admin'<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>   <span class="token comment">//创建用户,此用户创建成功,则后续操作都需要用户认证</span>
	exit

# <span class="token number">5</span><span class="token punctuation">.</span>将mongoDB中数据目录映射到宿主机中
	docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">27017</span><span class="token operator">:</span><span class="token number">27017</span> <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>mongo<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>db <span class="token operator">--</span>name mymongo mongo <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="10-6-安装ElasticSearch"><a href="#10-6-安装ElasticSearch" class="headerlink" title="10.6 安装ElasticSearch"></a>10.6 安装ElasticSearch</h3><p><code>以下是雷丰阳老师安装版本</code></p>
<h4 id="1-下载ealastic-search和kibana"><a href="#1-下载ealastic-search和kibana" class="headerlink" title="1.下载ealastic search和kibana"></a>1.下载ealastic search和kibana</h4><blockquote>
<p>下载镜像</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker pull elasticsearch<span class="token operator">:</span><span class="token number">7.4</span><span class="token punctuation">.</span><span class="token number">2</span>
docker pull kibana<span class="token operator">:</span><span class="token number">7.4</span><span class="token punctuation">.</span><span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428813.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428813.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221012135946431"></p>
<blockquote>
<p>看一下虚拟机的可用内存</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">free <span class="token operator">-</span>m<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428134.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428134.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221012140341767"></p>
<h4 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">//创建目录,将es所有配置文件都挂载到config文件夹下,通过修改该文件夹的es配置,就能改变docker中es的配置
<span class="token function">mkdir</span> -p /mydata/elasticsearch/config 

//创建data文件夹,将内容都挂载到该文件夹下
<span class="token function">mkdir</span> -p /mydata/elasticsearch/data   

//可以被远程端任何ip访问    并将这个配置写入elasticsearch.yml中
<span class="token builtin class-name">echo</span> <span class="token string">"http.host: 0.0.0.0"</span> <span class="token operator">>></span>/mydata/elasticsearch/config/elasticsearch.yml    

//将mydata/elasticsearch/文件夹中文件都可读可写
<span class="token function">chmod</span> -R <span class="token number">777</span> /mydata/elasticsearch/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428708.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428708.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221012141603715"></p>
<h4 id="3-启动Elastic-search"><a href="#3-启动Elastic-search" class="headerlink" title="3.启动Elastic search"></a>3.启动Elastic search</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">docker</span> run --name elasticsearch -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 <span class="token punctuation">\</span>
-e  <span class="token string">"discovery.type=single-node"</span> <span class="token punctuation">\</span>
-e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms64m -Xmx128m"</span> <span class="token punctuation">\</span>
-v /mydata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml <span class="token punctuation">\</span>
-v /mydata/elasticsearch/data:/usr/share/elasticsearch/data <span class="token punctuation">\</span>
-v  /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins <span class="token punctuation">\</span>
-d elasticsearch:7.4.2 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428900.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231428900.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221012142345353"></p>
<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429075.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429075.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221012143400938"></p>
<p><code>解释</code></p>
<ul>
<li>docker run –name elasticsearch -p 9200:9200 -p 9300:9300 <br>为容器起个名字叫elasticsearch,对外暴露两个端口,9200是发送restapi时使用的,9300是es在集群状态下的通信端口<br>斜杠\ 是指换行到下一行</li>
<li>-e  “discovery.type=single-node” <br>以单节点模式运行</li>
<li>-e ES_JAVA_OPTS=”-Xms64m -Xmx128m” <br>指定es初始64M,最大占用128M<br>非常重要,如果不指定的话es一启动会将内存全部占用<br>真正企业中是32G左右</li>
<li>-v命令是进行挂载,将外部文件与docker内某文件一一关联,以后在外部修改就行</li>
<li>-d elasticsearch:7.4.2<br>后台启动elasticsearch:7.4.2 </li>
</ul>
<p><code>去浏览器康康</code></p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429308.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429308.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221012143529135" style="zoom:67%;" />

<p>设置开机启动elasticsearch</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker update elasticsearch <span class="token operator">--</span>restart<span class="token operator">=</span>always<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>暂时先不设置了</p>
<h4 id="4-启动kibana："><a href="#4-启动kibana：" class="headerlink" title="4.启动kibana："></a>4.启动kibana：</h4><blockquote>
<p>非必须安装,使用postman亦可</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429501.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429501.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221012143910976"></p>
<hr>
<hr>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">docker</span> run --name kibana -e <span class="token assign-left variable">ELASTICSEARCH_HOSTS</span><span class="token operator">=</span>http://192.168.88.3:9200 -p <span class="token number">5601</span>:5601 -d kibana:7.4.2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429524.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429524.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221012144212758"></p>
<p>设置开机启动kibana</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker update kibana  <span class="token operator">--</span>restart<span class="token operator">=</span>always<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>暂时先不设置了</p>
<h4 id="5-测试"><a href="#5-测试" class="headerlink" title="5.测试"></a>5.测试</h4><p>查看elasticsearch版本信息： <a target="_blank" rel="noopener" href="http://192.168.6.128:9200/">http://192.168.6.128:9200/</a> </p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"0adeb7852e00"</span><span class="token punctuation">,</span>
    <span class="token property">"cluster_name"</span><span class="token operator">:</span> <span class="token string">"elasticsearch"</span><span class="token punctuation">,</span>
    <span class="token property">"cluster_uuid"</span><span class="token operator">:</span> <span class="token string">"9gglpP0HTfyOTRAaSe2rIg"</span><span class="token punctuation">,</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"number"</span><span class="token operator">:</span> <span class="token string">"7.6.2"</span><span class="token punctuation">,</span>
        <span class="token property">"build_flavor"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
        <span class="token property">"build_type"</span><span class="token operator">:</span> <span class="token string">"docker"</span><span class="token punctuation">,</span>
        <span class="token property">"build_hash"</span><span class="token operator">:</span> <span class="token string">"ef48eb35cf30adf4db14086e8aabd07ef6fb113f"</span><span class="token punctuation">,</span>
        <span class="token property">"build_date"</span><span class="token operator">:</span> <span class="token string">"2020-03-26T06:34:37.794943Z"</span><span class="token punctuation">,</span>
        <span class="token property">"build_snapshot"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"lucene_version"</span><span class="token operator">:</span> <span class="token string">"8.4.0"</span><span class="token punctuation">,</span>
        <span class="token property">"minimum_wire_compatibility_version"</span><span class="token operator">:</span> <span class="token string">"6.8.0"</span><span class="token punctuation">,</span>
        <span class="token property">"minimum_index_compatibility_version"</span><span class="token operator">:</span> <span class="token string">"6.0.0-beta1"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"tagline"</span><span class="token operator">:</span> <span class="token string">"You Know, for Search"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示elasticsearch 节点信息<a target="_blank" rel="noopener" href="http://192.168.6.128:9200/_cat/nodes">http://192.168.6.128:9200/_cat/nodes</a> ，</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token number">127.0</span>.<span class="token number">0.1</span> <span class="token number">76</span> <span class="token number">95</span> <span class="token number">1</span> <span class="token number">0.26</span> <span class="token number">1.40</span> <span class="token number">1.22</span> dilm * 0adeb7852e00<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>访问Kibana：<a target="_blank" rel="noopener" href="http://192.168.88.3:5601/app/kibana">http://192.168.88.3:5601/app/kibana</a></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429213.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429213.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221012144549868"></p>
<hr>
<hr>
<p>======================================================================</p>
<p><code>一下是编程不良人安装版本</code></p>
<ul>
<li><code>注意:</code><strong>调高JVM线程数限制数量</strong></li>
</ul>
<h4 id="0-拉取镜像运行elasticsearch"><a href="#0-拉取镜像运行elasticsearch" class="headerlink" title="0.拉取镜像运行elasticsearch"></a>0.拉取镜像运行elasticsearch</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>dockerhub 拉取镜像
	docker pull elasticsearch<span class="token operator">:</span><span class="token number">6.4</span><span class="token punctuation">.</span><span class="token number">2</span>
# <span class="token number">2</span><span class="token punctuation">.</span>查看docker镜像
	docker images
# <span class="token number">3</span><span class="token punctuation">.</span>运行docker镜像
	docker run <span class="token operator">-</span>p <span class="token number">9200</span><span class="token operator">:</span><span class="token number">9200</span> <span class="token operator">-</span>p <span class="token number">9300</span><span class="token operator">:</span><span class="token number">9300</span> elasticsearch<span class="token operator">:</span><span class="token number">6.4</span><span class="token punctuation">.</span><span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>启动出现如下错误</li>
<li><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429100.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429100.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20200602184321790"></li>
</ul>
<h4 id="1-预先配置"><a href="#1-预先配置" class="headerlink" title="1. 预先配置"></a>1. 预先配置</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>在centos虚拟机中，修改配置sysctl<span class="token punctuation">.</span>conf
	vim <span class="token operator">/</span>etc<span class="token operator">/</span>sysctl<span class="token punctuation">.</span>conf
# <span class="token number">2</span><span class="token punctuation">.</span>加入如下配置
	vm<span class="token punctuation">.</span>max_map_count<span class="token operator">=</span><span class="token number">262144</span> 
# <span class="token number">3</span><span class="token punctuation">.</span>启用配置
	sysctl <span class="token operator">-</span>p
	注：这一步是为了防止启动容器时，报出如下错误：
	bootstrap checks failed max virtual memory areas vm<span class="token punctuation">.</span>max_map_count <span class="token punctuation">[</span><span class="token number">65530</span><span class="token punctuation">]</span> likely too low<span class="token punctuation">,</span> increase <span class="token keyword">to</span> at least <span class="token punctuation">[</span><span class="token number">262144</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-启动EleasticSearch容器"><a href="#2-启动EleasticSearch容器" class="headerlink" title="2.启动EleasticSearch容器"></a>2.启动EleasticSearch容器</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">0</span><span class="token punctuation">.</span>复制容器中<span class="token keyword">data</span>目录到宿主机中
	docker cp 容器id<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>share<span class="token operator">/</span>elasticsearch<span class="token operator">/</span><span class="token keyword">data</span> <span class="token operator">/</span>root<span class="token operator">/</span>es
# <span class="token number">1</span><span class="token punctuation">.</span>运行ES容器 指定jvm内存大小并指定ik分词器位置
	docker run <span class="token operator">-</span>d <span class="token operator">--</span>name es <span class="token operator">-</span>p <span class="token number">9200</span><span class="token operator">:</span><span class="token number">9200</span> <span class="token operator">-</span>p <span class="token number">9300</span><span class="token operator">:</span><span class="token number">9300</span> <span class="token operator">-</span>e ES_JAVA_OPTS<span class="token operator">=</span><span class="token string-literal singleline"><span class="token string">"-Xms128m -Xmx128m"</span></span> <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>es<span class="token operator">/</span>plugins<span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>elasticsearch<span class="token operator">/</span>plugins <span class="token operator">-</span>v <span class="token operator">/</span>root<span class="token operator">/</span>es<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>elasticsearch<span class="token operator">/</span><span class="token keyword">data</span> elasticsearch<span class="token operator">:</span><span class="token number">6.4</span><span class="token punctuation">.</span><span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-安装IK分词器"><a href="#3-安装IK分词器" class="headerlink" title="3.安装IK分词器"></a>3.安装IK分词器</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>下载对应版本的IK分词器
	wget https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>medcl<span class="token operator">/</span>elasticsearch<span class="token operator">-</span>analysis<span class="token operator">-</span>ik<span class="token operator">/</span>releases<span class="token operator">/</span>download<span class="token operator">/</span>v6<span class="token punctuation">.</span><span class="token number">4.2</span><span class="token operator">/</span>elasticsearch<span class="token operator">-</span>analysis<span class="token operator">-</span>ik<span class="token operator">-</span><span class="token number">6.4</span><span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">.</span>zip

# <span class="token number">2</span><span class="token punctuation">.</span>解压到plugins文件夹中
	yum install <span class="token operator">-</span>y unzip
	unzip <span class="token operator">-</span>d ik elasticsearch<span class="token operator">-</span>analysis<span class="token operator">-</span>ik<span class="token operator">-</span><span class="token number">6.4</span><span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">.</span>zip

# <span class="token number">3</span><span class="token punctuation">.</span>添加自定义扩展词和停用词
	cd plugins<span class="token operator">/</span>elasticsearch<span class="token operator">/</span>config
	vim IKAnalyzer<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span>xml
	<span class="token operator">&lt;</span>properties<span class="token operator">></span>
		<span class="token operator">&lt;</span>comment<span class="token operator">></span>IK Analyzer 扩展配置<span class="token operator">&lt;</span><span class="token operator">/</span>comment<span class="token operator">></span>
		<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>用户可以在这里配置自己的扩展字典 <span class="token operator">--</span><span class="token operator">></span>
		<span class="token operator">&lt;</span>entry key<span class="token operator">=</span><span class="token string-literal singleline"><span class="token string">"ext_dict"</span></span><span class="token operator">></span>ext_dict<span class="token punctuation">.</span>dic<span class="token operator">&lt;</span><span class="token operator">/</span>entry<span class="token operator">></span>
		<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>用户可以在这里配置自己的扩展停止词字典<span class="token operator">--</span><span class="token operator">></span>
		<span class="token operator">&lt;</span>entry key<span class="token operator">=</span><span class="token string-literal singleline"><span class="token string">"ext_stopwords"</span></span><span class="token operator">></span>ext_stopwords<span class="token punctuation">.</span>dic<span class="token operator">&lt;</span><span class="token operator">/</span>entry<span class="token operator">></span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">></span>

# <span class="token number">4</span><span class="token punctuation">.</span>在ik分词器目录下config目录中创建ext_dict<span class="token punctuation">.</span>dic文件   编码一定要为UTF<span class="token operator">-</span><span class="token number">8</span>才能生效
	vim ext_dict<span class="token punctuation">.</span>dic 加入扩展词即可
# <span class="token number">5</span><span class="token punctuation">.</span> 在ik分词器目录下config目录中创建ext_stopword<span class="token punctuation">.</span>dic文件 
	vim ext_stopwords<span class="token punctuation">.</span>dic 加入停用词即可

# <span class="token number">6</span><span class="token punctuation">.</span>重启容器生效
	docker restart 容器id
# <span class="token number">7</span><span class="token punctuation">.</span>将此容器提交成为一个新的镜像
	docker commit <span class="token operator">-</span>a<span class="token operator">=</span><span class="token string-literal singleline"><span class="token string">"xiaochen"</span></span> <span class="token operator">-</span>m<span class="token operator">=</span><span class="token string-literal singleline"><span class="token string">"es with IKAnalyzer"</span></span> 容器id xiaochen<span class="token operator">/</span>elasticsearch<span class="token operator">:</span><span class="token number">6.4</span><span class="token punctuation">.</span><span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="4-安装Kibana"><a href="#4-安装Kibana" class="headerlink" title="4. 安装Kibana"></a>4. 安装Kibana</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>下载kibana镜像到本地
	docker pull kibana<span class="token operator">:</span><span class="token number">6.4</span><span class="token punctuation">.</span><span class="token number">2</span>

# <span class="token number">2</span><span class="token punctuation">.</span>启动kibana容器
	docker run <span class="token operator">-</span>d <span class="token operator">--</span>name kibana <span class="token operator">-</span>e ELASTICSEARCH_URL<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">10.15</span><span class="token punctuation">.</span><span class="token number">0.3</span><span class="token operator">:</span><span class="token number">9200</span> <span class="token operator">-</span>p <span class="token number">5601</span><span class="token operator">:</span><span class="token number">5601</span> kibana<span class="token operator">:</span><span class="token number">6.4</span><span class="token punctuation">.</span><span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="10-7-安装MongoDB"><a href="#10-7-安装MongoDB" class="headerlink" title="10.7 安装MongoDB"></a>10.7 安装MongoDB</h3><h4 id="①pull命令拉取镜像"><a href="#①pull命令拉取镜像" class="headerlink" title="①pull命令拉取镜像"></a>①pull命令拉取镜像</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker pull mongo<span class="token operator">:</span><span class="token number">5.0</span><span class="token punctuation">.</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429367.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429367.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220919200719693" style="zoom:67%;" />

<h4 id="②-创建和启动容器"><a href="#②-创建和启动容器" class="headerlink" title="② 创建和启动容器"></a>② 创建和启动容器</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker run <span class="token operator">--</span>restart<span class="token operator">=</span>always <span class="token operator">--</span>name mymongo <span class="token operator">-</span>v <span class="token operator">/</span>mymongo<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>db <span class="token operator">-</span>p <span class="token number">27017</span><span class="token operator">:</span><span class="token number">27017</span> <span class="token operator">-</span>d mongo<span class="token operator">:</span><span class="token number">5.0</span><span class="token punctuation">.</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>--restart=always    总是随着docker引擎的重启而重启</code>  我先不设置了</p>
<blockquote>
<p>docker run –name mymongo -v /mymongo/data:/data/db -p 27017:27017 -d mongo:5.0.12</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429188.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429188.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220919211641374"></p>
<h4 id="③进入容器"><a href="#③进入容器" class="headerlink" title="③进入容器"></a>③进入容器</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">docker exec <span class="token operator">-</span>it mymongo <span class="token operator">/</span>bin<span class="token operator">/</span>bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429429.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429429.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220919211811742"></p>
<blockquote>
<p>做几个简单的测试</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">mongo
#进行数据库的一些操作<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429771.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429771.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220919212604133" style="zoom:67%;" />

<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">show dbs
#展示所有的数据库<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429222.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429222.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220919212700920"></p>
<hr>
<h2 id="11-Docker中出现如下错误解决方案"><a href="#11-Docker中出现如下错误解决方案" class="headerlink" title="11.Docker中出现如下错误解决方案"></a>11.Docker中出现如下错误解决方案</h2><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token punctuation">[</span><span class="token label symbol">root@</span>localhost ~<span class="token punctuation">]</span># docker search mysql 或者 docker pull 这些命令无法使用
Error response from daemon<span class="token operator">:</span> Get https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>index<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>io<span class="token operator">/</span>v1<span class="token operator">/</span>search<span class="token operator">?</span>q<span class="token operator">=</span>mysql&amp;n<span class="token operator">=</span><span class="token number">25</span><span class="token operator">:</span> x509<span class="token operator">:</span> certificate has expired <span class="token operator">or</span> <span class="token keyword">is</span> not yet valid<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429602.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429602.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20200602183429286"></p>
<ul>
<li>注意:<strong>这个错误的原因在于是系统的时间和docker hub时间不一致,需要做系统时间与网络时间同步</strong></li>
</ul>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>安装时间同步
	sudo yum <span class="token operator">-</span>y install ntp ntpdate
# <span class="token number">2</span><span class="token punctuation">.</span>同步时间
	sudo ntpdate cn<span class="token punctuation">.</span>pool<span class="token punctuation">.</span>ntp<span class="token punctuation">.</span>org
# <span class="token number">3</span><span class="token punctuation">.</span>查看本机时间
	date
# <span class="token number">4</span><span class="token punctuation">.</span>从新测试<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429294.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231429294.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20200602183718623"></p>
<h2 id="12-Dockerfile"><a href="#12-Dockerfile" class="headerlink" title="12.Dockerfile"></a>12.Dockerfile</h2><h3 id="12-1-什么是Dockerfile"><a href="#12-1-什么是Dockerfile" class="headerlink" title="12.1 什么是Dockerfile"></a>12.1 什么是Dockerfile</h3><p>Dockerfile可以认为是<strong>Docker镜像的描述文件，是由一系列命令和参数构成的脚本</strong>。主要作用是<strong>用来构建docker镜像的构建文件</strong>。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430247.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430247.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20200404111908085"></p>
<ul>
<li><strong>通过架构图可以看出通过DockerFile可以直接构建镜像</strong></li>
</ul>
<h3 id="12-2-Dockerfile解析过程"><a href="#12-2-Dockerfile解析过程" class="headerlink" title="12.2 Dockerfile解析过程"></a>12.2 Dockerfile解析过程</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430030.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430030.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20200603181253804"></p>
<h3 id="12-3-Dockerfile的保留命令"><a href="#12-3-Dockerfile的保留命令" class="headerlink" title="12.3 Dockerfile的保留命令"></a>12.3 Dockerfile的保留命令</h3><p>官方说明:<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p>
<table>
<thead>
<tr>
<th>保留字</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>FROM</strong></td>
<td><strong>当前镜像是基于哪个镜像的</strong> <code>第一个指令必须是FROM</code></td>
</tr>
<tr>
<td>MAINTAINER</td>
<td>镜像维护者的姓名和邮箱地址</td>
</tr>
<tr>
<td><strong>RUN</strong></td>
<td><strong>构建镜像时需要运行的指令</strong></td>
</tr>
<tr>
<td><strong>EXPOSE</strong></td>
<td><strong>当前容器对外暴露出的端口号</strong></td>
</tr>
<tr>
<td><strong>WORKDIR</strong></td>
<td><strong>指定在创建容器后，终端默认登录进来的工作目录，一个落脚点</strong></td>
</tr>
<tr>
<td><strong>ENV</strong></td>
<td><strong>用来在构建镜像过程中设置环境变量</strong></td>
</tr>
<tr>
<td><strong>ADD</strong></td>
<td><strong>将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar包</strong></td>
</tr>
<tr>
<td><strong>COPY</strong></td>
<td><strong>类似于ADD，拷贝文件和目录到镜像中<br/>将从构建上下文目录中&lt;原路径&gt;的文件/目录复制到新的一层的镜像内的&lt;目标路径&gt;位置</strong></td>
</tr>
<tr>
<td><strong>VOLUME</strong></td>
<td><strong>容器数据卷，用于数据保存和持久化工作</strong></td>
</tr>
<tr>
<td><strong>CMD</strong></td>
<td><strong>指定一个容器启动时要运行的命令<br/>Dockerfile中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换</strong></td>
</tr>
<tr>
<td><strong>ENTRYPOINT</strong></td>
<td><strong>指定一个容器启动时要运行的命令<br/>ENTRYPOINT的目的和CMD一样，都是在指定容器启动程序及其参数</strong></td>
</tr>
</tbody></table>
<h4 id="12-3-1-FROM-命令"><a href="#12-3-1-FROM-命令" class="headerlink" title="12.3.1 FROM 命令"></a>12.3.1 FROM 命令</h4><ul>
<li><p>基于那个镜像进行构建新的镜像,在构建时会自动从docker hub拉取base镜像 必须作为Dockerfile的第一个指令出现</p>
</li>
<li><p>语法:</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM  &lt;image&gt;
FROM  &lt;image&gt;[:&lt;tag&gt;]     使用版本不写为latest
FROM  &lt;image&gt;[@&lt;digest&gt;]  使用摘要<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="12-3-2-MAINTAINER-命令"><a href="#12-3-2-MAINTAINER-命令" class="headerlink" title="12.3.2 MAINTAINER  命令"></a>12.3.2 MAINTAINER  命令</h4><ul>
<li><p>镜像维护者的姓名和邮箱地址[废弃]</p>
</li>
<li><p>语法:</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">MAINTAINER &lt;name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h4 id="12-3-3-RUN-命令"><a href="#12-3-3-RUN-命令" class="headerlink" title="12.3.3 RUN 命令"></a>12.3.3 RUN 命令</h4><ul>
<li><p>RUN指令将在当前映像之上的新层中执行任何命令并提交结果。生成的提交映像将用于Dockerfile中的下一步</p>
</li>
<li><p>语法:</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">RUN &lt;command&gt; (shell form, the command is run in a shell, which by default is &#x2F;bin&#x2F;sh -c on Linux or cmd &#x2F;S &#x2F;C on Windows)
RUN echo hello

RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;] (exec form)
RUN [&quot;&#x2F;bin&#x2F;bash&quot;, &quot;-c&quot;, &quot;echo hello&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="12-3-4-EXPOSE-命令"><a href="#12-3-4-EXPOSE-命令" class="headerlink" title="12.3.4 EXPOSE 命令"></a>12.3.4 EXPOSE 命令</h4><ul>
<li><p>用来指定构建的镜像在运行为容器时对外暴露的端口</p>
</li>
<li><p>语法:</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">EXPOSE 80&#x2F;tcp  如果没有显示指定则默认暴露都是tcp
EXPOSE 80&#x2F;udp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="12-3-5-CMD-命令"><a href="#12-3-5-CMD-命令" class="headerlink" title="12.3.5 CMD 命令"></a>12.3.5 CMD 命令</h4><ul>
<li><p>用来为启动的容器指定执行的命令,在Dockerfile中只能有一条CMD指令。如果列出多个命令，则只有最后一个命令才会生效。</p>
</li>
<li><p>注意: <strong>Dockerfile中只能有一条CMD指令。如果列出多个命令，则只有最后一个命令才会生效。</strong></p>
</li>
<li><p>语法:</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;] (exec form, this is the preferred form)
CMD [&quot;param1&quot;,&quot;param2&quot;] (as default parameters to ENTRYPOINT)
CMD command param1 param2 (shell form)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="12-3-6-WORKDIR-命令"><a href="#12-3-6-WORKDIR-命令" class="headerlink" title="12.3.6 WORKDIR 命令"></a>12.3.6 WORKDIR 命令</h4><ul>
<li><p>用来为Dockerfile中的任何RUN、CMD、ENTRYPOINT、COPY和ADD指令设置工作目录。如果WORKDIR不存在，即使它没有在任何后续Dockerfile指令中使用，它也将被创建。</p>
</li>
<li><p>语法:</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">WORKDIR &#x2F;path&#x2F;to&#x2F;workdir

WORKDIR &#x2F;a
WORKDIR b
WORKDIR c
&#96;注意:WORKDIR指令可以在Dockerfile中多次使用。如果提供了相对路径，则该路径将与先前WORKDIR指令的路径相对&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="12-3-7-ENV-命令"><a href="#12-3-7-ENV-命令" class="headerlink" title="12.3.7 ENV 命令"></a>12.3.7 ENV 命令</h4><ul>
<li><p>用来为构建镜像设置环境变量。这个值将出现在构建阶段中所有后续指令的环境中。</p>
</li>
<li><p>语法：</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">ENV &lt;key&gt; &lt;value&gt;
ENV &lt;key&gt;&#x3D;&lt;value&gt; ...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="12-3-8-ADD-命令"><a href="#12-3-8-ADD-命令" class="headerlink" title="12.3.8 ADD 命令"></a>12.3.8 ADD 命令</h4><ul>
<li><p>用来从context上下文复制新文件、目录或远程文件url，并将它们添加到位于指定路径的映像文件系统中。</p>
</li>
<li><p>语法:</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">ADD hom* &#x2F;mydir&#x2F;       通配符添加多个文件
ADD hom?.txt &#x2F;mydir&#x2F;   通配符添加
ADD test.txt relativeDir&#x2F;  可以指定相对路径
ADD test.txt &#x2F;absoluteDir&#x2F; 也可以指定绝对路径
ADD url <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="12-3-9-COPY-命令"><a href="#12-3-9-COPY-命令" class="headerlink" title="12.3.9 COPY 命令"></a>12.3.9 COPY 命令</h4><ul>
<li><p>用来将context目录中指定文件复制到镜像的指定目录中</p>
</li>
<li><p>语法:</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">COPY src dest
COPY [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="12-3-10-VOLUME-命令"><a href="#12-3-10-VOLUME-命令" class="headerlink" title="12.3.10 VOLUME 命令"></a>12.3.10 VOLUME 命令</h4><ul>
<li><p>用来定义容器运行时可以挂在到宿主机的目录</p>
</li>
<li><p>语法:</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">VOLUME [&quot;&#x2F;data&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h4 id="12-3-11-ENTRYPOINT命令"><a href="#12-3-11-ENTRYPOINT命令" class="headerlink" title="12.3.11 ENTRYPOINT命令"></a>12.3.11 ENTRYPOINT命令</h4><ul>
<li><p>用来指定容器启动时执行命令和CMD类似</p>
</li>
<li><p>语法:</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">  [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]
ENTRYPOINT command param1 param2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ENTRYPOINT指令，往往用于设置容器启动后的<strong>第一个命令</strong>，这对一个容器来说往往是固定的。<br>CMD指令，往往用于设置容器启动的第一个命令的<strong>默认参数</strong>，这对一个容器来说可以是变化的。</p>
</li>
</ul>
<h4 id="12-3-12-ENTRYPOINT命令"><a href="#12-3-12-ENTRYPOINT命令" class="headerlink" title="12.3.12 ENTRYPOINT命令"></a>12.3.12 ENTRYPOINT命令</h4><h3 id="12-4-Dockerfile构建springboot项目部署"><a href="#12-4-Dockerfile构建springboot项目部署" class="headerlink" title="12.4 Dockerfile构建springboot项目部署"></a>12.4 Dockerfile构建springboot项目部署</h3><h5 id="1-准备springboot可运行项目"><a href="#1-准备springboot可运行项目" class="headerlink" title="1.准备springboot可运行项目"></a>1.准备springboot可运行项目</h5><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430972.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430972.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20200605172151266"></p>
<h5 id="2-将可运行项目放入linux虚拟机中"><a href="#2-将可运行项目放入linux虚拟机中" class="headerlink" title="2.将可运行项目放入linux虚拟机中"></a>2.将可运行项目放入linux虚拟机中</h5><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430646.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430646.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20200605172340380"></p>
<h5 id="3-编写Dockerfile"><a href="#3-编写Dockerfile" class="headerlink" title="3.编写Dockerfile"></a>3.编写Dockerfile</h5><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM openjdk:8
WORKDIR &#x2F;ems
ADD ems.jar &#x2F;ems
EXPOSE 8989
ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;]
CMD [&quot;ems.jar&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="4-构建镜像"><a href="#4-构建镜像" class="headerlink" title="4.构建镜像"></a>4.构建镜像</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@localhost ems<span class="token punctuation">]</span><span class="token comment"># docker build -t ems .</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="5-运行镜像"><a href="#5-运行镜像" class="headerlink" title="5.运行镜像"></a>5.运行镜像</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@localhost ems<span class="token punctuation">]</span><span class="token comment"># docker run -p 8989:8989 ems</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="6-访问项目"><a href="#6-访问项目" class="headerlink" title="6.访问项目"></a>6.访问项目</h5><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//10.15.0.8:8989/ems/login.html</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430010.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430010.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20200605173141636"></p>
<hr>
<h2 id="13-高级网络配置"><a href="#13-高级网络配置" class="headerlink" title="13.高级网络配置"></a>13.高级网络配置</h2><h3 id="13-1-说明"><a href="#13-1-说明" class="headerlink" title="13.1 说明"></a>13.1 说明</h3><p>当 Docker 启动时，会自动在主机上创建一个 <code>docker0</code> 虚拟网桥，实际上是 Linux 的一个 bridge，可以理解为一个软件交换机。它会在挂载到它的网口之间进行转发。</p>
<p>同时，Docker 随机分配一个本地未占用的私有网段（在 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc1918">RFC1918</a> 中定义）中的一个地址给 <code>docker0</code> 接口。比如典型的 <code>172.17.42.1</code>，掩码为 <code>255.255.0.0</code>。此后启动的容器内的网口也会自动分配一个同一网段（<code>172.17.0.0/16</code>）的地址。</p>
<p>当创建一个 Docker 容器的时候，同时会创建了一对 <code>veth pair</code> 接口（当数据包发送到一个接口时，另外一个接口也可以收到相同的数据包）。这对接口一端在容器内，即 <code>eth0</code>；另一端在本地并被挂载到 <code>docker0</code> 网桥，名称以 <code>veth</code> 开头（例如 <code>vethAQI2QT</code>）。通过这种方式，主机可以跟容器通信，容器之间也可以相互通信。Docker 就创建了在主机和所有容器之间一个虚拟共享网络。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430267.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231430267.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20201125105847896"></p>
<h3 id="13-2-查看网络信息"><a href="#13-2-查看网络信息" class="headerlink" title="13.2 查看网络信息"></a>13.2 查看网络信息</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># docker network ls<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="13-3-创建一个网桥"><a href="#13-3-创建一个网桥" class="headerlink" title="13.3 创建一个网桥"></a>13.3 创建一个网桥</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># docker network create <span class="token operator">-</span>d bridge 网桥名称<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="13-4-删除一个网桥"><a href="#13-4-删除一个网桥" class="headerlink" title="13.4 删除一个网桥"></a>13.4 删除一个网桥</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># docker network rm 网桥名称<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="13-5-容器之前使用网络通信"><a href="#13-5-容器之前使用网络通信" class="headerlink" title="13.5 容器之前使用网络通信"></a>13.5 容器之前使用网络通信</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>查询当前网络配置
<span class="token operator">-</span> docker network ls<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">NETWORK ID          NAME                DRIVER              SCOPE
8e424e5936b7        bridge              bridge              <span class="token builtin class-name">local</span>
17d974db02da        docker_gwbridge     bridge              <span class="token builtin class-name">local</span>
d6c326e433f7        <span class="token function">host</span>                <span class="token function">host</span>                <span class="token builtin class-name">local</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">2</span><span class="token punctuation">.</span>创建桥接网络
<span class="token operator">-</span> docker network create <span class="token operator">-</span>d bridge info<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker network create -d bridge info</span>
6e4aaebff79b1df43a064e0e8fdab08f52d64ce34db78dd5184ce7aaaf550a2f
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID          NAME                DRIVER              SCOPE
8e424e5936b7        bridge              bridge              <span class="token builtin class-name">local</span>
17d974db02da        docker_gwbridge     bridge              <span class="token builtin class-name">local</span>
d6c326e433f7        <span class="token function">host</span>                <span class="token function">host</span>                <span class="token builtin class-name">local</span>
6e4aaebff79b        info                bridge              <span class="token builtin class-name">local</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">3</span><span class="token punctuation">.</span>启动容器指定使用网桥
<span class="token operator">-</span> docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8890</span><span class="token operator">:</span><span class="token number">80</span> <span class="token operator">--</span>name nginx001 <span class="token operator">--</span>network info nginx 
<span class="token operator">-</span> docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8891</span><span class="token operator">:</span><span class="token number">80</span> <span class="token operator">--</span>name nginx002 <span class="token operator">--</span>network info nginx 
	`注意<span class="token operator">:</span>一旦指定网桥后<span class="token operator">--</span>name指定名字就是主机名<span class="token punctuation">,</span>多个容器指定在同一个网桥时<span class="token punctuation">,</span>可以在任意一个容器中使用主机名与容器进行互通`<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 8890:80 --name nginx001 --network info nginx </span>
c315bcc94e9ddaa36eb6c6f16ca51592b1ac8bf1ecfe9d8f01d892f3f10825fe
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 8891:80 --name nginx002 --network info nginx</span>
f8682db35dd7fb4395f90edb38df7cad71bbfaba71b6a4c6e2a3a525cb73c2a5
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
f8682db35dd7        nginx               <span class="token string">"/docker-entrypoint.…"</span>   <span class="token number">3</span> seconds ago       Up <span class="token number">2</span> seconds        <span class="token number">0.0</span>.0.0:8891-<span class="token operator">></span><span class="token number">80</span>/tcp   nginx002
c315bcc94e9d        nginx               <span class="token string">"/docker-entrypoint.…"</span>   <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes        <span class="token number">0.0</span>.0.0:8890-<span class="token operator">></span><span class="token number">80</span>/tcp   nginx001
b63169d43792        mysql:5.7.19        <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes        <span class="token number">3306</span>/tcp               mysql_mysql.1.s75qe5kkpwwttyf0wrjvd2cda
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it f8682db35dd7 /bin/bash</span>
root@f8682db35dd7:/<span class="token comment"># curl http://nginx001</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
<span class="token operator">&lt;</span>title<span class="token operator">></span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">></span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="14-高级数据卷配置"><a href="#14-高级数据卷配置" class="headerlink" title="14.高级数据卷配置"></a>14.高级数据卷配置</h2><h3 id="14-1-说明"><a href="#14-1-说明" class="headerlink" title="14.1 说明"></a>14.1 说明</h3><p><code>数据卷</code> 是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：</p>
<ul>
<li><code>数据卷</code> 可以在容器之间共享和重用</li>
<li>对 <code>数据卷</code> 的修改会立马生效</li>
<li>对 <code>数据卷</code> 的更新，不会影响镜像</li>
<li><code>数据卷</code> 默认会一直存在，即使容器被删除</li>
</ul>
<blockquote>
<p>注意：<code>数据卷</code> 的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会复制到数据卷中（仅数据卷为空时会复制）。</p>
</blockquote>
<h3 id="14-2-创建数据卷"><a href="#14-2-创建数据卷" class="headerlink" title="14.2 创建数据卷"></a>14.2 创建数据卷</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker volume create my-vol</span>
my-vol<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="14-3-查看数据卷"><a href="#14-3-查看数据卷" class="headerlink" title="14.3 查看数据卷"></a>14.3 查看数据卷</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker volume inspect my-vol       </span>
<span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        <span class="token string">"CreatedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2020-11-25T11:43:56+08:00"</span>,
        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,
        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,
        <span class="token string">"Mountpoint"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/my-vol/_data"</span>,
        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"my-vol"</span>,
        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,
        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="14-4-挂载数据卷"><a href="#14-4-挂载数据卷" class="headerlink" title="14.4 挂载数据卷"></a>14.4 挂载数据卷</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name web  -v my-vol:/usr/share/nginx/html  nginx</span>
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker inspect web</span>
				<span class="token string">"Mounts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"volume"</span>,
                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"my-vol"</span>,
                <span class="token string">"Source"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/my-vol/_data"</span>,
                <span class="token string">"Destination"</span><span class="token builtin class-name">:</span> <span class="token string">"/usr/share/nginx/html"</span>,
                <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,
                <span class="token string">"Mode"</span><span class="token builtin class-name">:</span> <span class="token string">"z"</span>,
                <span class="token string">"RW"</span><span class="token builtin class-name">:</span> true,
                <span class="token string">"Propagation"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="14-5-删除数据卷"><a href="#14-5-删除数据卷" class="headerlink" title="14.5 删除数据卷"></a>14.5 删除数据卷</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">docker</span> volume <span class="token function">rm</span> my-vol<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="15-Docker-Compose"><a href="#15-Docker-Compose" class="headerlink" title="15.Docker Compose"></a>15.Docker Compose</h2><h3 id="15-1-简介"><a href="#15-1-简介" class="headerlink" title="15.1 简介"></a>15.1 简介</h3><p><code>Compose</code> 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。从功能上看，跟 <code>OpenStack</code> 中的 <code>Heat</code> 十分类似。</p>
<p>其代码目前在 <a target="_blank" rel="noopener" href="https://github.com/docker/compose">https://github.com/docker/compose</a> 上开源。</p>
<p><code>Compose</code> 定位是 「定义和运行多个 Docker 容器的应用（Defining and running multi-container Docker applications）」，其前身是开源项目 Fig。</p>
<p>通过第一部分中的介绍，我们知道使用一个 <code>Dockerfile</code> 模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。</p>
<p><code>Compose</code> 恰好满足了这样的需求。它允许用户通过一个单独的 <code>docker-compose.yml</code> 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。</p>
<p><code>Compose</code> 中有两个重要的概念：</p>
<ul>
<li>服务 (<code>service</code>)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</li>
<li>项目 (<code>project</code>)：由一组关联的应用容器组成的一个完整业务单元，在 <code>docker-compose.yml</code> 文件中定义。</li>
</ul>
<p><code>Compose</code> 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。</p>
<p><code>Compose</code> 项目由 Python 编写，实现上调用了 Docker 服务提供的 API 来对容器进行管理。因此，只要所操作的平台支持 Docker API，就可以在其上利用 <code>Compose</code> 来进行编排管理。</p>
<h3 id="15-2-安装与卸载"><a href="#15-2-安装与卸载" class="headerlink" title="15.2 安装与卸载"></a>15.2 安装与卸载</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231431550.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231431550.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220908202951696"></p>
<h4 id="1-linux"><a href="#1-linux" class="headerlink" title="1.linux"></a>1.linux</h4><ul>
<li>在 Linux 上的也安装十分简单，从 官方 GitHub Release 处直接下载编译好的二进制文件即可。例如，在 Linux 64 位系统上直接下载对应的二进制包。</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/1.25.5/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> <span class="token operator">></span> /usr/local/bin/docker-compose
$ <span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="2-macos、window"><a href="#2-macos、window" class="headerlink" title="2.macos、window"></a>2.macos、window</h4><ul>
<li>Compose 可以通过 Python 的包管理工具 pip 进行安装，也可以直接下载编译好的二进制文件使用，甚至能够直接在 Docker 容器中运行。<code>Docker Desktop for Mac/Windows 自带 docker-compose 二进制文件，安装 Docker 之后可以直接使用</code>。</li>
</ul>
<h4 id="3-bash命令补全"><a href="#3-bash命令补全" class="headerlink" title="3.bash命令补全"></a>3.bash命令补全</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">curl</span> -L https://raw.githubusercontent.com/docker/compose/1.25.5/contrib/completion/bash/docker-compose <span class="token operator">></span> /etc/bash_completion.d/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="4-卸载"><a href="#4-卸载" class="headerlink" title="4.卸载"></a>4.卸载</h4><ul>
<li>如果是二进制包方式安装的，删除二进制文件即可。</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">sudo</span> <span class="token function">rm</span> /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="5-测试安装成功"><a href="#5-测试安装成功" class="headerlink" title="5.测试安装成功"></a>5.测试安装成功</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">docker-compose</span> --version
 <span class="token function">docker-compose</span> version <span class="token number">1.25</span>.5, build 4667896b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="15-3-docker-compose使用"><a href="#15-3-docker-compose使用" class="headerlink" title="15.3 docker compose使用"></a>15.3 docker compose使用</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">1</span><span class="token punctuation">.</span>相关概念<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>首先介绍几个术语。</p>
<ul>
<li>服务 (<code>service</code>)：一个应用容器，实际上可以运行多个相同镜像的实例。</li>
<li>项目 (<code>project</code>)：由一组关联的应用容器组成的一个完整业务单元。∂一个项目可以由多个服务（容器）关联而成，<code>Compose</code> 面向项目进行管理。</li>
</ul>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">2</span><span class="token punctuation">.</span>场景<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>最常见的项目是 web 网站，该项目应该包含 web 应用和缓存。</p>
<ul>
<li>springboot应用</li>
<li>mysql服务</li>
<li>redis服务</li>
<li>elasticsearch服务</li>
<li>…….</li>
</ul>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">3</span><span class="token punctuation">.</span>docker<span class="token operator">-</span>compose模板
<span class="token operator">-</span> 参考文档<span class="token operator">:</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>docker_practice<span class="token punctuation">.</span>gitee<span class="token punctuation">.</span>io<span class="token operator">/</span>zh<span class="token operator">-</span>cn<span class="token operator">/</span>compose<span class="token operator">/</span>compose_file<span class="token punctuation">.</span>html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.0"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysqldb</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>5.7.19
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"3306:3306"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/mysql/conf<span class="token punctuation">:</span>/etc/mysql/conf.d
      <span class="token punctuation">-</span> /root/mysql/logs<span class="token punctuation">:</span>/logs
      <span class="token punctuation">-</span> /root/mysql/data<span class="token punctuation">:</span>/var/lib/mysql
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> root
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ems
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> redis

  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>4.0.14
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"6379:6379"</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ems
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/redis/data<span class="token punctuation">:</span>/data
    <span class="token key atrule">command</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>server
    
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  ems<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"># <span class="token number">4</span><span class="token punctuation">.</span>通过docker<span class="token operator">-</span>compose运行一组容器
<span class="token operator">-</span> 参考文档<span class="token operator">:</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>docker_practice<span class="token punctuation">.</span>gitee<span class="token punctuation">.</span>io<span class="token operator">/</span>zh<span class="token operator">-</span>cn<span class="token operator">/</span>compose<span class="token operator">/</span>commands<span class="token punctuation">.</span>html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker-compose up    							//前台启动一组服务</span>
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker-compose up -d 							//后台启动一组服务</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<h3 id="15-4-docker-compose-模板文件"><a href="#15-4-docker-compose-模板文件" class="headerlink" title="15.4 docker-compose 模板文件"></a>15.4 docker-compose 模板文件</h3><p>模板文件是使用 <code>Compose</code> 的核心，涉及到的指令关键字也比较多。但大家不用担心，这里面大部分指令跟 <code>docker run</code> 相关参数的含义都是类似的。</p>
<p>默认的模板文件名称为 <code>docker-compose.yml</code>，格式为 YAML 格式。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> examples/web
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"80:80"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"/data"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意每个服务都必须通过 <code>image</code> 指令指定镜像或 <code>build</code> 指令（需要 Dockerfile）等来自动构建生成镜像。</p>
<p>如果使用 <code>build</code> 指令，在 <code>Dockerfile</code> 中设置的选项(例如：<code>CMD</code>, <code>EXPOSE</code>, <code>VOLUME</code>, <code>ENV</code> 等) 将会自动被获取，无需在 <code>docker-compose.yml</code> 中重复设置。</p>
<p>下面分别介绍各个指令的用法。</p>
<h4 id="build"><a href="#build" class="headerlink" title="build"></a><code>build</code></h4><p>指定 <code>Dockerfile</code> 所在文件夹的路径（可以是绝对路径，或者相对 docker-compose.yml 文件的路径）。 <code>Compose</code> 将会利用它自动构建这个镜像，然后使用这个镜像。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./dir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>你也可以使用 <code>context</code> 指令指定 <code>Dockerfile</code> 所在文件夹的路径。</p>
<p>使用 <code>dockerfile</code> 指令指定 <code>Dockerfile</code> 文件名。</p>
<p>使用 <code>arg</code> 指令指定构建镜像时的变量。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span>
      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./dir
      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile<span class="token punctuation">-</span>alternate
      <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token key atrule">buildno</span><span class="token punctuation">:</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="command"><a href="#command" class="headerlink" title="command"></a><code>command</code></h4><p>覆盖容器启动后默认执行的命令。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">command</span><span class="token punctuation">:</span> echo "hello world"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="container-name"><a href="#container-name" class="headerlink" title="container_name"></a><code>container_name</code></h4><p>指定容器名称。默认将会使用 <code>项目名称_服务名称_序号</code> 这样的格式。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">container_name</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>web<span class="token punctuation">-</span>container<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>注意: 指定容器名称后，该服务将无法进行扩展（scale），因为 Docker 不允许多个容器具有相同的名称。</p>
</blockquote>
<h4 id="depends-on"><a href="#depends-on" class="headerlink" title="depends_on"></a><code>depends_on</code></h4><p>解决容器的依赖、启动先后的问题。以下例子中会先启动 <code>redis</code> <code>db</code> 再启动 <code>web</code></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
      <span class="token punctuation">-</span> redis

  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis

  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意：<code>web</code> 服务不会等待 <code>redis</code> <code>db</code> 「完全启动」之后才启动。</p>
</blockquote>
<h4 id="env-file"><a href="#env-file" class="headerlink" title="env_file"></a><code>env_file</code></h4><p>从文件中获取环境变量，可以为单独的文件路径或列表。</p>
<p>如果通过 <code>docker-compose -f FILE</code> 方式来指定 Compose 模板文件，则 <code>env_file</code> 中变量的路径会基于模板文件路径。</p>
<p>如果有变量名称与 <code>environment</code> 指令冲突，则按照惯例，以后者为准。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">env_file: .env

env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/secrets.env<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>环境变量文件中每一行必须符合格式，支持 <code>#</code> 开头的注释行。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># common.env: Set development environment</span>
<span class="token assign-left variable">PROG_ENV</span><span class="token operator">=</span>development<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="environment"><a href="#environment" class="headerlink" title="environment"></a><code>environment</code></h4><p>设置环境变量。你可以使用数组或字典两种格式。</p>
<p>只给定名称的变量会自动获取运行 Compose 主机上对应变量的值，可以用来防止泄露不必要的数据。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token key atrule">RACK_ENV</span><span class="token punctuation">:</span> development
  <span class="token key atrule">SESSION_SECRET</span><span class="token punctuation">:</span>

<span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> RACK_ENV=development
  <span class="token punctuation">-</span> SESSION_SECRET<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果变量名称或者值中用到 <code>true|false，yes|no</code> 等表达 <a target="_blank" rel="noopener" href="https://yaml.org/type/bool.html">布尔</a> 含义的词汇，最好放到引号里，避免 YAML 自动解析某些内容为对应的布尔语义。这些特定词汇，包括</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">y<span class="token operator">|</span>Y<span class="token operator">|</span><span class="token function">yes</span><span class="token operator">|</span>Yes<span class="token operator">|</span>YES<span class="token operator">|</span>n<span class="token operator">|</span>N<span class="token operator">|</span>no<span class="token operator">|</span>No<span class="token operator">|</span>NO<span class="token operator">|</span><span class="token boolean">true</span><span class="token operator">|</span>True<span class="token operator">|</span>TRUE<span class="token operator">|</span><span class="token boolean">false</span><span class="token operator">|</span>False<span class="token operator">|</span>FALSE<span class="token operator">|</span>on<span class="token operator">|</span>On<span class="token operator">|</span>ON<span class="token operator">|</span>off<span class="token operator">|</span>Off<span class="token operator">|</span>OFF<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="healthcheck"><a href="#healthcheck" class="headerlink" title="healthcheck"></a><code>healthcheck</code></h4><p>通过命令检查容器是否健康运行。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>
  <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"CMD"</span><span class="token punctuation">,</span> <span class="token string">"curl"</span><span class="token punctuation">,</span> <span class="token string">"-f"</span><span class="token punctuation">,</span> <span class="token string">"http://localhost"</span><span class="token punctuation">]</span>
  <span class="token key atrule">interval</span><span class="token punctuation">:</span> 1m30s
  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s
  <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="image"><a href="#image" class="headerlink" title="image"></a><code>image</code></h4><p>指定为镜像名称或镜像 ID。如果镜像在本地不存在，<code>Compose</code> 将会尝试拉取这个镜像。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu
<span class="token key atrule">image</span><span class="token punctuation">:</span> orchardup/postgresql
<span class="token key atrule">image</span><span class="token punctuation">:</span> a4bc65fd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="networks"><a href="#networks" class="headerlink" title="networks"></a><code>networks</code></h4><p>配置容器连接的网络。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">some-service</span><span class="token punctuation">:</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> some<span class="token punctuation">-</span>network
     <span class="token punctuation">-</span> other<span class="token punctuation">-</span>network

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">some-network</span><span class="token punctuation">:</span>
  other<span class="token punctuation">-</span>network<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="ports"><a href="#ports" class="headerlink" title="ports"></a><code>ports</code></h4><p>暴露端口信息。</p>
<p>使用宿主端口：容器端口 <code>(HOST:CONTAINER)</code> 格式，或者仅仅指定容器的端口（宿主将会随机选择端口）都可以。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">ports</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token string">"3000"</span>
 <span class="token punctuation">-</span> <span class="token string">"8000:8000"</span>
 <span class="token punctuation">-</span> <span class="token string">"49100:22"</span>
 <span class="token punctuation">-</span> <span class="token string">"127.0.0.1:8001:8001"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><em>注意：当使用 <code>HOST:CONTAINER</code> 格式来映射端口时，如果你使用的容器端口小于 60 并且没放到引号里，可能会得到错误结果，因为 <code>YAML</code> 会自动解析 <code>xx:yy</code> 这种数字格式为 60 进制。为避免出现这种问题，建议数字串都采用引号包括起来的字符串格式。</em></p>
<h4 id="sysctls"><a href="#sysctls" class="headerlink" title="sysctls"></a><code>sysctls</code></h4><p>配置容器内核参数。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">sysctls</span><span class="token punctuation">:</span>
  <span class="token key atrule">net.core.somaxconn</span><span class="token punctuation">:</span> <span class="token number">1024</span>
  <span class="token key atrule">net.ipv4.tcp_syncookies</span><span class="token punctuation">:</span> <span class="token number">0</span>

<span class="token key atrule">sysctls</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> net.core.somaxconn=1024
  <span class="token punctuation">-</span> net.ipv4.tcp_syncookies=0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="ulimits"><a href="#ulimits" class="headerlink" title="ulimits"></a><code>ulimits</code></h4><p>指定容器的 ulimits 限制值。</p>
<p>例如，指定最大进程数为 65535，指定文件句柄数为 20000（软限制，应用可以随时修改，不能超过硬限制） 和 40000（系统硬限制，只能 root 用户提高）。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">ulimits</span><span class="token punctuation">:</span>
  <span class="token key atrule">nproc</span><span class="token punctuation">:</span> <span class="token number">65535</span>
  <span class="token key atrule">nofile</span><span class="token punctuation">:</span>
    <span class="token key atrule">soft</span><span class="token punctuation">:</span> <span class="token number">20000</span>
    <span class="token key atrule">hard</span><span class="token punctuation">:</span> <span class="token number">40000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="volumes"><a href="#volumes" class="headerlink" title="volumes"></a><code>volumes</code></h4><p>数据卷所挂载路径设置。可以设置为宿主机路径(<code>HOST:CONTAINER</code>)或者数据卷名称(<code>VOLUME:CONTAINER</code>)，并且可以设置访问模式 （<code>HOST:CONTAINER:ro</code>）。</p>
<p>该指令中路径支持相对路径。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> /var/lib/mysql
 <span class="token punctuation">-</span> cache/<span class="token punctuation">:</span>/tmp/cache
 <span class="token punctuation">-</span> ~/configs<span class="token punctuation">:</span>/etc/configs/<span class="token punctuation">:</span>ro<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果路径为数据卷名称，必须在文件中配置数据卷。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">my_src</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">8.0</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mysql_data<span class="token punctuation">:</span>/var/lib/mysql

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  mysql_data<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="15-5-docker-compose-常用命令"><a href="#15-5-docker-compose-常用命令" class="headerlink" title="15.5 docker-compose 常用命令"></a>15.5 docker-compose 常用命令</h3><h4 id="1-命令对象与格式"><a href="#1-命令对象与格式" class="headerlink" title="1. 命令对象与格式"></a>1. 命令对象与格式</h4><p>对于 Compose 来说，大部分命令的对象既可以是项目本身，也可以指定为项目中的服务或者容器。如果没有特别的说明，命令对象将是项目，这意味着项目中所有的服务都会受到命令影响。</p>
<p>执行 <code>docker-compose [COMMAND] --help</code> 或者 <code>docker-compose help [COMMAND]</code> 可以查看具体某个命令的使用格式。</p>
<p><code>docker-compose</code> 命令的基本的使用格式是</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> <span class="token punctuation">[</span>-f<span class="token operator">=</span><span class="token operator">&lt;</span>arg<span class="token operator">></span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARGS<span class="token punctuation">..</span>.<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="2-命令选项"><a href="#2-命令选项" class="headerlink" title="2. 命令选项"></a>2. 命令选项</h4><ul>
<li><code>-f, --file FILE</code> 指定使用的 Compose 模板文件，默认为 <code>docker-compose.yml</code>，可以多次指定。</li>
<li><code>-p, --project-name NAME</code> 指定项目名称，默认将使用所在目录名称作为项目名。</li>
<li><code>--x-networking</code> 使用 Docker 的可拔插网络后端特性</li>
<li><code>--x-network-driver DRIVER</code> 指定网络后端的驱动，默认为 <code>bridge</code></li>
<li><code>--verbose</code> 输出更多调试信息。</li>
<li><code>-v, --version</code> 打印版本并退出。</li>
</ul>
<h4 id="3-命令使用说明"><a href="#3-命令使用说明" class="headerlink" title="3.命令使用说明"></a>3.命令使用说明</h4><h5 id="up"><a href="#up" class="headerlink" title="up"></a><code>up</code></h5><p>格式为 <code>docker-compose up [options] [SERVICE...]</code>。</p>
<ul>
<li><p>该命令十分强大，它将尝试自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一系列操作。</p>
</li>
<li><p>链接的服务都将会被自动启动，除非已经处于运行状态。</p>
</li>
<li><p>可以说，大部分时候都可以直接通过该命令来启动一个项目。</p>
</li>
<li><p>默认情况，<code>docker-compose up</code> 启动的容器都在前台，控制台将会同时打印所有容器的输出信息，可以很方便进行调试。</p>
</li>
<li><p>当通过 <code>Ctrl-C</code> 停止命令时，所有容器将会停止。</p>
</li>
<li><p>如果使用 <code>docker-compose up -d</code>，将会在后台启动并运行所有的容器。一般推荐生产环境下使用该选项。</p>
</li>
<li><p>默认情况，如果服务容器已经存在，<code>docker-compose up</code> 将会尝试停止容器，然后重新创建（保持使用 <code>volumes-from</code> 挂载的卷），以保证新启动的服务匹配 <code>docker-compose.yml</code> 文件的最新内容</p>
</li>
</ul>
<hr>
<h5 id="down"><a href="#down" class="headerlink" title="down"></a><code>down</code></h5><ul>
<li>此命令将会停止 <code>up</code> 命令所启动的容器，并移除网络</li>
</ul>
<hr>
<h5 id="exec"><a href="#exec" class="headerlink" title="exec"></a><code>exec</code></h5><ul>
<li>进入指定的容器。</li>
</ul>
<hr>
<h5 id="ps"><a href="#ps" class="headerlink" title="ps"></a><code>ps</code></h5><p>格式为 <code>docker-compose ps [options] [SERVICE...]</code>。</p>
<p>列出项目中目前的所有容器。</p>
<p>选项：</p>
<ul>
<li><code>-q</code> 只打印容器的 ID 信息。</li>
</ul>
<hr>
<h5 id="restart"><a href="#restart" class="headerlink" title="restart"></a><code>restart</code></h5><p>格式为 <code>docker-compose restart [options] [SERVICE...]</code>。</p>
<p>重启项目中的服务。</p>
<p>选项：</p>
<ul>
<li><code>-t, --timeout TIMEOUT</code> 指定重启前停止容器的超时（默认为 10 秒）。</li>
</ul>
<hr>
<h5 id="rm"><a href="#rm" class="headerlink" title="rm"></a><code>rm</code></h5><p>格式为 <code>docker-compose rm [options] [SERVICE...]</code>。</p>
<p>删除所有（停止状态的）服务容器。推荐先执行 <code>docker-compose stop</code> 命令来停止容器。</p>
<p>选项：</p>
<ul>
<li><code>-f, --force</code> 强制直接删除，包括非停止状态的容器。一般尽量不要使用该选项。</li>
<li><code>-v</code> 删除容器所挂载的数据卷。</li>
</ul>
<hr>
<h5 id="start"><a href="#start" class="headerlink" title="start"></a><code>start</code></h5><p>格式为 <code>docker-compose start [SERVICE...]</code>。</p>
<p>启动已经存在的服务容器。</p>
<hr>
<h5 id="stop"><a href="#stop" class="headerlink" title="stop"></a><code>stop</code></h5><p>格式为 <code>docker-compose stop [options] [SERVICE...]</code>。</p>
<p>停止已经处于运行状态的容器，但不删除它。通过 <code>docker-compose start</code> 可以再次启动这些容器。</p>
<p>选项：</p>
<ul>
<li><code>-t, --timeout TIMEOUT</code> 停止容器时候的超时（默认为 10 秒）。</li>
</ul>
<hr>
<h5 id="top"><a href="#top" class="headerlink" title="top"></a><code>top</code></h5><p>查看各个服务容器内运行的进程。</p>
<hr>
<h5 id="unpause"><a href="#unpause" class="headerlink" title="unpause"></a><code>unpause</code></h5><p>格式为 <code>docker-compose unpause [SERVICE...]</code>。</p>
<p>恢复处于暂停状态中的服务。</p>
<hr>
<h2 id="16-docker可视化工具"><a href="#16-docker可视化工具" class="headerlink" title="16.docker可视化工具"></a>16.docker可视化工具</h2><h3 id="16-1-安装Portainer"><a href="#16-1-安装Portainer" class="headerlink" title="16.1 安装Portainer"></a>16.1 安装Portainer</h3><p>官方安装说明：<a target="_blank" rel="noopener" href="http://www.yunweipai.com/go?_=8fe4813824aHR0cHM6Ly93d3cucG9ydGFpbmVyLmlvL2luc3RhbGxhdGlvbi8=">https://www.portainer.io/installation/</a></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker pull  portainer/portainer</span>

<span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker volume create portainer_data</span>
portainer_data
<span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</span>
20db26b67b791648c2ef6aee444a5226a9c897ebcf0160050e722dbf4a4906e3
<span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker ps </span>
CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS              PORTS                                            NAMES
20db26b67b79        portainer/portainer   <span class="token string">"/portainer"</span>        <span class="token number">5</span> seconds ago       Up <span class="token number">4</span> seconds        <span class="token number">0.0</span>.0.0:8000-<span class="token operator">></span><span class="token number">8000</span>/tcp, <span class="token number">0.0</span>.0.0:9000-<span class="token operator">></span><span class="token number">9000</span>/tcp   portainer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="16-2-登录和使用Portainer"><a href="#16-2-登录和使用Portainer" class="headerlink" title="16.2 登录和使用Portainer"></a>16.2 登录和使用Portainer</h3><blockquote>
<p>用浏览器访问：<code>http://localhost:9000</code></p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231431112.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210231431112.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20201223231707738"></p>
<hr>

      </div>
      <div class="post-tags-categories">
        
        <div class="tags">
          
            <a href="/tags/Docker/" class="">
              Docker
            </a>
          
        </div>
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>作者:  </strong>高小天</a>
    </li>
    <li class="post-copyright-link">
    <strong>文章链接:  </strong>
    <a href="/2020/08/23/Docker/" target="_blank" title="Docker总结">https://gaoyang.world/2020/08/23/Docker/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明:   </strong>
      本网站所有文章除特别声明外,均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      许可协议。转载请注明出处!
    </li>
  </ul>
<div>
      
    </article>
    <!-- 上一篇文章和下一篇文章 -->
    
      <!-- 文章详情页的上一页和下一页 -->
<div class="post-nav">



  
  <div class="post-nav-prev post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="/medias/2.jpg" class="lazyload placeholder" data-srcset="/medias/2.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="">
    </div>
    <a href="/2020/08/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E5%85%B6%E7%AE%97%E6%B3%95/" class="post-nav-link">
      <div class="title">
        <i class="fas fa-angle-left"></i> 上一篇:
        <div class="title-text">数据结构及其算法</div>
      </div>
      
      <!-- <div class="content">
        数据结构及其算法
滴水穿石不是水的力量,而是坚持的力量~

1.线性结构和非线性结构
数据结构包括:线性结构和非线性结构
      </div> -->
    </a>
  </div>



  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="/medias/13.jpg" class="lazyload placeholder" data-srcset="/medias/13.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" src="" alt="">
    </div>
    <a href="/2020/08/22/vue/" class="post-nav-link">
      <div class="title">
        下一篇: <i class="fas fa-angle-right"></i>
        <div class="title-text">VUE总结</div>
      </div>
      <!-- <div class="content">
        VUE
即使再小的帆也能远航~

一. 简介
vue是JavaScript框架
简化Dom操作
响应式数据驱动

二.V
      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- 打赏 -->
    
      <div id="appDonate" class="post-donate">
  <div id="donate_board" class="donate_bar center" ref="donate">
    <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏" @click="showDialogDrawer()"></a>
  </div>
  <transition name="fade">
    <div 
      class="donate-box-mask"
      v-cloak 
      v-show="visible"
      @click="cancelDialogDrawer()"
    >
    </div>
  </transition>
  <transition name="bounce">
    <div class="donate-box" v-cloak v-show="visible">
      <div class="donate-box_close">
        <i class="fas fa-times" aria-hidden="true" @click="cancelDialogDrawer" pointer></i>
      </div>
      <div class="donate-box_title">
        <h4>
          你的赏识是我前进的动力
        </h4>
      </div>
      <div class="donate-box_tab">
        <div class="Alipay" pointer :class="{'active': tabActive === 'Alipay'}" @click="changeTabActive('Alipay')">
          支付宝
        </div>
        <div class="WeChatpay" pointer :class="{'active': tabActive === 'WeChatpay'}" @click="changeTabActive('WeChatpay')">
          微信
        </div>
      </div>
      <div class="donate-box_img">
        <div class="AlipayImg" v-show="tabActive === 'Alipay'">
          <img src="/medias/zfb.jpg" class="lazyload placeholder" data-srcset="/medias/zfb.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="支付宝打赏" />
        </div> 
        <div class="WeChatpayImg" v-show="tabActive === 'WeChatpay'">
          <img src="/medias/wx.jpg" class="lazyload placeholder" data-srcset="/medias/wx.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="微信打赏" />
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDonate',
    data: {
      visible: false,
      tabActive: 'Alipay',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        // function getScroll() {
        //   return {
        //     left: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0,
        //     top: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0
        //   };
        // }
        this.top = $(document).scrollTop() // or getScroll().top
        // console.log('aa', $('.main-content'));
        body.style.cssText = 'overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
      changeTabActive(name) {
        this.tabActive = name;
      }
    },
    created() {}
  })
</script>
    

    <!-- 分享 -->
    
      <!-- https://github.com/overtrue/share.js -->
<!-- 文章详情页的分享 -->
<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>

<script src="/js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- 评论 -->
    <!-- 评论 -->

  <div id="myComment">
    
      <div id="gitment-container"></div>

    
  </div>

<!-- comment script in themes\hexo-theme-bamboo\layout\_partial\scripts\index.ejs -->


  </div>

  <!-- 目录 -->
  <!-- 文章详情页右侧目录 -->


<script>
  function closeToc(init) {
    $(".toc-aside").css({'width': 0, 'padding': 0, 'transition': init ?  'noe' : 'width 0.3s' });
    $(".toc-content").css({'width': 0});
    $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
    $(".main-content").css({'width': '75%', 'margin': '10px auto'});
  };
  function openToc() {
    $(".main-content").css({'width': '65%', 'margin-right': '10px', 'margin-left': 'calc(35% - 350px)'});
    $(".toc-aside").css({'width': '300px', 'padding': '0 10px', 'transition': 'width 0.3s'});
    $(".toc-content").css({'width': '300px'});
    $(".toc-aside-title span, .toc-aside-title i").css({'display': 'inline-block'});
  }
  function openBtnClickFn () {
    let openOrCloseBtn = $('.toc-aside .toc-aside-title .toc-open-close');
    let open = eval('false' || 'true');
    openOrCloseBtn.click(function() {
      if (open) {
        closeToc();
        open = false;
      } else {
        openToc();
        open = true;
      }
    });
  };
  openBtnClickFn();
  initCloseTocWidth(true);

  function initCloseTocWidth(init) {
    if (window.innerWidth >= 992) {
      let isClose = true;
      isClose && closeToc(init)
    }
  }

  document.addEventListener('pjax:complete', function () {
    $(".toc-aside").css({'transition': 'no'});
  })
  document.addEventListener('pjax:complete', function () {
    openBtnClickFn();
  })
  
</script>

  <!-- 图片放大 Wrap images with fancybox support -->
  <script src="/js/wrapImage.js"></script>
</div>

<!-- 文章详情页背景图 -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;"
	:style="{'background-color': bgColor ? bgColor : 'transparent'}">
	<transition-group tag="ul" :name="names">
		<li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
			<img :src="image" class="bg-swiper-img no-lazy">
		</li>
	</transition-group>
</div>
<script>
	var vm = new Vue({
		el: '#appBgSwiper',
		data: {
			names: '' || 'fade' || 'fade', // translate-fade fade
			mark: 0,
			img: [],
			bgColor: '',
			time: null
		},
		methods: {   //添加方法
			change(i, m) {
				if (i > m) {
					// this.names = 'fade';
				} else if (i < m) {
					// this.names = 'fade';
				} else {
					return;
				}
				this.mark = i;
			},
			prev() {
				// this.names = 'fade';
				this.mark--;
				if (this.mark === -1) {
					this.mark = 3;
					return
				}
			},
			next() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			autoPlay() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			play() {
				let bgImgDelay = '' || '180000'
				let delay = parseInt(bgImgDelay) || 180000;
				this.time = setInterval(this.autoPlay, delay);
			},
			enter() {
				clearInterval(this.time);
			},
			leave() {
				this.play();
			}
		},
		created() {
			this.play()
		},
		beforeDestroy() {
			clearInterval(this.time);
		},
		mounted() {
			let prop = '' || '';
			let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://')
			if (isImg) {
				let img = prop.split(',');
				let configRoot = '/'
				let arrImg = [];
				img.forEach(el => {
					var Expression = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
					var objExp = new RegExp(Expression);

					if (objExp.test(el)) {
						// http or https
						arrImg.push(el);
					} else {
						// 非http or https开头
						// 本地文件
						let firstStr = el.charAt(0);
						if (firstStr == '/') {
							el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
						}
						el = configRoot + el;
						arrImg.push(el);
					}
				})
				this.img = arrImg;
			} else {
				this.bgColor = prop;
			}
		}
	})
</script>

<style>
	.bg-swiper-box {
		position: absolute;
		display: block;
		width: 100%;
		height: 100%;
	}

	.bg-swiper-img {
		object-fit: cover;
		width: 100%;
		height: 100%;
	}
</style>




  <script>
  function loadMermaid() {
    if (document.getElementsByClassName('mermaid').length) {
      if (window.mermaidJsLoad) mermaid.init()
      else {
        loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
          window.mermaidJsLoad = true
          mermaid.initialize({
            theme: 'default',
          })
          if ('true') {
            mermaid.init();
          }
        })
      }
    }
  };
  document.addEventListener("DOMContentLoaded", function () {
    loadMermaid();
  })

  document.addEventListener('pjax:complete', function () {
    loadMermaid();
  })
  
</script>


      </main>
    </div>

    <!-- 页脚 -->
    
  
  <div class="footer bg-color">
    <div class="footer-main">
      
        
          <div class="link">
            
          </div>
        
      
        
          <div class="footer-copyright">
            <p>Copyright © 2019 - 2020  </p>

          </div>
        
      
        
          
            <!-- 不蒜子统计 -->
            <!-- 不蒜子统计 -->
<span id="busuanzi_container_site_pv">
      <i class="fas fa-eye" aria-hidden="true"></i>本站总访问量：<span id="busuanzi_value_site_pv"></span> 次
</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv" style='display:none'>
      <i class="fas fa-users" aria-hidden="true"></i>本站访客数：<span id="busuanzi_value_site_uv"></span> 人
</span>

          
        
      
        
          <div class="footer-custom">
            
          </div>
        
      
    </div>
  </div>



    <!-- 渲染暗黑按钮 -->
    
      <div class="dark">
  <div class="dark-content">
    <i class="fas fa-moon" aria-hidden="true"></i>
    <!-- <span>关灯</span> -->
  </div>
  
</div>

<script>
  $(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-moon" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })
</script>
    
    <!-- 渲染回到顶部按钮 -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fas fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="/js/goTop.js"></script>

    
    <!-- 渲染左下角音乐播放器 -->
    
      <link rel="stylesheet" href="/js/aplayer/APlayer@1.10.1.min.css">
<style>
.aplayer .aplayer-lrc p {
  
  font-size: 12px;
  font-weight: 700;
  line-height: 16px !important;
}

.aplayer .aplayer-lrc p.aplayer-lrc-current {
  
  font-size: 15px;
  color: #42b983;
}


.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
  left: -66px !important;
}

.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
  left: 0px !important;
}


</style>
<meting-js  
  class=""
  server="tencent"
  type="playlist"
  id="8062553743"
  fixed='true'
  autoplay='false'
  theme='#42b983'
  loop='all'
  order='random'
  preload='auto'
  volume='0.7'
  list-folded='true'
>
</meting-js>

<!-- <style>
  #aplayer {
    position: fixed;
    left: 0;
    bottom: 300px;
  }
</style> -->
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    

    <!-- 图片放大 -->
    
      <script src="/js/fancybox/jquery.fancybox.min.js"></script>
    

    <!-- 百度解析 -->
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <!-- 背景彩带 -->
    
      <script type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="/js/ribbon.min.js"></script>
    

    <script src="/js/utils/index.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- 文章目录所需js -->
<link href="/js/tocbot/tocbot.css" rel="stylesheet">
<script src="/js/tocbot/tocbot.min.js"></script>

<script>
  var headerEl = 'h2, h3, h4',  //headers 
    content = '.post-detail',//文章容器
    idArr = {};  //标题数组以确定是否增加索引id
  //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -80,
    headingsOffset: -($(window).height() * 0.4 - 45),
    positionFixedSelector: '.toc-main',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    activeLinkClass: 'is-active-link',
    // onClick: function (e) {},
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      tocbot.init(option);
      mobileTocClick();
    });

  }

  window.tocScrollFn = function () {
    return bamboo.throttle(function () {
      findHeadPosition();
    }, 100)()
  }
  window.addEventListener('scroll', tocScrollFn);

  const findHeadPosition = function (top) {
    if ($('.toc-list').length <= 0) {
      return false;
    }
    setTimeout(() => {  // or DOMContentLoaded 
      autoScrollToc();
    }, 0);
  }

  const autoScrollToc = function () {
    const $activeItem = document.querySelector('.is-active-link');
    const $cardToc = document.querySelector('.toc-content');
    const activePosition = $activeItem.getBoundingClientRect().top
    const sidebarScrollTop = $cardToc.scrollTop
    if (activePosition > (document.documentElement.clientHeight - 100)) {
      $cardToc.scrollTop = sidebarScrollTop + 150
    }
    if (activePosition < 100) {
      $cardToc.scrollTop = sidebarScrollTop - 150
    }
  }

  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
      mobileTocClick();
    }
  });
  
  // 手机端toc按钮点击出现目录
  const mobileTocClick = function () {
    const $cardTocLayout = document.getElementsByClassName('toc-aside')[0];
    const $cardToc = $cardTocLayout.getElementsByClassName('toc-content')[0];
    let right = '45px';
    if (window.innerWidth >= 551 && window.innerWidth <= 992) {
      right = '100px'
    }
    const mobileToc = {
      open: () => {
        $cardTocLayout.style.cssText = 'animation: toc-open .3s; opacity: 1; right: ' + right
      },

      close: () => {
        $cardTocLayout.style.animation = 'toc-close .2s'
        setTimeout(() => {
          $cardTocLayout.style.cssText = "opacity:''; animation: ''; right: ''"
        }, 100)
      }
    }
    document.getElementById('toc-mobile-btn').addEventListener('click', () => {
      if (window.getComputedStyle($cardTocLayout).getPropertyValue('opacity') === '0') mobileToc.open()
      else mobileToc.close()
    })

    $cardToc.addEventListener('click', (e) => {
      if (window.innerWidth < 992) { // 小于992px的时候
        mobileToc.close()
      }
    })
  }
</script>

<style>
  .is-position-fixed {
    position: sticky !important;
    top: 74px;
  }

  .toc-main ul {
    counter-reset: show-list;
  }

  .toc-main ul li::before {
    content: counter(item)".";
    display: block;
    position: absolute;
    left: 12px;
    top: 0;
  }
</style> 

<!-- 设置导航背景 -->
<script>
  let setHeaderClass = () => {
    const headerMenuTransparent = true;
    if (!headerMenuTransparent) { return; }
    const nav = $('#navHeader');
    const navTop = nav.outerHeight();
    const winTop = $(window).scrollTop();
    if(winTop > navTop) {
      nav.addClass('header-bg-color');
    }
    else {
      nav.removeClass('header-bg-color');
    }
  };

  let scrollCollect = () => {
    return bamboo.throttle(function (e) {
      setHeaderClass();
    }, 200)()
  }

  let initHeaderBg = () => {
    setHeaderClass();
  }

  setHeaderClass();
  window.addEventListener('scroll', scrollCollect);

  document.addEventListener('pjax:send', function () {
    window.removeEventListener('scroll', scrollCollect)
  })
  document.addEventListener('pjax:complete', function () {
    window.addEventListener('scroll', scrollCollect);
    setHeaderClass();
  })
</script> 

<!-- 渲染issues标签里的内容 -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('/js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- 输入框打字特效 -->
<!-- 输入框打字特效 -->

  <script src="/js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // 打开随机颜色特效
    POWERMODE.shake = false;    // 关闭输入框抖动
    document.body.addEventListener('input', POWERMODE);//监听打字事件
  </script>


<!-- markdown代码一键复制功能 -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.css">
  <script src="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="/js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = '复制';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fas fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
          }
        })

        function doSomething() {
          that.$notify({
            title: "成功",
            content: "代码已复制，请遵守相关授权协议。",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>
  

<!-- 图片懒加载 -->
<script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>


<!-- 卡片滚动动画 -->
   

<!-- 评论所需js -->

  
    <script type="text/javascript">
  var utteranceCommon = {};

  function check_utterance() {
    let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');
    if (isDark) {
      utteranceCommon.Theme = 'github-dark';
    } else {
      utteranceCommon.Theme = 'github-light';
    }

    return document.getElementById("gitment-container");
  }
  comment_el = '#gitment-container';
  load_utterance = function () {
    if ($(comment_el).length) {
      // 匿名函数，防止污染全局变量
      const HEAD = check_utterance();

      var utterances = document.createElement('script');
      utterances.type = 'text/javascript';
      utterances.async = true;
      utterances.setAttribute('issue-term', 'pathname')
      utterances.setAttribute('theme', utteranceCommon.Theme)
      utterances.setAttribute('repo', '')
      utterances.crossorigin = 'anonymous';
      utterances.src = 'https://utteranc.es/client.js';
      // content 是要插入评论的地方
      document.getElementById('gitment-container').appendChild(utterances);

    }
  }

  function dark_utterance() {
    const HEAD = check_utterance();
    if (!HEAD) return;
    const message = {
      type: 'set-theme',
      theme: utteranceCommon.Theme
    };
    const utteranceIframe = document.querySelector('iframe');
    utteranceIframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }

  $(document).ready(load_utterance);
  document.addEventListener('pjax:complete', function () {
    load_utterance();
  });

  $('.dark').click(function () {
    setTimeout(() => {
      dark_utterance();
    });
  })

</script>

<style>
  .utterances {
    max-width: inherit !important;
  }
</style>
  


<!-- 鼠标点击特效 -->
<!-- 爱心点击 -->

  
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 999; pointer-events: none;" ></canvas>
    <script src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script src="/js/cursor/explosion.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script>


    <!-- pjax -->
    

<!-- pjax -->


  <script src="/js/pjax@0.2.8/index.js"></script>
  
    <!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // 拦截正常带链接的 a 标签
      selectors: ["#pjax-container","title"],                                   // 根据实际需要确认重载区域
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // 刷新不从顶部开始
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })
  </script>



  </body>
</html>