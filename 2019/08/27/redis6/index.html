<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>Redis | gy的小站</title>

  <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://cdn.jsdelivr.net/gh/inkss/fontawesome@5.15.3/css/all.min.css" rel="stylesheet">
  <link href="/js/swiper/swiper@5.4.1.min.css" rel="stylesheet">
  
  
    <script>
        var themeModelId = '';
        if (themeModelId) {
            localStorage.setItem('modelId', themeModelId);
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/gh/yuang01/live2d-widget@latest/autoload.js"></script>
    <script>
        var live2dOpen = eval('true') || false;
        if (!live2dOpen) {
            localStorage.setItem('waifu-display', 1609323474481);
        }
    </script>
  
  
  
<link rel="stylesheet" href="/css/animate.min.css">

  
<link rel="stylesheet" href="/css/style.css">

  
  
    
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    

    <!-- import link -->
    
        
            
        
            
        
    
    <!-- import script -->
    
        
            
        
            
        
    

<meta name="generator" content="Hexo 5.4.2"></head>

  
  <!-- 依赖于jquery和vue -->
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

  

  
    
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js"></script>

  
  
  <body>
    <!-- 预加载动画 -->
    <!-- 页面预加载动画 -->

<div id='loader'>
  <link rel="stylesheet" href="/js/loaded/index.css" >
  <div class="loading-left-bg"></div>
  <div class="loading-right-bg"></div>
  <div class="spinner-box">
    <div class="configure-border-1">
      <div class="configure-core"></div>
    </div>
    <div class="configure-border-2">
      <div class="configure-core"></div>
    </div>
    <div class="loading-word">加载中...</div>
  </div>
</div>

<script>
  var endLoading = function () {
    document.body.style.overflow = 'auto';
    document.getElementById('loader').classList.add("loading");
  }
  window.addEventListener('DOMContentLoaded',endLoading);
  
</script>

    
    <!-- 判断是否为暗黑风格 -->
    <!-- 判断是否为黑夜模式 -->
<script>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- 需要在上面加载的js -->
    <script>
  function loadScript(src, cb) {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }

  //https://github.com/filamentgroup/loadCSS
  var loadCSS = function (href, before, media, attributes) {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  };

</script> 

<!-- 轮播图所需要的js -->
<script src="/js/swiper/swiper.min.js"></script>
<script src="/js/swiper/vue-awesome-swiper.js"></script>
<script src="/js/swiper/swiper.animate1.0.3.min.js"></script>

<script type="text/javascript">
  Vue.use(window.VueAwesomeSwiper)
</script>


  <script src="/js/vue-typed-js/index.js"></script>


<!-- 首页的公告滚动插件的js需要重新加载 -->
<script src="/js/vue-seamless-scroll/index.js"></script>

<!-- 打字机效果js -->
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>


    <div id="safearea">
      <main class="main" id="pjax-container">
        <!-- 头部导航 -->
        
<header class="header   " 
  id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fas fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo lazyload placeholder" src="/medias/logo.png" class="lazyload placeholder" data-srcset="/medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
      <h3 class="drawer-box-head_title">gy的小站</h3>
      <h5 class="drawer-box-head_desc">滴水穿石不是水的力量,而是坚持的力量</h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/" class="drawer-menu-item-link">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">首页</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/archives" class="drawer-menu-item-link">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/tags" class="drawer-menu-item-link">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">标签</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/categories" class="drawer-menu-item-link">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">分类</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/about" class="drawer-menu-item-link">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">关于</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/friends" class="drawer-menu-item-link">
                  
                  <span class="name">友情链接</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="javascript:;" class="drawer-menu-item-link has-children" @click="openOrCloseMenu(6)">
                  <span>
                    
                      <i class="fas fa-link"></i>
                    
                    <span class="name">更多</span>
                  </span>
                  <i class="fas fa-chevron-left arrow " :class="{'icon-rotate': isOpen(6)}" aria-hidden="true"></i>
                </a>
                <ul class="drawer-sub-menu" v-if="isOpen(6)">
                  
                  <li>
                    <a href="/gallery">
                      
                      <i class="fas fa-music" style="margin-top: -20px;"></i>
                      
                      <span>工大风光</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/huoban">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>资源推荐</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>考研与就业</span>
                    </a>
                  </li>
                  
                  <li>
                    <a target="_blank" rel="noopener" href="http://baidu.com">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>百度</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
        
          <li class="drawer-box-content_item">
            <a target="_blank" rel="noopener" href="https://github.com/gaoyangya">
              <i class="fas fa-github" aria-hidden="true"></i>
              <span>Github</span>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="/medias/logo.png" class="lazyload placeholder" data-srcset="/medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
        </div>
      
      <a href="/" class="logo">gy的小站</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/" class="menu-item-link" title="首页">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">首页</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/archives" class="menu-item-link" title="归档">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/tags" class="menu-item-link" title="标签">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">标签</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/categories" class="menu-item-link" title="分类">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">分类</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/about" class="menu-item-link" title="关于">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">关于</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/friends" class="menu-item-link" title="友情链接">
                  
                  <span class="name">友情链接</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="javascript:;" class="menu-item-link" title="更多">
                  
                    <i class="fas fa-link"></i>
                  
                  <span class="name">更多</span>
                  <i class="fas fa-chevron-down arrow" aria-hidden="true"></i>
                </a>
                <ul class="sub-menu">
                  
                  <li>
                    <a href="/gallery">
                      
                      <i class="fas fa-music" style="margin-top: -20px;"></i>
                      
                      <span>工大风光</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/huoban">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>资源推荐</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>考研与就业</span>
                    </a>
                  </li>
                  
                  <li>
                    <a target="_blank" rel="noopener" href="http://baidu.com">
                      
                      <i class="fas fa-film" style="margin-top: -20px;"></i>
                      
                      <span>百度</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fas fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <h2>
          <span>
            <i class="fas fa-search" aria-hidden="true"></i>
            <span class="title">本地搜索</span>
          </span>
          <i class="fas fa-times close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="请输入关键字"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="/js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
      window.addEventListener('pjax:complete', () => {
        this.cancelDialogVisible();
      })
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- 解决刷新页面闪烁问题，可以在元素上添加display: none, 或者用vue.extend方法，详情：https://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- 下面是搜索基本写法 -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
    <a target="_blank" rel="noopener" href="https://github.com/gaoyangya" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
  
    <div id="he-plugin-simple"></div>
    <script>
      WIDGET = {
        CONFIG: {
          "modules": "012",
          "background": 5,
          "tmpColor": "4A4A4A",
          "tmpSize": 16,
          "cityColor": "4A4A4A",
          "citySize": 16,
          "aqiSize": 16,
          "weatherIconSize": 24,
          "alertIconSize": 18,
          "padding": "10px 10px 10px 10px",
          "shadow": "1",
          "language": "auto",
          "borderRadius": 5,
          "fixed": "false",
          "vertical": "middle",
          "horizontal": "center",
          "key": "2784dd3fcb1e4f0f9a9b579bf69641f2"
        }
      }
    </script>
    <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script> 
    
</header>
        <!-- 内容区域 -->
        
 <!-- prismjs 代码高亮 -->
 
    
    <link href="/js/prism/prism-line-numbers.css" rel="stylesheet">
    
        <link href="/js/prism/prism.min.css" rel="stylesheet">
    

    <style>
        pre[class*="language-"] {
            overflow-y: hidden;
        }
        .line-numbers .line-numbers-rows {
            border: none;
        }
    </style>
  


<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>


  <!-- 文章详情页顶部图片和标题 -->




<div class="post-detail-header" id="thumbnail_canvas" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;background-image:url('/medias/9.jpg')">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        Redis
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fas fa-calendar"></i> 发表于：2019-08-27 |
        </span>
      

      
        <span class="post-detail-header_categories">
          <i class="iconfont iconbookmark1"></i> 分类：
          
            <a href="/categories/%E5%90%8E%E7%AB%AF/" class="post-detail-header_category">
              后端
            </a>
          
            <a href="/categories/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="post-detail-header_category">
              数据库
            </a>
          
        </span>
      

      
    
  </div>
  
  
    <script src="/js/bubble/bubble.js"></script>
  
</div>





<div class="row justify-position" 
  style="padding-top: 0px;">
  <div class="main-content">
    <article class="post post-detail">
      <div class="post-content">
        <h1 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h1><blockquote>
<p>滴水穿石不是水的力量,而是坚持的力量</p>
</blockquote>
<h1 id="前提-linux基础"><a href="#前提-linux基础" class="headerlink" title="前提:   linux基础"></a>前提:   linux基础</h1><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152138890.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152138890.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325122218462"></p>
<h2 id="1-XShell-远程登陆"><a href="#1-XShell-远程登陆" class="headerlink" title="1.XShell:远程登陆"></a>1.XShell:远程登陆</h2><blockquote>
<p>1 为什么需要远程登录Linux</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139873.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139873.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324164258695"></p>
<p>说明: 公司开发时候， 具体的情况是这样的</p>
<ol>
<li><p>linux 服务器是开发小组共享的.</p>
</li>
<li><p> 正式上线的项目是运行在公网的.</p>
</li>
<li><p> 因此程序员需要远程登录到 centos 进行项目管理或者开发.</p>
</li>
<li><p> 画出简单的网络拓扑示意图(帮助理解)</p>
</li>
<li><p> 远程登录客户端有 Xshell5， Xftp5 , 我们学习使用 Xshell5 和 Xftp , 其它的远程工具大同小异.</p>
</li>
</ol>
<blockquote>
<p>2  远程登录Linux-Xshell5</p>
</blockquote>
<ul>
<li>说明: Xshell 是目前最好的远程登录到 Linux 操作的软件，流畅的速度并且完美解决了中文乱码的问题， 是目前程序员首选的软件。</li>
<li>Xshell 是一个强大的安全终端模拟软件，它支持 SSH1, SSH2, 以及 Microsoft Windows 平台的 TELNET 协议。</li>
<li>Xshell 可以在 Windows 界面下用来访问远端不同系统下的服务器，从而比较好的达到远程控制终端的目的。</li>
</ul>
<p><strong>特别说明</strong>：如果希望安装好 XShell 5 就可以远程访问 Linux 系统的话，需要有一个前提，就是<code>Linux 启用了 SSHD 服务，该服务会监听 22 号端口</code>。</p>
<blockquote>
<ol start="3">
<li> XShell7 下载</li>
</ol>
</blockquote>
<p>xshell7和xftp7下载地址:<a target="_blank" rel="noopener" href="https://www.xshell.com/zh/free-for-home-school/">https://www.xshell.com/zh/free-for-home-school/</a>    </p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139204.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139204.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324165309879" style="zoom:80%;" />

<hr>
<hr>
<p>然后你就会看到:</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139568.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139568.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324165422849" style="zoom:80%;" />

<hr>
<hr>
<p>最后一步:</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139442.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139442.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324165635819" style="zoom:67%;" />

<hr>
<hr>
<p>下载完成:<br><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139230.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139230.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324170022496" style="zoom: 80%;" /></p>
<blockquote>
<p>4 .  XShell5 安装</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139214.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139214.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324170413465" style="zoom: 67%;" /><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139747.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152139747.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324170922566"><br>然后傻瓜式安装,狂点下一步</p>
<blockquote>
<p>5.XShell使用前提</p>
</blockquote>
<p><code>有一个前提:必须要知道linux的ip地址 &amp; XShell所在的windows电脑必须ping通linux</code></p>
<ul>
<li><p><strong>在linux终端里面要用<code>管理员权限</code>去操作</strong><br>先以普通用户登进去,然后在终端里输入:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">sudo su root # 以管理员权限切换至root用户，不可以可以用下一行<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>切换到管理员权限<br>注:ctrl+alt+T打开终端</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140365.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140365.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324181310838" style="zoom:80%;" /></li>
<li><p>去获取linux的ip:使用命令:<code>ifconfig</code></p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140622.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140622.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324204750265" style="zoom:67%;" /></li>
<li><p>cmd里面ping一下</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140927.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140927.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324181028244" style="zoom:80%;" />
ok</li>
</ul>
<blockquote>
<p>6.报错:网络连接激活失败</p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140295.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140295.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324195119345" style="zoom:67%;" />

<p>连不上网那更连不上XShell了!!!</p>
<p><code>解决方案:</code></p>
<p>首先我声明昂~错误种类很多,所以解决方案也很多</p>
<ol>
<li>win+R打开运行框，然后输入services.msc，点击确定<br>或者直接左下角搜服务进去</li>
<li>找到VMware DHCP Service，然后右击启动<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140806.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140806.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324204420347" style="zoom:67%;" /></li>
<li>点击启动之后在虚拟机上重新连接网络，这时候网络连接成功</li>
</ol>
<blockquote>
<p>7 .XShell连接linux</p>
</blockquote>
<ol>
<li><p>打开XShell,点击新建</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140667.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140667.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324205348326" style="zoom:67%;" /></li>
<li><p>填信息,点击<code>确定</code>,不是连接昂</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140052.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140052.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324205843470" style="zoom:67%;" /></li>
<li><p>点击关闭</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140308.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140308.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324210533688" style="zoom:50%;" />
`不是点关闭昂!!!!!是点击连接`

<p>先选中上面的会话,然后点击连接!!!!</p>
</li>
<li><p>双击</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140589.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152140589.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324211142497" style="zoom:67%;" /></li>
</ol>
<h2 id="2-XFTP6-远程文件传输"><a href="#2-XFTP6-远程文件传输" class="headerlink" title="2.XFTP6:远程文件传输"></a>2.XFTP6:远程文件传输</h2><p><code>在Windows和linux之间上传下载文件</code></p>
<blockquote>
<p>1 .下载</p>
</blockquote>
<p>下载方法同XShell<br>xshell7和xftp7下载地址:<a target="_blank" rel="noopener" href="https://www.xshell.com/zh/free-for-home-school/">https://www.xshell.com/zh/free-for-home-school/</a>    </p>
<blockquote>
<p>2.使用前提</p>
</blockquote>
<p><code>有一个前提:必须要知道linux的ip地址 &amp; XShell所在的windows电脑必须ping通linux</code></p>
<blockquote>
<p>3.XFTP连接linux</p>
</blockquote>
<ol>
<li><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141373.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141373.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325093819731" style="zoom:80%;" />

<ul>
<li>协议是<code>SFTP</code></li>
<li>端口号是<code>22</code></li>
<li>主机是<code>ifconfig的那个</code></li>
</ul>
</li>
<li><p>点击连接!!!!<br>如果点击关闭,那之前做的一切就没有意义了!!!</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141973.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141973.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325094633360" style="zoom:50%;" /></li>
<li><p>问题来了,没有连接上</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141364.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141364.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325095022629" style="zoom:50%;" /></li>
</ol>
<p><code>解决:</code></p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141400.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141400.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325095154049" style="zoom:150%;" />

<hr>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141094.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141094.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325095508772" style="zoom:67%;" />

<hr>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141809.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141809.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325095529013" style="zoom:67%;" />

<blockquote>
<p>4 .使用</p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141536.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141536.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325102341854" style="zoom:67%;" />



<p>效果:<br><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141969.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152141969.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325102426742" style="zoom:50%;" /></p>
<hr>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142247.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142247.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325102530373" style="zoom:67%;" />

<h1 id="1-NoSQL数据库简介"><a href="#1-NoSQL数据库简介" class="headerlink" title="1.NoSQL数据库简介"></a>1.NoSQL数据库简介</h1><h2 id="1-1-技术发展"><a href="#1-1-技术发展" class="headerlink" title="1.1.技术发展"></a>1.1.技术发展</h2><blockquote>
<p>技术的分类</p>
</blockquote>
<p>1、<code>解决功能性的问题</code>：Java、Jsp、RDBMS、Tomcat、HTML、Linux、JDBC</p>
<p>2、<code>解决扩展性的问题</code>：Struts、Spring、SpringMVC、Hibernate、Mybatis</p>
<p>3、<code>解决性能的问题</code>：NoSQL、Java线程、Hadoop、Nginx、MQ、ElasticSearch</p>
<blockquote>
<p><strong><code>NoSQL是为了解决性能问题而产生的一门技术,而Redis是典型的NoSQL数据库</code></strong></p>
</blockquote>
<h3 id="1-1-1-Web1-0时代"><a href="#1-1-1-Web1-0时代" class="headerlink" title="1.1.1.  Web1.0时代"></a><strong>1.1.1.</strong>  <strong>Web1.0</strong>时代</h3><p>Web1.0的时代，数据访问量很有限，用一夫当关的高性能的单点服务器可以解决大部分问题</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142869.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142869.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324143027202"></p>
<h3 id="1-1-2-Web2-0时代"><a href="#1-1-2-Web2-0时代" class="headerlink" title="1.1.2  Web2.0时代"></a><strong>1.1.2</strong>  <strong>Web2.0</strong>时代</h3><p>随着Web2.0的时代的到来，用户访问量大幅度提升，同时产生了大量的用户数据。加上后来的智能移动设备的普及，所有的互联网平台都面临了巨大的性能挑战。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142255.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142255.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324143145270"></p>
<h3 id="1-1-3-解决CPU及内存压力"><a href="#1-1-3-解决CPU及内存压力" class="headerlink" title="1.1.3   解决CPU及内存压力"></a>1.1.3   <strong>解决CPU及内存压力</strong></h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142760.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142760.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324143229324"></p>
<h3 id="1-1-4-解决IO压力"><a href="#1-1-4-解决IO压力" class="headerlink" title="1.1.4 解决IO压力"></a>1.1.4 <strong>解决IO压力</strong></h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142034.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142034.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324143302413"></p>
<ul>
<li>多台服务器,可能在前面加一个负载均衡(又叫反向代理服务器),负载均衡一般用<code>Nginx</code></li>
<li>负载均衡:把众多的请求平均分担到多个服务器上面,用集群或者分布式架构来解决</li>
<li>最终还是要去访问数据库==&gt;经过IO的操作===&gt;解决IO压力</li>
</ul>
<ol>
<li><p>用分布式或者集群方式来做架构,产生最典型的问题:<code>session共享问题</code></p>
<ul>
<li>第一次操作访问了服务器1, 然后在服务器1中进行登陆,登陆之后服务器1中就产生存储了session对象</li>
<li> 第二次访问请求有可能去了服务器2中,但是服务器2中没有session对象===&gt;不能进入登陆状态,后续操作无法进行了</li>
</ul>
</li>
<li><p>session共享问题解决方案</p>
<ul>
<li>信息存储到客户端或者说存储到cookie<br>缺点:不安全</li>
<li>session复制<br>将在某一台服务器登陆产生的session对象复制到其他服务器上<br>缺点:数据冗余</li>
<li>存储到NoSQL数据库中<br>好处:<ul>
<li>直接通过内存进行读取,不需要经过io操作==&gt;减小cpu及io压力</li>
<li> NoSQL直接作为缓存使用,提高访问速度</li>
</ul>
</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142005.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142005.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324150914933"></p>
</li>
</ol>
<h2 id="1-2-NoSQL数据库"><a href="#1-2-NoSQL数据库" class="headerlink" title="1.2 NoSQL数据库"></a>1.2 NoSQL数据库</h2><h3 id="12-1-NoSQL数据库概述"><a href="#12-1-NoSQL数据库概述" class="headerlink" title="12.1 NoSQL数据库概述"></a>12.1 NoSQL数据库概述</h3><blockquote>
<p>NoSQL(NoSQL = <strong>Not Only SQL</strong> )，意即“不仅仅是SQL”，泛指<strong>非关系型的数据库</strong>。</p>
</blockquote>
<p>NoSQL 不依赖业务逻辑方式存储，而以简单的key-value模式存储。因此大大的增加了数据库的扩展能力。</p>
<ul>
<li>不遵循SQL标准。</li>
<li>不支持ACID(事务的四个特性)。</li>
<li>远超于SQL的性能。</li>
</ul>
<h3 id="12-2-NoSQL适用场景"><a href="#12-2-NoSQL适用场景" class="headerlink" title="12.2 NoSQL适用场景"></a>12.2 NoSQL适用场景</h3><ul>
<li>对数据高并发的读写</li>
<li>海量数据的读写</li>
<li>对数据高可扩展性的</li>
</ul>
<h3 id="12-3-NoSQL不适用场景"><a href="#12-3-NoSQL不适用场景" class="headerlink" title="12.3   NoSQL不适用场景"></a>12.3   <strong>NoSQL</strong>不适用场景</h3><ul>
<li>需要事务支持</li>
<li>基于sql的结构化查询存储，处理复杂的关系,需要即席查询。</li>
<li><code>（用不着sql的和用了sql也不行的情况，请考虑用NoSql）</code></li>
</ul>
<h3 id="12-4-Memcache"><a href="#12-4-Memcache" class="headerlink" title="12.4 Memcache"></a>12.4 Memcache</h3><h3 id="12-5-Redis"><a href="#12-5-Redis" class="headerlink" title="12.5 Redis"></a>12.5 Redis</h3><h3 id="12-6-MongoDB"><a href="#12-6-MongoDB" class="headerlink" title="12.6 MongoDB"></a>12.6 MongoDB</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142635.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152142635.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324151845677"></p>
<h2 id="1-3-行式存储数据库（大数据时代）"><a href="#1-3-行式存储数据库（大数据时代）" class="headerlink" title="1.3   行式存储数据库（大数据时代）"></a>1.3   行式存储数据库（大数据时代）</h2><h3 id="1-3-1-行式数据库"><a href="#1-3-1-行式数据库" class="headerlink" title="1.3.1 行式数据库"></a>1.3.1 行式数据库</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143226.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143226.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324153951001"></p>
<h3 id="1-3-2-列式数据库"><a href="#1-3-2-列式数据库" class="headerlink" title="1.3.2 列式数据库"></a>1.3.2 列式数据库</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143146.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143146.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324154022555"></p>
<h4 id="1-3-2-1-Hbase"><a href="#1-3-2-1-Hbase" class="headerlink" title="1.3.2.1  Hbase"></a>1.3.2.1  Hbase</h4><p>HBase是<strong>Hadoop</strong>项目中的数据库。它用于需要对大量的数据进行随机、实时的读写操作的场景中。</p>
<p>HBase的目标就是处理数据量<strong>非常庞大</strong>的表，可以用<strong>普通的计算机</strong>处理超过<strong>10亿行数据</strong>，还可处理有数百万<strong>列</strong>元素的数据表。</p>
<h4 id="1-3-2-2-Cassandra-kəˈsaendrə"><a href="#1-3-2-2-Cassandra-kəˈsaendrə" class="headerlink" title="1.3.2.2  Cassandra[kəˈsændrə]"></a>1.3.2.2  <strong>Cassandra[kəˈsændrə]</strong></h4><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143599.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143599.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324154222940"></p>
<p>计算机存储单位 计算机存储单位一般用B，KB，MB，GB，TB，EB，ZB，YB，BB来表示，它们之间的关系是：</p>
<p>位 bit (比特)(Binary Digits)：存放一位二进制数，即 0 或 1，最小的存储单位。</p>
<p>字节 byte：8个二进制位为一个字节(B)，最常用的单位。</p>
<p>1KB (Kilobyte 千字节)=1024B，</p>
<p>1MB (Megabyte 兆字节 简称“兆”)=1024KB，</p>
<p>1GB (Gigabyte 吉字节 又称“千兆”)=1024MB，</p>
<p>1TB (Trillionbyte 万亿字节 太字节)=1024GB，其中1024=2^10 ( 2 的10次方)，</p>
<p>1PB（Petabyte 千万亿字节 拍字节）=1024TB，</p>
<p>1EB（Exabyte 百亿亿字节 艾字节）=1024PB，</p>
<p>1ZB (Zettabyte 十万亿亿字节 泽字节)= 1024 EB,</p>
<p>1YB (Jottabyte 一亿亿亿字节 尧字节)= 1024 ZB,</p>
<p>1BB (Brontobyte 一千亿亿亿字节)= 1024 YB.</p>
<p>注：“兆”为百万级数量单位。</p>
<h2 id="1-4-图关系型数据库"><a href="#1-4-图关系型数据库" class="headerlink" title="1.4 图关系型数据库"></a>1.4 图关系型数据库</h2><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143972.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143972.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324154320743"></p>
<h2 id="1-5-DB-Engines数据库排名"><a href="#1-5-DB-Engines数据库排名" class="headerlink" title="1.5  DB-Engines数据库排名"></a>1.5  DB-Engines数据库排名</h2><p><a target="_blank" rel="noopener" href="http://db-engines.com/en/ranking">http://db-engines.com/en/ranking</a></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143761.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143761.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220324154446053"></p>
<h1 id="2-Redis6安装和概述"><a href="#2-Redis6安装和概述" class="headerlink" title="2.Redis6安装和概述"></a>2.Redis6安装和概述</h1><h2 id="2-1-Redis6-安装-基于ubuntu的-如果是centos-命令会有所区别"><a href="#2-1-Redis6-安装-基于ubuntu的-如果是centos-命令会有所区别" class="headerlink" title="2.1 Redis6 安装 :基于ubuntu的,如果是centos,命令会有所区别"></a>2.1 Redis6 安装 :基于ubuntu的,如果是centos,命令会有所区别</h2><h3 id="①利用XFTP将redis6的压缩包上传到linux里面"><a href="#①利用XFTP将redis6的压缩包上传到linux里面" class="headerlink" title="①利用XFTP将redis6的压缩包上传到linux里面"></a>①利用XFTP将redis6的压缩包上传到linux里面</h3><p>我是新建了一个文件夹Redis6,然后把压缩包传到里面去了</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143435.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143435.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325110513452" style="zoom:67%;" />

<h3 id="②一个小尴尬"><a href="#②一个小尴尬" class="headerlink" title="②一个小尴尬"></a>②一个小尴尬</h3><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143017.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152143017.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325114642930" style="zoom:80%;" />

<p><code>产生错误原因:</code></p>
<p>最后一步点击了关闭,而不是连接</p>
<p><code>改正:</code></p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144790.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144790.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325115847124" style="zoom:67%;" />

<hr>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144370.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144370.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325115921661" style="zoom:33%;" />

<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144354.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144354.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325120034403" style="zoom:67%;" />

<h3 id="③获取管理员权限"><a href="#③获取管理员权限" class="headerlink" title="③获取管理员权限"></a>③获取管理员权限</h3><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144263.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144263.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325120320099" style="zoom:150%;" />

<h3 id="④找到linux中的压缩文件夹"><a href="#④找到linux中的压缩文件夹" class="headerlink" title="④找到linux中的压缩文件夹"></a>④找到linux中的压缩文件夹</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144312.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144312.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325120429830"></p>
<p><code>cd redis6不要加&quot;/&quot; 路径不对</code></p>
<h3 id="⑤下载安装最新版的gcc编译器"><a href="#⑤下载安装最新版的gcc编译器" class="headerlink" title="⑤下载安装最新版的gcc编译器"></a>⑤<strong>下载安装最新版的gcc编译器</strong></h3><p><code>安装位置:</code>在放redis6的那个压缩包所在的文件夹中执行项下面命令</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144661.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144661.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325122734713"></p>
<hr>
<hr>
<p>安装C 语言的编译环境</p>
<p><code>apt install gcc</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144154.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144154.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325123228417"></p>
<hr>
<p>ok,安装成功了</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144623.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144623.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325123802136"></p>
<h3 id="⑥解压redis6的压缩文件"><a href="#⑥解压redis6的压缩文件" class="headerlink" title="⑥解压redis6的压缩文件"></a>⑥解压redis6的压缩文件</h3><p><code>tar -zxvf</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144791.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144791.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325124110385"></p>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144123.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152144123.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325124135319" style="zoom:80%;" />

<h3 id="⑦进入刚刚解压的文件夹中-用apt-install-make命令做编译"><a href="#⑦进入刚刚解压的文件夹中-用apt-install-make命令做编译" class="headerlink" title="⑦进入刚刚解压的文件夹中,用apt install make命令做编译"></a>⑦进入刚刚解压的文件夹中,用apt install make命令做编译</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145475.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145475.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325124334494"></p>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145459.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145459.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325124441529"></p>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145346.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145346.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325124605903" style="zoom:80%;" />

<h3 id="⑧安装redis"><a href="#⑧安装redis" class="headerlink" title="⑧安装redis"></a>⑧安装redis</h3><p><code>make install</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145125.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145125.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325125045058"></p>
<h3 id="⑨默认安装路径-user-local-bin"><a href="#⑨默认安装路径-user-local-bin" class="headerlink" title="⑨默认安装路径:/user/local/bin"></a>⑨默认安装路径:/user/local/bin</h3><h2 id="2-2-启动redis"><a href="#2-2-启动redis" class="headerlink" title="2.2 启动redis"></a>2.2 启动redis</h2><h3 id="①前台启动-不推荐"><a href="#①前台启动-不推荐" class="headerlink" title="①前台启动(不推荐)"></a>①前台启动(不推荐)</h3><blockquote>
<p>前台启动redis后，就不能再在输入框中输入命令，否则就会将服务端停止。</p>
</blockquote>
<p>前台启动，命令行窗口不能关闭，否则服务器停止===&gt;窗口不能再做其他操作了</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145207.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145207.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325130048320"></p>
<blockquote>
<p>前台启动redis关闭:直接Ctrl+C关闭。</p>
</blockquote>
<h3 id="②-后台启动（推荐）"><a href="#②-后台启动（推荐）" class="headerlink" title="② 后台启动（推荐）"></a>② <strong>后台启动（推荐）</strong></h3><p><code>关窗口还可以继续使用</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145246.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145246.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325130255120"></p>
<blockquote>
<p>2.进入redis6压缩包的解压文件夹中</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145492.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145492.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325130434270"></p>
<blockquote>
<p>3.将redis6压缩包的解压文件夹中的redis.conf复制一份到/etc</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145342.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145342.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325140715223"></p>
<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145476.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145476.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325143833667"></p>
<p><code>查看一下:</code></p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145490.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145490.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325144152153" style="zoom:67%;" />

<blockquote>
<p>4 .将<code>etc下</code>的文件redis.conf(128行)里面的daemonize no 改成 yes，让服务在后台启动</p>
</blockquote>
<p><code>vi redis.conf</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145492.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152145492.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325144622723"></p>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146017.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146017.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325144659834" style="zoom:50%;" />

<hr>
<p>然后就是vim编辑器界面了,我说一下怎么操作:</p>
<ol>
<li>冒号”:”进入命令模式==&gt;”/daem”来找到需要改的地方</li>
<li>“i”进入插入模式,将no修改为yes</li>
<li>“esc”退出插入模式,然后”:wq”退出vim编辑器</li>
</ol>
<blockquote>
<p>5  redis启动</p>
</blockquote>
<p><code>进bin目录下启动</code>:/usr/local/bin</p>
<p><code>redis-server /etc/redis.conf</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146792.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146792.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325164640687"></p>
<blockquote>
<p>6.查看</p>
</blockquote>
<p><code>ps -ef | grep redis</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146897.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146897.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325165029620"></p>
<p>端口号:637</p>
<blockquote>
<p>7 通过客户端连接redis</p>
</blockquote>
<p><code>bin目录下</code></p>
<p><code>redis-cli</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146606.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146606.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325165339631"></p>
<p>有ip;有端口号==&gt;连上了</p>
<blockquote>
<p>8 测试验证:ping命令</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146458.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146458.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325165712274"></p>
<blockquote>
<p>9 redis关闭</p>
</blockquote>
<blockquote>
<p> 如果是后台启动，即上面客户端连接成功后，首先输入<code>exit</code>退出redis客户端</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146330.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146330.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325165829613"></p>
<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146235.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146235.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325165911749"></p>
<blockquote>
<p>直接叉掉也可以关闭</p>
</blockquote>
<h2 id="2-3-redis概述"><a href="#2-3-redis概述" class="headerlink" title="2.3  redis概述"></a>2.3  redis概述</h2><ul>
<li>Redis是一个开源的key-value存储系统。</li>
<li> 和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set –有序集合)和hash（哈希类型）。</li>
<li> 这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。</li>
<li> 在此基础上，Redis支持各种不同方式的排序。</li>
<li> 与memcached一样，为了保证效率，数据都是缓存在内存中。</li>
<li> 区别的是Redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件。</li>
<li>并且在此基础上实现了master-slave(主从)同步</li>
</ul>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><blockquote>
<p><code>配合关系型数据库做高速缓存</code></p>
</blockquote>
<ul>
<li>高频次，热门访问的数据，降低数据库IO</li>
<li>分布式架构，做session共享</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146914.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146914.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325173758250"><br><code>多样的数据结构存储持久化数据</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146759.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146759.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325173834306"></p>
<h3 id="Redis介绍相关知识"><a href="#Redis介绍相关知识" class="headerlink" title="Redis介绍相关知识"></a><strong>Redis</strong>介绍相关知识</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146718.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152146718.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325174021435"><br><code>Redis是单线程+多路IO复用技术</code></p>
<p>多路复用是指使用一个线程来检查多个文件描述符（Socket）的就绪状态，比如调用select和poll函数，传入多个文件描述符，如果有一个文件描述符就绪，则返回，否则阻塞直到超时。得到就绪状态后进行真正的操作可以在同一个线程里执行，也可以启动线程执行（比如使用线程池）</p>
<p>串行  vs  多线程+锁（memcached） vs  单线程+多路IO复用(Redis)</p>
<p>（与Memcache三点不同: 支持多数据类型，支持持久化，单线程+多路IO复用） </p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147127.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147127.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325174133335"></p>
<h1 id="3-常用五大数据类型"><a href="#3-常用五大数据类型" class="headerlink" title="3.常用五大数据类型"></a>3.常用五大数据类型</h1><p>获得redis常见数据类型操作命令<a target="_blank" rel="noopener" href="http://www.redis.cn/commands.html">http://www.redis.cn/commands.html</a></p>
<h2 id="3-1-Redis键-key"><a href="#3-1-Redis键-key" class="headerlink" title="3.1 Redis键(key)"></a>3.1 Redis键(key)</h2><blockquote>
<p><code>keys *</code>:查看当前库所有key  (匹配：keys *1)</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147762.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147762.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325210339547"></p>
<p>刚开始是空的,为了演示效果,先认为加几条</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147873.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147873.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325210541160" style="zoom:67%;" />
放了三个

<p>接下来演示:</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147911.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147911.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325210710267"></p>
<blockquote>
<p><code>exists key</code>:判断某个key是否存在</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147715.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147715.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325210905677"><br>返回1表示存在</p>
<p>返回0表示不存在</p>
<blockquote>
<p><code>type key</code>: 查看你的key是什么类型</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147007.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147007.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325211050045"></p>
<blockquote>
<p><code>del key</code>:    删除指定的key数据</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147130.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147130.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325211211846"></p>
<blockquote>
<p><code>unlink key</code>:  根据value选择非阻塞删除</p>
</blockquote>
<p>仅将keys从keyspace元数据中删除，真正的删除会在后续异步操作。就是它告诉你删了,其实它没删,后续它再删掉</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147362.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147362.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325212304839"></p>
<blockquote>
<p><code>expire key time</code>  time秒钟：为给定的key设置过期时间</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147177.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147177.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325213030652"></p>
<blockquote>
<p><code>ttl key</code>: 查看还有多少秒过期，</p>
<p>-1表示永不过期，-2表示已过期</p>
</blockquote>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147702.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147702.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325213050562"></p>
<blockquote>
<p>select命令切换数据库</p>
</blockquote>
<p>在redis中默认有十几个数据库</p>
<p>select 15===&gt;切换到15号数据库</p>
<blockquote>
<p>dbsize查看当前数据库的key的数量</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147665.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147665.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325213513558"></p>
<blockquote>
<p>flushdb清空当前库</p>
</blockquote>
<blockquote>
<p>flushall通杀全部库</p>
</blockquote>
<h2 id="3-2-Redis字符串-String"><a href="#3-2-Redis字符串-String" class="headerlink" title="3.2 Redis字符串(String)"></a>3.2 Redis字符串(String)</h2><h3 id="3-2-1-简介"><a href="#3-2-1-简介" class="headerlink" title="3.2.1 简介"></a>3.2.1 简介</h3><ul>
<li><p>String是Redis最基本的类型，你可以理解成与Memcached一模一样的类型，一个key对应一个value。</p>
</li>
<li><p>String类型是<code>二进制安全的</code>。意味着Redis的string可以包含任何数据。比如jpg图片或者序列化的对象。<br>只要能存成字符串,都能放到里面去</p>
</li>
<li><p>String类型是Redis最基本的数据类型，一个Redis中字符串value最多可以是512M</p>
</li>
</ul>
<h3 id="3-2-2-常用命令"><a href="#3-2-2-常用命令" class="headerlink" title="3.2.2 常用命令"></a>3.2.2 常用命令</h3><blockquote>
<p>set  &lt;key&gt;&lt;value&gt;    添加键值对</p>
</blockquote>
<p><code>相同的key,后面的会覆盖前面的</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147500.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152147500.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325214323881"></p>
<p>*NX：当数据库中key不存在时，可以将key-value添加数据库</p>
<p>*XX：当数据库中key存在时，可以将key-value添加数据库，与NX参数互斥</p>
<p>*EX：key的超时秒数</p>
<p>*PX：key的超时毫秒数，与EX互斥</p>
<blockquote>
<p>get &lt;key&gt;    查询对应键值</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148202.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148202.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325214431595"></p>
<blockquote>
<p>append &lt;key&gt;&lt;value&gt;    将给定的<value> 追加到原值的末尾</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148429.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148429.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325215416059"></p>
<p><code>若key不存在,则会新建key</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148019.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148019.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325215701932"></p>
<blockquote>
<p>strlen &lt;key&gt;    获得值的长度</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148917.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148917.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325220126129"></p>
<blockquote>
<p>setnx &lt;key&gt;&lt;value&gt;      只有在 <code>key 不存在时</code>  设置 key 的值</p>
</blockquote>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148418.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148418.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325220026123"></p>
<blockquote>
<p>incr &lt;key&gt;</p>
</blockquote>
<p>将 key 中储存的数字值增1</p>
<p><code>只能对数字值</code>操作，如果为空，新增值为1</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148111.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148111.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325220355879"></p>
<blockquote>
<p>decr &lt;key&gt;</p>
</blockquote>
<p>将 key 中储存的数字值减1</p>
<p><code>只能对数字值</code>操作，如果为空，新增值为-1</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148593.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148593.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325220456241"></p>
<blockquote>
<p>incrby / decrby <key>&lt;步长&gt;将 key 中储存的数字值增减。自定义步长。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148253.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148253.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325220647752"></p>
<hr>
<p>  原子性                                                                          </p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148954.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148954.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325221001824"></p>
<p>所谓<strong>原子</strong>操作是指不会被线程调度机制打断的操作；  </p>
<p>这种操作一旦开始，就一直运行到结束，中间不会有任何 context switch （切换到另一个线程）。 </p>
<p> （1）在单线程中， 能够在单条指令中完成的操作都可以认为是”原子操作”，因为中断只能发生于指令之间。</p>
<p>  （2）在多线程中，不能被其它进程（线程）打断的操作就叫原子操作。  Redis单命令的原子性主要得益于Redis的单线程。</p>
<p>  <strong>案例：</strong>  java中的i++是否是原子操作？<strong>不是</strong></p>
<p>  i=0;两个线程分别对i进行++100次,值是多少？</p>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148862.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148862.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325221053224">             </p>
<blockquote>
<p>mset &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt; ….. </p>
</blockquote>
<p>同时设置一个或多个 key-value对 </p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148379.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148379.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325222056979"></p>
<blockquote>
<p>mget &lt;key1&gt;&lt;key2&gt;&lt;key3&gt; …..</p>
</blockquote>
<p>同时获取一个或多个 value </p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148181.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148181.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325222251321"></p>
<blockquote>
<p>msetnx &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt; ….. </p>
</blockquote>
<p>同时设置一个或多个 key-value 对，当且仅当<code>所有给定 key 都不存在</code>。</p>
<p><code>如果有key之前存在了,那就不会成功</code></p>
<p><strong>原子性，有一个失败则都失败</strong></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148466.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148466.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325222452581"></p>
<blockquote>
<p>getrange &lt;key&gt;&lt;起始位置&gt;&lt;结束位置&gt;</p>
</blockquote>
<p>获得值的范围，类似java中的substring，<strong>前包，后包</strong></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148967.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152148967.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325222650830"></p>
<blockquote>
<p>setrange &lt;key&gt;&lt;起始位置&gt;&lt;value&gt;</p>
</blockquote>
<p>用 <value> <code>覆写</code><key>所储存的字符串值，从&lt;起始位置&gt;开始(<strong>索引从0</strong>开始)。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152149188.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152149188.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220325222929277"></p>
<blockquote>
<p><strong>setex &lt;key&gt;&lt;**过期时间**&gt;&lt;value&gt;</strong></p>
</blockquote>
<p>设置键值的同时，设置过期时间，单位秒。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152149253.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152149253.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326121758655"></p>
<blockquote>
<p>getset &lt;key&gt;&lt;value&gt;</p>
</blockquote>
<p>以新换旧，设置了新值同时获得旧值。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152149762.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152149762.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326121907748"></p>
<h3 id="3-2-3-数据结构"><a href="#3-2-3-数据结构" class="headerlink" title="3.2.3 数据结构"></a>3.2.3 数据结构</h3><p>String的数据结构为简单动态字符串(Simple Dynamic String,缩写SDS)。是可以修改的字符串，内部结构实现上类似于Java的ArrayList，采用预分配冗余空间的方式来减少内存的频繁分配.</p>
<p>​      <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152149030.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152149030.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326122122264">                         </p>
<p>如图中所示，内部为当前字符串实际分配的空间capacity一般要高于实际字符串长度len。当字符串长度小于1M时，扩容都是加倍现有的空间，如果超过1M，扩容时一次只会多扩1M的空间。需要注意的是字符串最大长度为512M</p>
<h2 id="3-3-Redis列表-List"><a href="#3-3-Redis列表-List" class="headerlink" title="3.3 Redis列表(List)"></a>3.3 Redis列表(List)</h2><h3 id="3-3-1-简介"><a href="#3-3-1-简介" class="headerlink" title="3.3.1 简介"></a>3.3.1 简介</h3><p>单键多值</p>
<p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。</p>
<p>它的底层实际是个<code>双向链表</code>，对两端的操作性能很高，通过索引下标的操作中间的节点性能会较差。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150136.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150136.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326122337854"></p>
<h3 id="3-3-2-常用命令"><a href="#3-3-2-常用命令" class="headerlink" title="3.3.2  常用命令"></a>3.3.2  <strong>常用命令</strong></h3><blockquote>
<p>lpush &lt;key&gt;&lt;value1&gt;&lt;value2&gt;&lt;value3&gt; …. 从左边插入一个或多个值。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150393.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150393.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326124451932"><br><code>放的时候是v1 v2 v3但是取的时候是相反的</code></p>
<p><code>从左边开始放,后放的会把先前放的往右挤</code></p>
<p><code>取得时候从左边开始取</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150037.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150037.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326124538475"></p>
<blockquote>
<p>rpush &lt;key&gt;&lt;value1&gt;&lt;value2&gt;&lt;value3&gt; …. 从右边插入一个或多个值。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150822.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150822.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326124917026"></p>
<p><code>放的时候是v1 v2 v3但是取的时候是相反的</code></p>
<p><code>从右边开始放,后放的会把先前放的往左挤</code></p>
<p><code>取得时候从左边开始取</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150413.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150413.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326125647049"></p>
<blockquote>
<p>lpop/rpop &lt;key&gt;从左边/右边吐出一个值。值在键在，值光键亡。</p>
</blockquote>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150668.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150668.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326125910239"></p>
<blockquote>
<p>rpoplpush &lt;key1&gt;&lt;key2&gt;     从&lt;key1&gt;    列表右边吐出一个值，插到<key2>列表左边。</p>
</blockquote>
<p> 从k1右边取个值放到k2左边来</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150329.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150329.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326130247964" style="zoom:80%;" />

<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150549.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150549.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326130410016"></p>
<blockquote>
<p>lrange &lt;key&gt;&lt;start&gt;&lt;stop&gt;</p>
</blockquote>
<p>按照索引下标获得元素(从左到右)</p>
<p>lrange mylist 0 -1  0左边第一个，-1右边第一个，（0到-1表示获取所有）</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150182.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150182.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326124240229"></p>
<blockquote>
<p>lindex &lt;key&gt;&lt;index&gt;    按照索引下标获得元素(从左到右)</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150895.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150895.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326130629651"></p>
<blockquote>
<p>llen &lt;key&gt;    获得列表长度 </p>
</blockquote>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150740.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150740.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326130701723"></p>
<blockquote>
<p>linsert &lt;key&gt; before &lt;value&gt;&lt;newvalue&gt;        在&lt;value&gt;的后面插入<newvalue>插入值</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150317.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150317.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326130955239"></p>
<blockquote>
<p>lrem &lt;key&gt;&lt;n&gt;&lt;value&gt;        从左边删除n个value(从左到右)</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150670.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152150670.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326131256762"></p>
<blockquote>
<p>lset&lt;key&gt;&lt;index&gt;&lt;value&gt;            将列表key下标为index的值替换成value  <code>从零开始</code></p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151672.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151672.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326131424325"></p>
<h3 id="3-3-3-数据结构"><a href="#3-3-3-数据结构" class="headerlink" title="3.3.3 数据结构"></a>3.3.3 数据结构</h3><p>List的数据结构为快速链表quickList。</p>
<p>首先在列表元素较少的情况下会使用一块连续的内存存储，这个结构是ziplist，也即是压缩列表。</p>
<p>它将所有的元素紧挨着一起存储，分配的是一块连续的内存。</p>
<p>当数据量比较多的时候才会改成quicklist。</p>
<p>因为普通的链表需要的附加指针空间太大，会比较浪费空间。比如这个列表里存的只是int类型的数据，结构上还需要两个额外的指针prev和next。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151271.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151271.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326122457269">                               </p>
<p>Redis将链表和ziplist结合起来组成了quicklist。也就是将多个ziplist使用双向指针串起来使用。这样既满足了快速的插入删除性能，又不会出现太大的空间冗余。</p>
<h2 id="3-4-Redis集合-Set"><a href="#3-4-Redis集合-Set" class="headerlink" title="3.4 Redis集合(Set)"></a>3.4 Redis集合(Set)</h2><h3 id="3-4-1-简介"><a href="#3-4-1-简介" class="headerlink" title="3.4.1 简介"></a>3.4.1 简介</h3><p>Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以**<code>自动排重</code>**的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。</p>
<p>Redis的Set是string类型的无序集合。它底层其实是一个value为null的hash表，所以添加，删除，查找的<strong>复杂度都是</strong>O(1)。</p>
<p>一个算法，随着数据的增加，执行时间的长短，如果是O(1)，数据增加，查找数据的时间不变</p>
<h3 id="3-4-2-常用命令"><a href="#3-4-2-常用命令" class="headerlink" title="3.4.2 常用命令"></a>3.4.2 常用命令</h3><blockquote>
<p>sadd &lt;key&gt;&lt;value1&gt;&lt;value2&gt; ….. </p>
</blockquote>
<p>将一个或多个 member 元素加入到集合 key 中，已经存在的 member 元素将被忽略</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151217.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151217.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326131922788"></p>
<blockquote>
<p>smembers &lt;key&gt;取出该集合的所有值。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151088.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151088.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326131924605"></p>
<blockquote>
<p>sismember&lt;key&gt;&lt;value&gt;判断集合<key>是否为含有该&lt;value&gt;值，有1，没有0</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151890.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151890.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326132022042"></p>
<blockquote>
<p>scard&lt;key&gt;返回该集合的元素个数。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151609.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151609.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326132236318"></p>
<blockquote>
<p>srem &lt;key&gt;&lt;value1&gt;&lt;value2&gt; …. 删除集合中的某个元素。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151309.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151309.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326132320795"></p>
<blockquote>
<p>spop &lt;key&gt;<strong>随机从该集合中吐出一个值。</strong>  <code>取出之后就删掉了</code></p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151733.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151733.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326132458115"></p>
<blockquote>
<p>srandmember  &lt;key&gt;&lt;n&gt;<code>随机</code>从该集合中取出n个值。不会从集合中删除 。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151981.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151981.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326132614190"></p>
<blockquote>
<p>smove &lt;source&gt;&lt;destination&gt;value把集合中一个值从一个集合移动到另一个集合</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151932.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151932.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326132917763"></p>
<blockquote>
<p>sinter &lt;key1&gt;&lt;key2&gt;返回两个集合的交集元素。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151134.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151134.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326133209217"></p>
<blockquote>
<p>sunion &lt;key1&gt;&lt;key2&gt;返回两个集合的并集元素。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151805.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151805.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326133244860"></p>
<blockquote>
<p>sdiff &lt;key1&gt;&lt;key2&gt;返回两个集合的<strong>差集</strong>元素(key1中的，不包含key2中的)</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151140.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152151140.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326133304380"></p>
<h3 id="3-4-3-数据结构"><a href="#3-4-3-数据结构" class="headerlink" title="3.4.3 数据结构"></a>3.4.3 数据结构</h3><p>Set数据结构是dict字典，字典是用哈希表实现的。</p>
<p>Java中HashSet的内部实现使用的是HashMap，只不过所有的value都指向同一个对象。Redis的set结构也是一样，它的内部也使用hash结构，所有的value都指向同一个内部值</p>
<h2 id="3-5-Redis哈希-Hash"><a href="#3-5-Redis哈希-Hash" class="headerlink" title="3.5  Redis哈希(Hash)"></a>3.5  Redis哈希(Hash)</h2><h3 id="3-5-1-简介"><a href="#3-5-1-简介" class="headerlink" title="3.5.1 简介"></a>3.5.1 简介</h3><p>Redis hash 是一个键值对集合。</p>
<p>Redis hash是一个string类型的field和value的映射表，<code>hash特别适合用于存储对象</code>。</p>
<p>类似Java里面的<code>Map&lt;String,Object&gt;</code></p>
<p>用户ID为查找的key，存储的value用户对象包含姓名，年龄，生日等信息，如果用普通的key/value结构来存储<br><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152152385.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152152385.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326133629604"></p>
<p>主要有以下2种存储方式：</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152152356.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152152356.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326123146761"></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152152251.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152152251.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326133956073"></p>
<h3 id="3-5-2-常用命令"><a href="#3-5-2-常用命令" class="headerlink" title="3.5.2 常用命令"></a>3.5.2 常用命令</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153138.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153138.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326134653943"></p>
<blockquote>
<p>hset &lt;key&gt;&lt;field&gt;&lt;value&gt;给&lt;key&gt;集合中的 &lt;field&gt;键赋值&lt;value&gt;</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153308.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153308.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326134644344"></p>
<blockquote>
<p>hget &lt;key1&gt;&lt;field&gt;从&lt;key1&gt;集合&lt;field&gt;取出 value </p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153905.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153905.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326134704852"></p>
<blockquote>
<p>hmset &lt;key1&gt;&lt;field1&gt;&lt;value1&gt;&lt;field2&gt;&lt;value2&gt;… 批量设置hash的值</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153687.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153687.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326134811197"></p>
<blockquote>
<p>hexists&lt;key1&gt;&lt;field&gt;查看哈希表 key 中，给定域 field 是否存在。 </p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153242.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153242.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326134934855"></p>
<blockquote>
<p>hkeys &lt;key&gt;列出该hash集合的所有field</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153766.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153766.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326135023210"></p>
<blockquote>
<p>hvals &lt;key&gt;列出该hash集合的所有value</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153621.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153621.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326135058708"></p>
<blockquote>
<p>hincrby &lt;key&gt;&lt;field&gt;&lt;increment&gt;为哈希表 key 中的域 field 的值加上增量 1  -1</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153025.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153025.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326135154143"></p>
<blockquote>
<p>hsetnx &lt;key&gt;&lt;field&gt;&lt;value&gt;将哈希表 key 中的域 field 的值设置为 value ，<code>当且仅当域 field 不存在</code> .</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153887.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152153887.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326135418255"></p>
<h3 id="3-5-3-数据结构"><a href="#3-5-3-数据结构" class="headerlink" title="3.5.3 数据结构"></a>3.5.3 数据结构</h3><p>Hash类型对应的数据结构是两种：ziplist（压缩列表），hashtable（哈希表）。当field-value长度较短且个数较少时，使用ziplist，否则使用hashtable</p>
<h2 id="3-6-Redis有序Zset-sorted-set"><a href="#3-6-Redis有序Zset-sorted-set" class="headerlink" title="3.6 Redis有序Zset(sorted set)"></a>3.6 Redis有序Zset(sorted set)</h2><h3 id="3-6-1-简介"><a href="#3-6-1-简介" class="headerlink" title="3.6.1 简介"></a>3.6.1 简介</h3><p>Redis有序集合zset与普通集合set非常相似，是一个<code>没有重复元素</code>的字符串集合。</p>
<p>不同之处是有序集合的每个成员都关联了一个**<code>评分</code>（**score）,这个评分（score）被用来按照从最低分到最高分的方式排序集合中的成员。集合的成员是唯一的，但是<code>评分可以是重复了</code> 。</p>
<p>因为元素是有序的, 所以你也可以很快的根据评分（score）或者次序（position）来获取一个范围的元素。</p>
<p>访问有序集合的中间元素也是非常快的,因此你能够使用有序集合作为一个没有重复成员的智能列表。</p>
<h3 id="3-6-2-常用命令"><a href="#3-6-2-常用命令" class="headerlink" title="3.6.2 常用命令"></a>3.6.2 常用命令</h3><blockquote>
<p>zadd &lt;key&gt;&lt;score1&gt;&lt;value1&gt;&lt;score2&gt;&lt;value2&gt;…</p>
</blockquote>
<p>将一个或多个 member 元素及其 score 值加入到有序集 key 当中。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154608.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154608.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326140452604"></p>
<blockquote>
<p><strong>zrange &lt;key&gt;&lt;start&gt;&lt;stop&gt; [WITHSCORES]</strong>    从小到大</p>
</blockquote>
<p>返回<code>有序</code>集 key 中，下标在&lt;start&gt;&lt;stop&gt;之间的元素</p>
<p>带WITHSCORES，可以让分数一起和值返回到结果集。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154776.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154776.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326140535867"></p>
<blockquote>
<p>zrangebyscore key minmax [withscores] [limit offset count]</p>
</blockquote>
<p>返回有序集 key 中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。有序集成员按 score 值递增(从小到大)次序排列。 </p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154586.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154586.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326140658908"></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154852.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154852.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326140911694"></p>
<blockquote>
<p>zrevrangebyscore key maxmin [withscores] [limit offset count]        </p>
</blockquote>
<p>同上，改为从大到小排列。 </p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154843.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154843.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326141103225"></p>
<blockquote>
<p>zincrby &lt;key&gt;&lt;increment&gt;&lt;value&gt;   为元素的score加上增量</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154113.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154113.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326141200281"></p>
<blockquote>
<p>zrem &lt;key&gt;&lt;value&gt;删除该集合下，指定值的元素</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154676.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154676.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326141252057"></p>
<blockquote>
<p>zcount &lt;key&gt;&lt;min&gt;&lt;max&gt;统计该集合，分数区间内的元素个数 </p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154129.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154129.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326141329953"></p>
<blockquote>
<p>zrank &lt;key&gt;&lt;value&gt;返回该值在集合中的排名，<code>从0开始</code>。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154822.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154822.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326141617796"></p>
<p>案例：如何利用zset实现一个文章访问量的排行榜？</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154595.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154595.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326123427027"></p>
<h3 id="3-6-3-数据结构"><a href="#3-6-3-数据结构" class="headerlink" title="3.6.3 数据结构"></a>3.6.3 数据结构</h3><p>SortedSet(zset)是Redis提供的一个非常特别的数据结构，一方面它等价于Java的数据结构Map&lt;String, Double&gt;，可以给每一个元素value赋予一个权重score，另一方面它又类似于TreeSet，内部的元素会按照权重score进行排序，可以得到每个元素的名次，还可以通过score的范围来获取元素的列表。</p>
<p>zset底层使用了两个数据结构</p>
<p>（1）hash，hash的作用就是关联元素value和权重score，保障元素value的唯一性，可以通过元素value找到相应的score值。</p>
<p>（2）跳跃表，跳跃表的目的在于给元素value排序，根据score的范围获取元素列表。</p>
<h3 id="3-6-4-跳跃表"><a href="#3-6-4-跳跃表" class="headerlink" title="3.6.4 跳跃表"></a>3.6.4 跳跃表</h3><h4 id="①简介"><a href="#①简介" class="headerlink" title="①简介"></a>①简介</h4><p>有序集合在生活中比较常见，例如根据成绩对学生排名，根据得分对玩家排名等。对于有序集合的底层实现，可以用数组、平衡树、链表等。数组不便元素的插入、删除；平衡树或红黑树虽然效率高但结构复杂；链表查询需要遍历所有效率低。Redis采用的是跳跃表。跳跃表效率堪比红黑树，实现远比红黑树简单。</p>
<h4 id="②实例"><a href="#②实例" class="headerlink" title="②实例"></a>②实例</h4><p>对比有序链表和跳跃表，从链表中查询出51</p>
<p><code>有序链表</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154601.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154601.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326141754430"><br>要查找值为51的元素，需要从第一个元素开始依次查找、比较才能找到。共需要6次比较</p>
<p><code>跳跃表</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154984.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152154984.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326141825818"></p>
<p>从第2层开始，1节点比51节点小，向后比较。</p>
<p>21节点比51节点小，继续向后比较，后面就是NULL了，所以从21节点向下到第1层</p>
<p>在第1层，41节点比51节点小，继续向后，61节点比51节点大，所以从41向下</p>
<p>在第0层，51节点为要查找的节点，节点被找到，共查找4次。</p>
<p>从此可以看出跳跃表比有序链表效率要高</p>
<h1 id="4-Redis6配置文件-redis-conf-详解"><a href="#4-Redis6配置文件-redis-conf-详解" class="headerlink" title="4.Redis6配置文件(redis.conf)详解"></a>4.Redis6配置文件(redis.conf)详解</h1><h2 id="4-1-Units单位"><a href="#4-1-Units单位" class="headerlink" title="4.1 Units单位"></a>4.1 Units单位</h2><blockquote>
<p>配置大小单位,开头定义了一些基本的度量单位，只支持bytes，不支持bit</p>
<p>大小写不敏感</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155354.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155354.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326155726577"></p>
<hr>
<h2 id="4-2-INCLUDES包含"><a href="#4-2-INCLUDES包含" class="headerlink" title="4.2  INCLUDES包含"></a>4.2  INCLUDES包含</h2><blockquote>
<p>类似jsp中的include，多实例的情况可以把公用的配置文件提取出来</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155760.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155760.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326160542289"></p>
<h2 id="4-3-网络相关配置"><a href="#4-3-网络相关配置" class="headerlink" title="4.3   网络相关配置"></a>4.3   网络相关配置</h2><h3 id="4-3-1-bind"><a href="#4-3-1-bind" class="headerlink" title="4.3.1 bind"></a>4.3.1 bind</h3><p>默认情况bind=127.0.0.1<code>只能接受本机</code>的访问请求</p>
<p><code>不写的情况下，无限制接受任何ip地址的访问</code></p>
<p>生产环境肯定要写你应用服务器的地址；服务器是需要远程访问的，所以需要将其注释掉</p>
<blockquote>
<p>如果开启了protected-mode，那么在没有设定bind ip且没有设密码的情况下，Redis只允许接受本机的响应</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155191.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155191.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326161416106"></p>
<p>把76行注掉(前面加#)</p>
<p><code>保存配置，停止服务，重启启动查看进程，不再是本机访问了。</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155058.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155058.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326161638688"></p>
<h3 id="4-3-2-protected-mode"><a href="#4-3-2-protected-mode" class="headerlink" title="4.3.2   protected-mode"></a>4.3.2   <strong>p</strong>rotected-<strong>mode</strong></h3><blockquote>
<p>将本机访问保护模式设置no</p>
</blockquote>
<p><code>将下面95行的yes改成no</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155846.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155846.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326161931757"></p>
<h3 id="4-3-3-Port"><a href="#4-3-3-Port" class="headerlink" title="4.3.3 Port"></a>4.3.3 Port</h3><blockquote>
<p>端口号，默认 6379</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155167.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155167.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326162159101"></p>
<h3 id="4-3-4-tcp-backlog"><a href="#4-3-4-tcp-backlog" class="headerlink" title="4.3.4   tcp-backlog"></a>4.3.4   <strong>t</strong>cp-backlog</h3><blockquote>
<p>设置tcp的backlog，backlog其实是一个连接队列，backlog队列总和=未完成三次握手队列 + 已经完成三次握手队列。</p>
</blockquote>
<p>在高并发环境下你需要一个高backlog值来避免慢客户端连接问题。</p>
<p>注意Linux内核会将这个值减小到/proc/sys/net/core/somaxconn的值（128），所以需要确认增大/proc/sys/net/core/somaxconn和/proc/sys/net/ipv4/tcp_max_syn_backlog（128）两个值来达到想要的效果</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155974.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155974.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326162345566"></p>
<h3 id="4-3-5-timeout"><a href="#4-3-5-timeout" class="headerlink" title="4.3.5 timeout"></a>4.3.5 timeout</h3><blockquote>
<p>一个空闲的客户端维持多少秒会关闭，0表示关闭该功能。即<code>永不关闭</code>。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155812.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155812.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326162728294"></p>
<h3 id="4-3-6-tcp-keepalive"><a href="#4-3-6-tcp-keepalive" class="headerlink" title="4.3.6   tcp-keepalive"></a>4.3.6   <strong>t</strong>cp-keepalive</h3><blockquote>
<p>对访问客户端的一种<code>心跳检测</code>，每隔n秒检测一次。</p>
</blockquote>
<p>单位为秒，如果设置为0，则不会进行Keepalive检测，建议设置成60 </p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155045.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155045.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326163140548"></p>
<h2 id="4-4-GENERAL通用"><a href="#4-4-GENERAL通用" class="headerlink" title="4.4  GENERAL通用"></a>4.4  GENERAL通用</h2><h3 id="4-4-1-daemonize"><a href="#4-4-1-daemonize" class="headerlink" title="4.4.1  daemonize"></a>4.4.1  daemonize</h3><p>是否为后台进程，设置为yes</p>
<blockquote>
<p>守护进程，后台启动</p>
</blockquote>
<p>将248行的no<code>改成yes</code>,这样就可以后台启动了</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155273.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155273.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326163743902"></p>
<h3 id="4-4-2-pidfile"><a href="#4-4-2-pidfile" class="headerlink" title="4.4.2  pidfile"></a>4.4.2  <strong>pidfile</strong></h3><blockquote>
<p>存放pid文件的位置，每个实例会产生一个不同的pid文件</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155452.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152155452.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326164652133"></p>
<h3 id="4-4-3-loglevel"><a href="#4-4-3-loglevel" class="headerlink" title="4.4.3   loglevel"></a>4.4.3   <strong>loglevel</strong></h3><blockquote>
<p>指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为<strong>notice</strong></p>
</blockquote>
<p>四个级别根据使用阶段来选择，生产环境选择notice 或者warning</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156205.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156205.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326164909613"></p>
<h3 id="4-4-4-logfile"><a href="#4-4-4-logfile" class="headerlink" title="4.4.4 logfile"></a>4.4.4 <strong>logfile</strong></h3><blockquote>
<p>日志文件名称</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156089.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156089.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326165047322"></p>
<h3 id="4-4-5-databases-16"><a href="#4-4-5-databases-16" class="headerlink" title="4.4.5  databases 16"></a>4.4.5  <strong>databases</strong> 16</h3><blockquote>
<p><code>设定库的数量 默认16</code>，默认数据库为0，可以使用SELECT <dbid>命令在连接上指定数据库id</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156912.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156912.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326165322903"></p>
<h2 id="4-5-SECURITY-安全"><a href="#4-5-SECURITY-安全" class="headerlink" title="4.5 SECURITY 安全"></a>4.5 SECURITY 安全</h2><h3 id="4-5-1-设置密码"><a href="#4-5-1-设置密码" class="headerlink" title="4.5.1 设置密码"></a>4.5.1 设置密码</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156461.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156461.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326170030383"></p>
<p>访问密码的查看、设置和取消</p>
<p>在命令中设置密码，只是临时的。重启redis服务器，密码就还原了。</p>
<p>永久设置，需要再配置文件中进行设置。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156263.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156263.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326170043063"></p>
<h2 id="4-6-LIMITS限制"><a href="#4-6-LIMITS限制" class="headerlink" title="4.6 LIMITS限制"></a>4.6 LIMITS限制</h2><h3 id="4-6-1-maxclients"><a href="#4-6-1-maxclients" class="headerlink" title="4.6.1   maxclients"></a>4.6.1   <strong>m</strong>axclients</h3><ul>
<li><p>设置redis同时可以与多少个客户端进行连接。</p>
</li>
<li><p> 默认情况下为10000个客户端。</p>
</li>
<li><p>如果达到了此限制，redis则会拒绝新的连接请求，并且向这些连接请求方发出“max number of clients reached”以作回应。</p>
</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156131.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156131.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326170241644"></p>
<h3 id="4-6-2-maxmemory"><a href="#4-6-2-maxmemory" class="headerlink" title="4.6.2  maxmemory"></a>4.6.2  <strong>m</strong>axmemory</h3><ul>
<li><p>建议<strong>必须设置</strong>，否则，将内存占满，造成服务器宕机</p>
</li>
<li><p>设置redis可以使用的内存量。一旦到达内存使用上限，redis将会试图移除内部数据，移除规则可以通过axmemory-policy来指定。</p>
</li>
<li><p>如果redis无法根据移除规则来移除内存中的数据，或者设置了“不允许移除”，那么redis则会针对那些需要申请内存的指令返回错误信息，比如SET、LPUSH等。</p>
</li>
<li><p>但是对于无内存申请的指令，仍然会正常响应，比如GET等。如果你的redis是主redis（说明你的redis有从redis），那么在设置内存使用上限时，需要在系统中留出一些内存空间给同步队列缓存，只有在你设置的是“不移除”的情况下，才不用考虑这个因素。</p>
</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156035.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156035.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326170349127"></p>
<h3 id="4-6-3-maxmemory-policy"><a href="#4-6-3-maxmemory-policy" class="headerlink" title="4.6.3 maxmemory-policy"></a>4.6.3 <strong>m</strong>axmemory-policy</h3><ul>
<li><p>volatile-lru：使用LRU算法移除key，只对设置了过期时间的键；（最近最少使用）</p>
</li>
<li><p> allkeys-lru：在所有集合key中，使用LRU算法移除key</p>
</li>
<li><p>volatile-random：在过期集合中移除随机的key，只对设置了过期时间的键</p>
</li>
<li><p>allkeys-random：在所有集合key中，移除随机的key</p>
</li>
<li><p>volatile-ttl：移除那些TTL值最小的key，即那些最近要过期的key</p>
</li>
<li><p>noeviction：不进行移除。针对写操作，只是返回错误信息</p>
</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156023.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156023.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326170544353"></p>
<h3 id="4-6-4-maxmemory-samples"><a href="#4-6-4-maxmemory-samples" class="headerlink" title="4.6.4  maxmemory-samples"></a>4.6.4  <strong>m</strong>axmemory-samples</h3><ul>
<li><p>设置样本数量，LRU算法和最小TTL算法都并非是精确的算法，而是估算值，所以你可以设置样本的大小，redis默认会检查这么多个key并选择其中LRU的那个。</p>
</li>
<li><p>一般设置3到7的数字，数值越小样本越不准确，但性能消耗越小。</p>
</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156364.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156364.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326170638539"></p>
<h1 id="5-Redis6的发布和订阅"><a href="#5-Redis6的发布和订阅" class="headerlink" title="5.Redis6的发布和订阅"></a>5.Redis6的发布和订阅</h1><h2 id="5-1-什么是发布和订阅"><a href="#5-1-什么是发布和订阅" class="headerlink" title="5.1  什么是发布和订阅"></a>5.1  什么是发布和订阅</h2><p>Redis 发布订阅 (pub/sub) 是一种消息通信模式：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。</p>
<p>Redis 客户端可以订阅任意数量的频道</p>
<h2 id="5-2-Redis6的发布和订阅"><a href="#5-2-Redis6的发布和订阅" class="headerlink" title="5.2 Redis6的发布和订阅"></a>5.2 Redis6的发布和订阅</h2><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156130.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156130.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326170833380"></p>
<h2 id="5-3-发布订阅命令行实现"><a href="#5-3-发布订阅命令行实现" class="headerlink" title="5.3 发布订阅命令行实现"></a>5.3 发布订阅命令行实现</h2><blockquote>
<p>① 打开一个客户端订阅channel1</p>
</blockquote>
<p><code>SUBSCRIBE channel1</code></p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156324.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152156324.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326172902688" style="zoom:80%;" />

<blockquote>
<p>② 打开另一个客户端，给channel1发布消息hello</p>
</blockquote>
<p><code>publish channel1 hello</code></p>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157680.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157680.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326171944038" style="zoom:50%;" />

<hr>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157668.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157668.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326173110362" style="zoom:80%;" />

<p><code>返回的1是订阅者数量</code></p>
<blockquote>
<p>③ 打开第一个客户端可以看到发送的消息</p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157807.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157807.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326173255475" style="zoom:80%;" />

<p>注：发布的消息没有持久化，如果在订阅的客户端收不到hello，只能收到订阅后发布的消息</p>
<h1 id="6-Redis新数据类型"><a href="#6-Redis新数据类型" class="headerlink" title="6.  Redis新数据类型"></a>6.  Redis新数据类型</h1><h2 id="6-1-Bitmaps-进行位操作"><a href="#6-1-Bitmaps-进行位操作" class="headerlink" title="6. 1 Bitmaps   进行位操作"></a>6. 1 Bitmaps   进行位操作</h2><h3 id="6-1-1-简介"><a href="#6-1-1-简介" class="headerlink" title="6.1.1 简介"></a>6.1.1 简介</h3><p>现代计算机用二进制（位） 作为信息的基础单位， <code>1个字节等于8位</code>， 例如“abc”字符串是由3个字节组成， 但实际在计算机存储时将其用二进制表示， “abc”分别对应的ASCII码分别是97、 98、 99， 对应的二进制分别是01100001、 01100010和01100011，如下图</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157725.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157725.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220502574">合<br>理地使用操作位能够有效地提高内存使用率和开发效率。</p>
<p>   Redis提供了Bitmaps这个“数据类型”可以实现对<code>位的操作</code>：</p>
<p>（1）  Bitmaps<code>本身不是一种数据类型</code>， <code>实际上它就是字符串（key-value）</code> ， 但是它<code>可以对字符串的位进行操作</code>。</p>
<p>（2）  Bitmaps单独提供了一套命令， 所以在Redis中使用Bitmaps和使用字符串的方法不太相同。 可以把<code>Bitmaps想象成一个以位为单位的数组</code>， <code>数组的每个单元只能存储0和1</code>， <code>数组的下标在Bitmaps中叫做偏移量</code>。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157381.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157381.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220519808"></p>
<h3 id="6-1-2-命令"><a href="#6-1-2-命令" class="headerlink" title="6.1.2 命令"></a>6.1.2 命令</h3><blockquote>
<p>1、setbit</p>
</blockquote>
<p>（1）格式</p>
<p><code>setbit&lt;key&gt;&lt;offset&gt;&lt;value&gt;</code>设置Bitmaps中某个偏移量的值（0或1）</p>
<p>​                      <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157235.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157235.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327144015604">         </p>
<p>*offset:<code>偏移量(下标)从0开始</code></p>
<p>（2）实例</p>
<p>每个独立用户是否访问过网站存放在Bitmaps中， <code>将访问的用户记做1， 没有访问的用户记做0， 用偏移量作为用户的id</code>。</p>
<p>设置键的第offset个位的值（从0算起） ， 假设现在有20个用户，userid=1， 6， 11， 15， 19的用户对网站进行了访问， 那么当前Bitmaps初始化结果如图</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157831.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157831.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220605710"></p>
<p>unique:users:20201106代表2020-11-06这天的独立访问用户的Bitmaps</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157112.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157112.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220619305"></p>
<p>注：</p>
<p>很多应用的用户id以一个指定数字（例如10000） 开头， 直接将用户id和Bitmaps的偏移量对应势必会造成一定的浪费， <code>通常的做法是每次做setbit操作时将用户id减去这个指定数字</code>。</p>
<p>在第一次初始化Bitmaps时， 假如偏移量非常大， 那么整个初始化过程执行会比较慢， 可能会造成Redis的阻塞。</p>
<blockquote>
<p>2、getbit</p>
</blockquote>
<p>（1）格式</p>
<p><code>getbit&lt;key&gt;&lt;offset&gt;获取Bitmaps中某个偏移量的值</code></p>
<p>获取键的第offset位的值（<code>从0开始算</code>）</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157460.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157460.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327144357061"> </p>
<p>（2）实例</p>
<p>获取id=8的用户是否在2020-11-06这天访问过， 返回0说明没有访问过：</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157626.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157626.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220659592"></p>
<p>注：因为100根本<code>不存在，所以也是返回0</code></p>
<blockquote>
<p>3、bitcount</p>
</blockquote>
<p><code>统计字符串被设置为1的bit数</code>。一般情况下，给定的整个字符串都会被进行计数，通过指定额外的 start 或 end 参数，可以让计数只在特定的位上进行。start 和 end 参数的设置，都可以使用负数值：比如 -1 表示最后一个位，而 -2 表示倒数第二个位，start、end 是指bit组的字节的下标数，二者皆包含。</p>
<p>（1）格式</p>
<p><code>bitcount&lt;key&gt;[start end]</code> 统计字符串从start字节到end字节比特值为1的数量</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157409.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157409.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327144528739"></p>
<p>（2）实例</p>
<ul>
<li>计算2022-11-06这天的独立访问用户数量</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157956.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152157956.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220736322"></p>
<ul>
<li>start和end代表起始和结束字节数， 下面操作计算用户<code>id在第1个字节到第3个字节之间的独立访问用户数</code>， 对应的用户id是11， 15， 19。</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158374.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158374.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220752658"></p>
<p>举例： K1 【01000001 01000000 00000000 00100001】，对应【0，1，2，3】</p>
<p>bitcount K1 1 2 ： 统计下标1、2字节组中bit=1的个数，即01000000 00000000</p>
<p>–》bitcount K1 1 2 　　–》1</p>
<p>bitcount K1 1 3 ： 统计下标1、2字节组中bit=1的个数，即01000000 00000000 00100001</p>
<p>–》bitcount K1 1 3　　–》3</p>
<p>bitcount K1 0 -2 ： 统计下标0到下标倒数第2，字节组中bit=1的个数，即01000001 01000000  00000000</p>
<p>–》bitcount K1 0 -2　　–》3</p>
<p> 注意：redis的setbit设置或清除的是bit位置，而bitcount计算的是byte位置。</p>
<blockquote>
<p>4、bitop</p>
</blockquote>
<p>(1)格式</p>
<p>bitop and(or/not/xor) <destkey> [key…]</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">bitop <span class="token operator">and</span> unique<span class="token operator">:</span>users<span class="token operator">:</span><span class="token operator">and</span><span class="token operator">:</span><span class="token number">20201104_03</span>

unique<span class="token operator">:</span>users<span class="token operator">:</span>20201103unique<span class="token operator">:</span>users<span class="token operator">:</span><span class="token number">2020110</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p>​             <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158312.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158312.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220820373">                  </p>
<p>bitop是一个复合操作， 它可以<code>做多个Bitmaps的and（交集） 、 or（并集） 、 not（非） 、 xor（异或） 操作并将结果保存在destkey中</code>。</p>
<blockquote>
<p>(2)实例</p>
</blockquote>
<p>2020-11-04 日访问网站的userid=1,2,5,9</p>
<p>setbit unique:users:20201104 1 1</p>
<p>setbit unique:users:20201104 2 1</p>
<p>setbit unique:users:20201104 5 1</p>
<p>setbit unique:users:20201104 9 1</p>
<p>2020-11-03 日访问网站的userid=0,1,4,9。</p>
<p>setbit unique:users:20201103 0 1</p>
<p>setbit unique:users:20201103 1 1</p>
<p>setbit unique:users:20201103 4 1</p>
<p>setbit unique:users:20201103 9 1</p>
<p>计算出两天都访问过网站的用户数量</p>
<p><code>bitop and unique:users:and:20201104_03</code></p>
<p> <code>unique:users:20201103unique:users:20201104</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158745.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158745.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220844326"></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158631.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158631.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220853378"></p>
<p>计算出任意一天都访问过网站的用户数量（例如月活跃就是类似这种） ， 可以使用or求并集</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158799.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158799.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220907510"></p>
<h3 id="6-1-3-Bitmaps与set对比"><a href="#6-1-3-Bitmaps与set对比" class="headerlink" title="6.1.3    Bitmaps与set对比"></a>6.1.3    <strong>Bitmaps</strong>与set对比</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158098.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158098.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326220948038"></p>
<p><img src="C:\Users\郁孤台下清江水\AppData\Roaming\Typora\typora-user-images\image-20220326221012183.png" class="lazyload placeholder" data-srcset="C:\Users\郁孤台下清江水\AppData\Roaming\Typora\typora-user-images\image-20220326221012183.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326221012183"></p>
<h2 id="6-2-HyperLogLog"><a href="#6-2-HyperLogLog" class="headerlink" title="6.2  HyperLogLog"></a>6.2  HyperLogLog</h2><h3 id="6-2-1-简介"><a href="#6-2-1-简介" class="headerlink" title="6.2.1 简介"></a>6.2.1 简介</h3><p>在工作当中，我们经常会遇到与<code>统计相关的功能需求</code>，比如统计网站PV（PageView页面访问量）,可以使用Redis的incr、incrby轻松实现。</p>
<p>但像<code>UV（UniqueVisitor，独立访客）、独立IP数、搜索记录数等需要去重和计数的问题</code>如何解决？这种<code>求集合中不重复元素个数的问题称为基数问题</code>。</p>
<p>解决基数问题有很多种方案：</p>
<p>（1）数据存储在MySQL表中，使用<code>distinct count</code>计算不重复个数</p>
<p>（2）使用Redis提供的<code>hash、set、bitmaps</code>等数据结构来处理</p>
<p>以上的方案结果精确，但随着数据不断增加，导致占用空间越来越大，<code>对于非常大 的数据集是不切实际的</code>。</p>
<p>能否能够<code>降低一定的精度来平衡存储空间</code>？<code>Redis推出了HyperLogLog</code></p>
<p><code>Redis HyperLogLog 是用来做基数统计的算法</code>，HyperLogLog 的优点是，<code>在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的</code>。</p>
<p><code>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</code></p>
<p>但是，因为 <code>HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</code></p>
<p>什么是基数?</p>
<p><code>比如数据集 &#123;1, 3, 5, 7, 5, 7, 8&#125;， 那么这个数据集的基数集为 &#123;1, 3, 5 ,7, 8&#125;, 基数(不重复元素)为5。 基数估计就是在误差可接受的范围内，快速计算基数</code>。</p>
<h3 id="6-2-2-命令"><a href="#6-2-2-命令" class="headerlink" title="6.2.2 命令"></a>6.2.2 命令</h3><blockquote>
<p>1、pfadd </p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158641.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152158641.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326221244431"></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159528.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159528.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327150458340"></p>
<p><code>自动去重</code></p>
<blockquote>
<p>2、pfcount</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159017.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159017.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326221302854"></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159937.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159937.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327150556437"></p>
<blockquote>
<p>3、pfmerge</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159937.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159937.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326221321698"></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159896.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159896.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326221332300"></p>
<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159961.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152159961.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327151209407"></p>
<h2 id="6-3-Geospatial"><a href="#6-3-Geospatial" class="headerlink" title="6.3   Geospatial"></a>6.3   Geospatial</h2><h3 id="6-3-1-简介"><a href="#6-3-1-简介" class="headerlink" title="6.3.1 简介"></a>6.3.1 简介</h3><p>Redis 3.2 中增加了对GEO类型的支持。GEO，Geographic，<code>地理信息的缩写</code>。该类型，就是<code>元素的2维坐标，在地图上就是经纬度</code>。redis基于该类型，<code>提供了经纬度设置，查询，范围查询，距离查询，经纬度Hash等常见操作</code>。</p>
<h3 id="6-3-2-命令"><a href="#6-3-2-命令" class="headerlink" title="6.3.2 命令"></a>6.3.2 命令</h3><blockquote>
<p>1、geoadd</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200938.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200938.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326221623529"></p>
<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200602.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200602.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327151648226"></p>
<blockquote>
<p>2、geopos</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200141.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200141.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326221641037"></p>
<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200908.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200908.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327151929280"></p>
<blockquote>
<p>3、geodist</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200705.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200705.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326221704415"></p>
<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200958.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200958.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327152144950"></p>
<blockquote>
<p>4、georadius</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200929.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200929.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326221725821"></p>
<p><img src="C:\Users\郁孤台下清江水\AppData\Roaming\Typora\typora-user-images\image-20220326221731085.png" class="lazyload placeholder" data-srcset="C:\Users\郁孤台下清江水\AppData\Roaming\Typora\typora-user-images\image-20220326221731085.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326221731085"></p>
<hr>
<hr>
<h1 id="7-Jedis操作Redis6"><a href="#7-Jedis操作Redis6" class="headerlink" title="7.Jedis操作Redis6"></a>7.Jedis操作Redis6</h1><blockquote>
<p>jedis是redis的一个客户端工具,就是通过java来操作redis</p>
</blockquote>
<p>jdbc==&gt;通过java来操作数据库</p>
<p>jedis==&gt;通过java来操作redis,是一个客户端工具,支持java语言对redis进行各种操作</p>
<p>​                                    ===&gt;之前演示的各种命令,都可以通过jedis来完成</p>
<h2 id="7-1-步骤"><a href="#7-1-步骤" class="headerlink" title="7.1 步骤"></a>7.1 步骤</h2><h3 id="①创建maven工程"><a href="#①创建maven工程" class="headerlink" title="①创建maven工程"></a>①创建maven工程</h3><p>没有前端页面===&gt;quickstar就行</p>
<h3 id="②引入jedis依赖"><a href="#②引入jedis依赖" class="headerlink" title="②引入jedis依赖"></a>②引入jedis依赖</h3><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="③创建类"><a href="#③创建类" class="headerlink" title="③创建类"></a>③创建类</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisDemo1</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//创建Jedis对象</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.88.3"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//测试</span>
        <span class="token class-name">String</span> value <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200726.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200726.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327172033925" style="zoom: 50%;" />

<h2 id="7-2-强调一些问题"><a href="#7-2-强调一些问题" class="headerlink" title="7.2 强调一些问题"></a>7.2 强调一些问题</h2><blockquote>
<ol>
<li>在redis.conf中将bind注掉,否则只能本机访问</li>
</ol>
</blockquote>
<p>   <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200466.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152200466.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327173454198"></p>
<blockquote>
<ol start="2">
<li>在redis.conf中将本机访问保护模式<code>protected-mode</code>设置为no</li>
</ol>
</blockquote>
<p>   <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152201515.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152201515.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327173558996"></p>
<blockquote>
<ol start="3">
<li>连接超时错误</li>
</ol>
</blockquote>
<p>   <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152201514.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152201514.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220327173942749"><br>   <code>这是因为没有关掉虚拟机linux里面的防火墙</code><br>   Ubuntu 平台的防火墙关闭命令</p>
<ul>
<li>查看防火墙状态：<code>sudo ufw status</code></li>
<li>关闭防火墙：<code>sudo ufw disable</code></li>
<li>开启防火墙：<code>sudo ufw enable</code></li>
</ul>
<h2 id="7-3-Jedis常用API整理"><a href="#7-3-Jedis常用API整理" class="headerlink" title="7.3    Jedis常用API整理"></a>7.3    Jedis常用API整理</h2><h3 id="redis是一种高级的key-value的存储系统"><a href="#redis是一种高级的key-value的存储系统" class="headerlink" title="redis是一种高级的key-value的存储系统"></a><strong>redis是一种高级的key-value的存储系统</strong></h3><h4 id="其中的key是字符串类型，尽可能满足如下几点："><a href="#其中的key是字符串类型，尽可能满足如下几点：" class="headerlink" title="其中的key是字符串类型，尽可能满足如下几点："></a><strong>其中的key是字符串类型，尽可能满足如下几点：</strong></h4><p>1）key不要太长，最好不要操作1024个字节，这不仅会消耗内存还会降低查找 效率<br>2）key不要太短，如果太短会降低key的可读性<br>3）在项目中，key最好有一个统一的命名规范（根据企业的需求）</p>
<h4 id="其中value-支持五种数据类型："><a href="#其中value-支持五种数据类型：" class="headerlink" title="其中value 支持五种数据类型："></a><strong>其中value 支持五种数据类型：</strong></h4><p>1）字符串型 string<br>2）字符串列表 lists<br>3）字符串集合sets<br>4）有序字符串集合 sorted sets<br>5）哈希类型 hashs</p>
<blockquote>
<p>jedis 就是 java redis 的简写</p>
</blockquote>
<h3 id="jedis语法总结"><a href="#jedis语法总结" class="headerlink" title="jedis语法总结"></a>jedis语法总结</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token class-name">String</span> ip <span class="token punctuation">,</span> <span class="token class-name">String</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>1 .jedis中对键通用的操作</p>
</blockquote>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
<th>返回值 /补充说明</th>
</tr>
</thead>
<tbody><tr>
<td>jedis.flush</td>
<td></td>
<td></td>
</tr>
<tr>
<td>jedis.flushDB</td>
<td>清空数据</td>
<td></td>
</tr>
<tr>
<td>boolean jedis.exists(String key)</td>
<td>判断某个键是否存在</td>
<td>true = 存在，false= 不存在</td>
</tr>
<tr>
<td>jedis.set(String key,String value)</td>
<td>新增键值对（key,value）</td>
<td>返回String类型的OK代表成功</td>
</tr>
<tr>
<td><code>Set&lt;String&gt; jedis.keys(*)</code></td>
<td>获取所有key</td>
<td>返回set 无序集合</td>
</tr>
<tr>
<td>jedis.del(String key)</td>
<td>删除键为key的数据项</td>
<td></td>
</tr>
<tr>
<td>jedis.expire(String key,int i)</td>
<td>设置键为key的过期时间为i秒</td>
<td></td>
</tr>
<tr>
<td>int jedis.ttl(String key)</td>
<td>获取建委key数据项的剩余时间（秒）</td>
<td></td>
</tr>
<tr>
<td>jedis.persist(String key)</td>
<td>移除键为key属性项的生存时间限制</td>
<td></td>
</tr>
<tr>
<td>jedis.type(String key)</td>
<td>查看键为key所对应value的数据类型</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>2 .jedis中 字符串的操作</p>
</blockquote>
<p>字符串类型是Redis中最为基础的数据存储类型，它在Redis中是二进制安全的，这 便意味着该类型可以接受任何格式的数据，如JPEG图像数据或Json对象描述信息等。 在Redis中字符串类型的Value最多可以容纳的数据长度是512M。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>jedis.set(String key,String value)</td>
<td>增加（或覆盖）数据项</td>
</tr>
<tr>
<td>jedis.setnx(String key,String value)</td>
<td>不覆盖增加数据项（重复的不插入）</td>
</tr>
<tr>
<td>jedis.setex(String ,int t,String value)</td>
<td>增加数据项并设置有效时间</td>
</tr>
<tr>
<td>jedis.del(String key)</td>
<td>删除键为key的数据项</td>
</tr>
<tr>
<td>jedis.get(String key)</td>
<td>获取键为key对应的value</td>
</tr>
<tr>
<td>jedis.append(String key, String s)</td>
<td>在key对应value 后边扩展字符串 s</td>
</tr>
<tr>
<td>jedis.mset(String k1,String V1,String K2,String V2,…)</td>
<td>增加多个键值对</td>
</tr>
<tr>
<td>String[] jedis.mget(String K1,String K2,…)</td>
<td>获取多个key对应的value</td>
</tr>
<tr>
<td>jedis.del(new String[](String K1,String K2,…. ))</td>
<td>删除多个key对应的数据项</td>
</tr>
<tr>
<td>String jedis.getSet(String key,String value)</td>
<td>获取key对应value并更新value</td>
</tr>
<tr>
<td>String jedis.getrang(String key , int i, int j)</td>
<td>获取key对应value第i到j字符 ，从0开始，包头包尾</td>
</tr>
</tbody></table>
<blockquote>
<p>3 . jedis中对整数和浮点数操作</p>
</blockquote>
<table>
<thead>
<tr>
<th>语法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>jedis.incr(String key)</td>
<td>将key对应的value 加1</td>
</tr>
<tr>
<td>jedis.incrBy(String key,int n)</td>
<td>将key对应的value 加 n</td>
</tr>
<tr>
<td>jedis.decr(String key)</td>
<td>将key对应的value 减1</td>
</tr>
<tr>
<td>jedis.decrBy(String key , int n)</td>
<td>将key对应的value 减 n</td>
</tr>
</tbody></table>
<blockquote>
<p>4 .jedis中对列表（list）操作</p>
</blockquote>
<p>在Redis中，List类型是按照插入顺序排序的字符串链表。和数据结构中的普通链表 一样，我们可以在其头部(left)和尾部(right)添加新的元素。在插入时，如果该键并不存在，Redis将为该键创建一个新的链表。如果链表中所有的元素均被移除，那么该键也将会被从数据库中删除。List中可以包含的最大元素数量是 4294967295。<br>从元素插入和删除的效率视角来看，如果我们是在链表的两头插入或删除元素，这将 会是非常高效的操作，即使链表中已经存储了百万条记录，该操作也可以在常量时间内完成。然而需要说明的是，如果元素插入或删除操作是作用于链表中间，那将会是非常低效的。</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152201048.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152201048.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328090401216" style="zoom:80%;" />

<p><code>list 元素的下表从0开始</code></p>
<table>
<thead>
<tr>
<th>语法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>jedis.lpush(String key, String v1, String v2,….)</td>
<td>添加一个List , 注意：如果已经有该List对应的key, 则按顺序在左边追加 一个或多个</td>
</tr>
<tr>
<td>jedis.rpush(String key , String vn)</td>
<td>key对应list右边插入元素</td>
</tr>
<tr>
<td>jedis.lrange(String key,int i,int j)</td>
<td>获取key对应list区间[i,j]的元素，注：从左边0开始，包头包尾</td>
</tr>
<tr>
<td>jedis.lrem(String key,int n , String val)</td>
<td>删除list中 n个元素val</td>
</tr>
<tr>
<td>jedis.ltrim(String key,int i,int j)</td>
<td>删除list区间[i,j] 之外的元素</td>
</tr>
<tr>
<td>jedis.lpop(String key)</td>
<td>key对应list ,左弹出栈一个元素</td>
</tr>
<tr>
<td>jedis.rpop(String key)</td>
<td>key对应list ,右弹出栈一个元素</td>
</tr>
<tr>
<td>jedis.lset(String key,int index,String val)</td>
<td>修改key对应的list指定下标index的元素</td>
</tr>
<tr>
<td>jedis.llen(String key)</td>
<td>获取key对应list的长度</td>
</tr>
<tr>
<td>jedis.lindex(String key,int index)</td>
<td>获取key对应list下标为index的元素</td>
</tr>
<tr>
<td>jedis.sort(String key)</td>
<td>把key对应list里边的元素从小到大排序 （后边详细介绍）</td>
</tr>
</tbody></table>
<blockquote>
<p>5  .jedis 集合set 操作</p>
</blockquote>
<p>在Redis中，我们可以将Set类型看作为<strong>没有排序的字符集合</strong>，和List类型一样，也可以在该类型的数据值上执行添加、删除或判断某一元素是否存在等操作。需要 说明的是，这些操作的时间是常量时间。Set可包含的最大元素数是4294967295。<br>和List类型不同的是，<strong>Set集合中不允许出现重复的元素</strong>。和List类型相比，Set类型在功能上还存在着一个非常重要的特性，即在服务器端完成多个Sets之间的聚合计 算操作，如unions、intersections和differences（就是交集并集那些了）。由于这些操作均在服务端完成， 因此效率极高，而且也节省了大量的网络IO开销</p>
<p><code>set 的方法都以s开头</code></p>
<table>
<thead>
<tr>
<th>语法</th>
<th>操作</th>
</tr>
</thead>
<tbody><tr>
<td>jedis.sadd(String key,String v1,String v2,…)</td>
<td>添加一个set</td>
</tr>
<tr>
<td>jedis.smenbers(String key)</td>
<td>获取key对应set的所有元素</td>
</tr>
<tr>
<td>jedis.srem(String key,String val)</td>
<td>删除集合key中值为val的元素</td>
</tr>
<tr>
<td>jedis.srem(String key, Sting v1, String v2,…)</td>
<td>删除值为v1, v2 , …的元素</td>
</tr>
<tr>
<td>jedis.spop(String key)</td>
<td>随机弹出栈set里的一个元素</td>
</tr>
<tr>
<td>jedis.scared(String key)</td>
<td>获取set元素个数</td>
</tr>
<tr>
<td>jedis.smove(String key1, String key2, String val)</td>
<td>将元素val从集合key1中移到key2中</td>
</tr>
<tr>
<td>jedis.sinter(String key1, String key2)</td>
<td>获取集合key1和集合key2的交集</td>
</tr>
<tr>
<td>jedis.sunion(String key1, String key2)</td>
<td>获取集合key1和集合key2的并集</td>
</tr>
<tr>
<td>jedis.sdiff(String key1, String key2)</td>
<td>获取集合key1和集合key2的差集</td>
</tr>
</tbody></table>
<blockquote>
<ol start="6">
<li>jedis中 有序集合Zsort</li>
</ol>
</blockquote>
<p>Sorted-Sets和Sets类型极为相似，它们都是字符串的集合，都<strong>不允许重复的成员出现在一个Set中</strong>。它们之间的<strong>主要差别是Sorted-Sets中的每一个成员都会有一个分数(score)与之关联</strong>，Redis正是通过分数来为集合中的成员进行从小到大的排序。然 而需要额外指出的是，尽管Sorted-Sets中的成员必须是唯一的，但是分数(score) 却是可以重复的。<br>在Sorted-Set中添加、删除或更新一个成员都是非常快速的操作，其时间复杂度为集合中成员数量的对数。由于Sorted-Sets中的成员在集合中的位置是有序的，因此，即便是访问位于集合中部的成员也仍然是非常高效的。事实上，Redis所具有的这一特征在很多其它类型的数据库中是很难实现的，换句话说，在该点上要想达到和Redis同样的高效，在其它数据库中进行建模是非常困难的。<br>例如：游戏排名、微博热点话题等使用场景。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>jedis.zadd(String key,Map map)</td>
<td>添加一个ZSet</td>
</tr>
<tr>
<td>jedis.hset(String key,int score , int val)</td>
<td>往 ZSet插入一个元素（Score-Val）</td>
</tr>
<tr>
<td>jedis.zrange(String key, int i , int j)</td>
<td>获取ZSet 里下表[i,j] 区间元素Val</td>
</tr>
<tr>
<td>jedis. zrangeWithScore(String key,int i , int j)</td>
<td>获取ZSet 里下表[i,j] 区间元素Score - Val</td>
</tr>
<tr>
<td>jedis.zrangeByScore(String , int i , int j)</td>
<td>获取ZSet里score[i,j]分数区间的元素（Score-Val）</td>
</tr>
<tr>
<td>jeids.zscore(String key,String value)</td>
<td>获取ZSet里value元素的Score</td>
</tr>
<tr>
<td>jedis.zrank(String key,String value)</td>
<td>获取ZSet里value元素的score的排名</td>
</tr>
<tr>
<td>jedis.zrem(String key,String value)</td>
<td>删除ZSet里的value元素</td>
</tr>
<tr>
<td>jedis.zcard(String key)</td>
<td>获取ZSet的元素个数</td>
</tr>
<tr>
<td>jedis.zcount(String key , int i ,int j)</td>
<td>获取ZSet总score在[i,j]区间的元素个数</td>
</tr>
<tr>
<td>jedis.zincrby(String key,int n , String value)</td>
<td>把ZSet中value元素的score+=n</td>
</tr>
</tbody></table>
<blockquote>
<p>7 .jedis中 哈希（Hash）操作</p>
</blockquote>
<p>Redis中的Hashes类型可以看成具有String Key和String Value的map容器。所以该类型非常适合于存储值对象的信息。如Username、Password和Age等。如果Hash中包含很少的字段，那么该类型的数据也将仅占用很少的磁盘空间。每一个Hash可以存储4294967295个键值对。</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152201914.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152201914.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328091039916" style="zoom:80%;" />

<p><code>规律： 哈希的 方法 都以 h 开头，含有m字符的一般是多个的， （multiple： 多个的）</code></p>
<table>
<thead>
<tr>
<th>语法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>jedis.hmset(String key,Map map)</td>
<td>添加一个Hash</td>
</tr>
<tr>
<td>jedis.hset(String key , String key, String value)</td>
<td>向Hash中插入一个元素（K-V）</td>
</tr>
<tr>
<td>jedis.hgetAll(String key)</td>
<td>获取Hash的所有（K-V） 元素</td>
</tr>
<tr>
<td>jedis.hkeys（String key）</td>
<td>获取Hash所有元素的key</td>
</tr>
<tr>
<td>jedis.hvals(String key)</td>
<td>获取Hash所有元素 的value</td>
</tr>
<tr>
<td>jedis.hincrBy(String key , String k, int i)</td>
<td>把Hash中对应的k元素的值 val+=i</td>
</tr>
<tr>
<td>jedis.hdecrBy(String key,String k, int i)</td>
<td>把Hash中对应的k元素的值 val-=i</td>
</tr>
<tr>
<td>jedis.hdel(String key , String k1, String k2,…)</td>
<td>从Hash中删除一个或多个元素</td>
</tr>
<tr>
<td>jedis.hlen(String key)</td>
<td>获取Hash中元素的个数</td>
</tr>
<tr>
<td>jedis.hexists(String key,String K1)</td>
<td>判断Hash中是否存在K1对应的元素</td>
</tr>
<tr>
<td>jedis.hmget(String key,String K1,String K2)</td>
<td>获取Hash中一个或多个元素value</td>
</tr>
</tbody></table>
<blockquote>
<p>8  .排序操作</p>
</blockquote>
<p>使用排序， 首先需要生成一个排序对象</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SortingParams</span>  sortingParams <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">SortingParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<table>
<thead>
<tr>
<th>语法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>jedis.sort(String key,sortingParams.alpha())</td>
<td>队列按首字母a-z 排序</td>
</tr>
<tr>
<td>jedis.sort(String key, sortingParams.asc() )</td>
<td>队列按数字升序排列</td>
</tr>
<tr>
<td>jedis.sort(String key , sortingParams.desc())</td>
<td>队列按数字降序排列</td>
</tr>
</tbody></table>
<p>使用示例：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token class-name">JedisPoolUtils</span><span class="token punctuation">.</span><span class="token function">getJedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SortingParams</span> sortingParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SortingParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> sort <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">"list02"</span><span class="token punctuation">,</span> sortingParams<span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>这里排序指的是返回的sort是有序的，而之前的list02 依然是以前的顺序。</code></p>
<h2 id="7-4-测试相关数据"><a href="#7-4-测试相关数据" class="headerlink" title="7.4 测试相关数据"></a>7.4 测试相关数据</h2><h3 id="7-4-1Jedis-API-Key"><a href="#7-4-1Jedis-API-Key" class="headerlink" title="7.4.1Jedis-API:  Key"></a>7.4.1<strong>Jedis-API:  Key</strong></h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"k2"</span><span class="token punctuation">,</span> <span class="token string">"v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"k3"</span><span class="token punctuation">,</span> <span class="token string">"v3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> keys<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ttl</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-4-2-Jedis-API-String"><a href="#7-4-2-Jedis-API-String" class="headerlink" title="7.4.2   Jedis-API:  String"></a>7.4.2   <strong>Jedis-API:  String</strong></h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">jedis<span class="token punctuation">.</span><span class="token function">mset</span><span class="token punctuation">(</span><span class="token string">"str1"</span><span class="token punctuation">,</span><span class="token string">"v1"</span><span class="token punctuation">,</span><span class="token string">"str2"</span><span class="token punctuation">,</span><span class="token string">"v2"</span><span class="token punctuation">,</span><span class="token string">"str3"</span><span class="token punctuation">,</span><span class="token string">"v3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"str1"</span><span class="token punctuation">,</span><span class="token string">"str2"</span><span class="token punctuation">,</span><span class="token string">"str3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="7-4-3-Jedis-API-List"><a href="#7-4-3-Jedis-API-List" class="headerlink" title="7.4.3    Jedis-API:  List"></a>7.4.3    <strong>Jedis-API:  List</strong></h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"mylist"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> element <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-4-4-Jedis-API-set"><a href="#7-4-4-Jedis-API-set" class="headerlink" title="7.4.4   Jedis-API:  set"></a>7.4.4   <strong>Jedis-API:  set</strong></h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"orders"</span><span class="token punctuation">,</span> <span class="token string">"order01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"orders"</span><span class="token punctuation">,</span> <span class="token string">"order02"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"orders"</span><span class="token punctuation">,</span> <span class="token string">"order03"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"orders"</span><span class="token punctuation">,</span> <span class="token string">"order04"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> smembers <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"orders"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> order <span class="token operator">:</span> smembers<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
jedis<span class="token punctuation">.</span><span class="token function">srem</span><span class="token punctuation">(</span><span class="token string">"orders"</span><span class="token punctuation">,</span> <span class="token string">"order02"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-4-5-Jedis-API-hash"><a href="#7-4-5-Jedis-API-hash" class="headerlink" title="7.4.5    Jedis-API:  hash"></a>7.4.5    <strong>Jedis-API:  hash</strong></h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span><span class="token string">"userName"</span><span class="token punctuation">,</span><span class="token string">"lisi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span><span class="token string">"userName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"telphone"</span><span class="token punctuation">,</span><span class="token string">"13810169999"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">,</span><span class="token string">"atguigu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">,</span><span class="token string">"abc@163.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">hmset</span><span class="token punctuation">(</span><span class="token string">"hash2"</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hmget</span><span class="token punctuation">(</span><span class="token string">"hash2"</span><span class="token punctuation">,</span> <span class="token string">"telphone"</span><span class="token punctuation">,</span><span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> element <span class="token operator">:</span> result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-4-6-Jedis-API-zset"><a href="#7-4-6-Jedis-API-zset" class="headerlink" title="7.4.6    Jedis-API:  zset"></a>7.4.6    <strong>Jedis-API:  zset</strong></h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"zset01"</span><span class="token punctuation">,</span> <span class="token number">100d</span><span class="token punctuation">,</span> <span class="token string">"z3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"zset01"</span><span class="token punctuation">,</span> <span class="token number">90d</span><span class="token punctuation">,</span> <span class="token string">"l4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"zset01"</span><span class="token punctuation">,</span> <span class="token number">80d</span><span class="token punctuation">,</span> <span class="token string">"w5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">"zset01"</span><span class="token punctuation">,</span> <span class="token number">70d</span><span class="token punctuation">,</span> <span class="token string">"z6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> zrange <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">"zset01"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> e <span class="token operator">:</span> zrange<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="8-Redis-Jedis-实例"><a href="#8-Redis-Jedis-实例" class="headerlink" title="8.Redis_Jedis_实例"></a>8.Redis_Jedis_实例</h1><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152202364.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152202364.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220326223439505"></p>
<hr>
<hr>
<p><code>分析:</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152202767.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152202767.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328095018478"></p>
<hr>
<hr>
<p><code>代码:</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoneCode</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//模拟验证码发送</span>
        <span class="token function">verifyCode</span><span class="token punctuation">(</span><span class="token string">"137000000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//校验发送的验证码</span>
        <span class="token comment">//getRedisCode("137000000","验证码");</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//1.随即生成一个六位数的验证码</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> code <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> rand <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            code <span class="token operator">+=</span> rand<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//2.每个手机每天只能发送三次，验证码放到redis中，设置过期时间</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">verifyCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//连接redis</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.50.128"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输入redis连接密码</span>
        jedis<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//拼接key</span>
        <span class="token comment">//手机发送次数key</span>
        <span class="token class-name">String</span> countKey <span class="token operator">=</span> <span class="token string">"VerifyCode"</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">":count"</span><span class="token punctuation">;</span>
        <span class="token comment">//验证码key</span>
        <span class="token class-name">String</span> codeKey <span class="token operator">=</span> <span class="token string">"VerifyCode"</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">":code"</span><span class="token punctuation">;</span>

        <span class="token comment">//每个手机每天只能发送3次</span>
        <span class="token class-name">String</span> count <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>countKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token comment">//没有发送次数，第一次发送</span>
            <span class="token comment">//设置发送次数是1</span>
            jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>countKey<span class="token punctuation">,</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token comment">//发送次数+1</span>
            jedis<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span>countKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token comment">//发送三次了，不能再发送了</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"今天的发送次数已经超过3次了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//关闭连接</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">//发送的验证码要放到redis中,设置过期时间为120s</span>
        <span class="token class-name">String</span> vcode <span class="token operator">=</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>codeKey<span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span>vcode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//3.验证码校验</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getRedisCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span><span class="token class-name">String</span> code<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//从redis中获取验证码</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.50.128"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//验证码key</span>
        <span class="token class-name">String</span> codeKey <span class="token operator">=</span> <span class="token string">"VerifyCode"</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">":code"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> redisCode <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>codeKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//判断</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redisCode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="9-springboot整合Redis6"><a href="#9-springboot整合Redis6" class="headerlink" title="9.springboot整合Redis6"></a>9.springboot整合Redis6</h1><blockquote>
<p>Spring Boot Data(数据)  redis提供了RedisTemplate和StringRedisTemplate</p>
<p>其中StringRedisTemplate是RedisTemplate的子类,两个方法基本一致,不同之处主要体现在操作的数据类型不同:</p>
<ul>
<li>RedisTemplate中的两个泛型都是Object,意味着存储的key和value都可以是一个对象</li>
<li>StringRedisTemplate的两个泛型都是String,意味着StringRedisTemplate的key和value都只能是字符串</li>
</ul>
</blockquote>
<p><code>RedisTemplate</code>:类似于一个redis的模板,封装操作redis里面各种 各样的类型,如果是关系型数据库,基本上就叫jdbcT emplate等等</p>
<hr>
<p>redis是一个key   value==&gt;value类型有五种:String,list,set,zset,hash</p>
<p>==&gt;日后操作的时候,通过java操作时:<br>        key是字符串==&gt;value也是字符串<br>        key是list===&gt;value也是放的一个String数组</p>
<p>==&gt;java里面默认放的都是字符串</p>
<p>如果日后想让redis做更复杂处理==&gt;把一个对象放到redis中===&gt;对象序列化</p>
<hr>
<p><code>RedisTemplate的key和value都允许是对象</code>==&gt;默认自动序列化和自动反序列化</p>
<p>​                                                                                 ==&gt;<code>放入的对象必须实现对象序列化接口:Serializable</code></p>
<p>可能有一种需求:日后key和value放的都是字符串,不放对象==&gt;<code>StringRedisTemplate</code></p>
<h2 id="①-在pom-xml文件中引入redis相关依赖"><a href="#①-在pom-xml文件中引入redis相关依赖" class="headerlink" title="①   在pom.xml文件中引入redis相关依赖"></a>①   在pom.xml文件中引入redis相关依赖</h2><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- redis --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token comment">&lt;!-- spring2.X集成redis所需common-pool2--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>springboot 2.0以后redis的客户端已经默认不使用jedis了,而是Lettuce</code><br>而且spring-boot-starter-data-redis依赖里面已经带了Lettuce,不用引入了</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152202379.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152202379.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328153111116" style="zoom:67%;" />



<h2 id="②-application-properties配置redis配置"><a href="#②-application-properties配置redis配置" class="headerlink" title="②  application.properties配置redis配置"></a>②  application.properties配置redis配置</h2><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#Redis服务器地址</span>
<span class="token attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token attr-value">192.168.88.3</span>
<span class="token comment">#Redis服务器连接端口</span>
<span class="token attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token attr-value">6379</span>
<span class="token comment">#Redis数据库索引（默认为0）</span>
<span class="token attr-name">spring.redis.database</span><span class="token punctuation">=</span> <span class="token attr-value">0</span>
<span class="token comment">#连接超时时间（毫秒）</span>
<span class="token attr-name">spring.redis.timeout</span><span class="token punctuation">=</span><span class="token attr-value">1800000</span>
<span class="token comment">#连接池最大连接数（使用负值表示没有限制）</span>
<span class="token attr-name">spring.redis.lettuce.pool.max-active</span><span class="token punctuation">=</span><span class="token attr-value">20</span>
<span class="token comment">#最大阻塞等待时间(负数表示没限制)</span>
<span class="token attr-name">spring.redis.lettuce.pool.max-wait</span><span class="token punctuation">=</span><span class="token attr-value">-1</span>
<span class="token comment">#连接池中的最大空闲连接</span>
<span class="token attr-name">spring.redis.lettuce.pool.max-idle</span><span class="token punctuation">=</span><span class="token attr-value">5</span>
<span class="token comment">#连接池中的最小空闲连接</span>
<span class="token attr-name">spring.redis.lettuce.pool.min-idle</span><span class="token punctuation">=</span><span class="token attr-value">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="③-添加redis配置类"><a href="#③-添加redis配置类" class="headerlink" title="③  添加redis配置类"></a>③  添加redis配置类</h2><blockquote>
<p><em>配置redisTemplate</em>    </p>
<p>默认情况下的模板只能支持 RedisTemplate&lt;String,String&gt;   ==&gt;只能存入字符串</p>
<p>很多时候，我们需要自定义 RedisTemplate ，设置序列化器</p>
</blockquote>
<p>根据springboot知识,得出这个配置类创建了两个对象:</p>
<p><code>RedisTemplate&lt;String, Object&gt;</code>        <code>CacheManager cacheManager</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@EnableCaching</span>  <span class="token comment">//处理缓存</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//key序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//value序列化</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//value hashmap序列化</span>
        template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//解决查询缓存转换异常的问题</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配置序列化（解决乱码的问题）,过期时间600秒</span>
        <span class="token class-name">RedisCacheConfiguration</span> config <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeKeysWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">disableCachingNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RedisCacheManager</span> cacheManager <span class="token operator">=</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">cacheDefaults</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cacheManager<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>什么是ObjectMapper</p>
</blockquote>
<ul>
<li>ObjectMapper类是Jackson库的主要类，它提供一些功能将数据集或对象转换的实现。</li>
<li>它将使用JsonParser和JsonGenerator实例来实现JSON的实际读/写。</li>
</ul>
<blockquote>
<p>ObjectMapper怎么使用</p>
</blockquote>
<ul>
<li>普通java项目(非springboot)<br>引入jackson依赖</li>
<li>springboot项目<br><code>由于Spring Boot的自动配置JacksonAutoConfiguration中有依赖引入和配置，所以不需要我们额外配置</code></li>
</ul>
<blockquote>
<p>Jackson是spring-boot-starter-json的一部分，spring-boot-starter-web中包含spring-boot-starter-json。也就是说，当项目中引入spring-boot-starter-web后会自动引入spring-boot-starter-json</p>
</blockquote>
<h2 id="④-测试"><a href="#④-测试" class="headerlink" title="④  测试"></a>④  测试</h2><p><code>RedisTestController中添加测试方法</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/redisTest"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisTestController</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//设置值到redis</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"lucy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//从redis获取值</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="RedisTemplate的直接方法-star"><a href="#RedisTemplate的直接方法-star" class="headerlink" title="RedisTemplate的直接方法  :star:"></a>RedisTemplate的直接方法  :star:</h2><p><strong>首先使用@Autowired注入RedisTemplate（后面直接使用，就不特殊说明）</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>1、删除单个key</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//    删除key</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、删除多个key</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//    删除多个key</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> deleteKey <span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、指定key的失效时间</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//    指定key的失效时间</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">expire</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token keyword">long</span> time<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>time<span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>4、根据key获取过期时间</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//    根据key获取过期时间</span>
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getExpire</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">Long</span> expire <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">getExpire</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> expire<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>5、判断key是否存在</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//    判断key是否存在</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="String类型相关操作-star"><a href="#String类型相关操作-star" class="headerlink" title="String类型相关操作 :star:"></a>String类型相关操作 :star:</h2><blockquote>
<p>1 .添加缓存（2/3是1的递进值）</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1、通过redisTemplate设置值</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"StringValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"StringValue"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2、通过BoundValueOperations设置值</span>
<span class="token class-name">BoundValueOperations</span> stringKey <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringKey<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"StringVaule"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringKey<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"StringValue"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3、通过ValueOperations设置值</span>
<span class="token class-name">ValueOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ops<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">,</span> <span class="token string">"StringVaule"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ops<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"StringValue"</span><span class="token punctuation">,</span><span class="token string">"StringVaule"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>2 .设置过期时间(单独设置)</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>3 .获取缓存值(2/3是1的递进值)</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1、通过redisTemplate设置值</span>
<span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2、通过BoundValueOperations获取值</span>
<span class="token class-name">BoundValueOperations</span> stringKey <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> stringKey<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3、通过ValueOperations获取值</span>
<span class="token class-name">ValueOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> str3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> ops<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>4 .删除key</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Boolean</span> result <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>5 .顺序递增</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>6 .顺序递减</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"StringKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Hash类型相关操作-star"><a href="#Hash类型相关操作-star" class="headerlink" title="Hash类型相关操作 :star:"></a>Hash类型相关操作 :star:</h2><blockquote>
<p>1 .添加缓存（2/3是1的递进值）</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1、通过redisTemplate设置值</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"SmallKey"</span><span class="token punctuation">,</span> <span class="token string">"HashVaue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2、通过BoundValueOperations设置值</span>
<span class="token class-name">BoundHashOperations</span> hashKey <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hashKey<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"SmallKey"</span><span class="token punctuation">,</span> <span class="token string">"HashVaue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3、通过ValueOperations设置值</span>
<span class="token class-name">HashOperations</span> hashOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hashOps<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">,</span> <span class="token string">"SmallKey"</span><span class="token punctuation">,</span> <span class="token string">"HashVaue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>2 .设置过期时间(单独设置)</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>3 .添加一个Map集合</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>hashMap <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>4 .设置过期时间(单独设置)</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>5 .提取所有的小key</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1、通过redisTemplate获取值</span>
<span class="token class-name">Set</span> keys1 <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2、通过BoundValueOperations获取值</span>
<span class="token class-name">BoundHashOperations</span> hashKey <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Set</span> keys2 <span class="token operator">=</span> hashKey<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3、通过ValueOperations获取值</span>
<span class="token class-name">HashOperations</span> hashOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Set</span> keys3 <span class="token operator">=</span> hashOps<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>6 .提取所有的value值</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1、通过redisTemplate获取值</span>
<span class="token class-name">List</span> values1 <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2、通过BoundValueOperations获取值</span>
<span class="token class-name">BoundHashOperations</span> hashKey <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span> values2 <span class="token operator">=</span> hashKey<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3、通过ValueOperations获取值</span>
<span class="token class-name">HashOperations</span> hashOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span> values3 <span class="token operator">=</span> hashOps<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>7 .根据key提取value值</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1、通过redisTemplate获取</span>
<span class="token class-name">String</span> value1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"SmallKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2、通过BoundValueOperations获取值</span>
<span class="token class-name">BoundHashOperations</span> hashKey <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> value2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> hashKey<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"SmallKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3、通过ValueOperations获取值</span>
<span class="token class-name">HashOperations</span> hashOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> value3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> hashOps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">,</span> <span class="token string">"SmallKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>8 .获取所有的键值对集合</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1、通过redisTemplate获取</span>
<span class="token class-name">Map</span> entries <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2、通过BoundValueOperations获取值</span>
<span class="token class-name">BoundHashOperations</span> hashKey <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span> entries1 <span class="token operator">=</span> hashKey<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3、通过ValueOperations获取值</span>
<span class="token class-name">HashOperations</span> hashOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span> entries2 <span class="token operator">=</span> hashOps<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>9  .删除</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//删除小key</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"SmallKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//删除大key</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>10 .判断Hash中是否含有该值</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Boolean</span> isEmpty <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span><span class="token string">"HashKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token string">"SmallKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Set类型相关操作-star"><a href="#Set类型相关操作-star" class="headerlink" title="Set类型相关操作  :star:"></a>Set类型相关操作  :star:</h2><blockquote>
<p>1 .添加Set缓存(值可以是一个，也可是多个)(2/3是1的递进值）</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1、通过redisTemplate设置值</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"setValue1"</span><span class="token punctuation">,</span> <span class="token string">"setValue2"</span><span class="token punctuation">,</span> <span class="token string">"setValue3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2、通过BoundValueOperations设置值</span>
<span class="token class-name">BoundSetOperations</span> setKey <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
setKey<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"setValue1"</span><span class="token punctuation">,</span> <span class="token string">"setValue2"</span><span class="token punctuation">,</span> <span class="token string">"setValue3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3、通过ValueOperations设置值</span>
<span class="token class-name">SetOperations</span> setOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
setOps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">,</span> <span class="token string">"SetValue1"</span><span class="token punctuation">,</span> <span class="token string">"setValue2"</span><span class="token punctuation">,</span> <span class="token string">"setValue3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>2 .设置过期时间(单独设置)</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>3 .根据key获取Set中的所有值</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1、通过redisTemplate获取值</span>
<span class="token class-name">Set</span> set1 <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2、通过BoundValueOperations获取值</span>
<span class="token class-name">BoundSetOperations</span> setKey <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Set</span> set2 <span class="token operator">=</span> setKey<span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3、通过ValueOperations获取值</span>
<span class="token class-name">SetOperations</span> setOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Set</span> set3 <span class="token operator">=</span> setOps<span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>4 .根据value从一个set中查询,是否存在</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Boolean</span> isEmpty <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isMember</span><span class="token punctuation">(</span><span class="token string">"setValue2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>5 .获取Set缓存的长度</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Long</span> size <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>6 .移除指定的元素</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Long</span> result1 <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundSetOps</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"setValue1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>7 .移除指定的key</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Boolean</span> result2 <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"setKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="LIST类型相关操作-star"><a href="#LIST类型相关操作-star" class="headerlink" title="LIST类型相关操作 :star:"></a>LIST类型相关操作 :star:</h2><blockquote>
<p>添加缓存（2/3是1的递进值）</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1、通过redisTemplate设置值</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leftPush</span><span class="token punctuation">(</span><span class="token string">"listLeftValue1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span><span class="token string">"listRightValue2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2、通过BoundValueOperations设置值</span>
<span class="token class-name">BoundListOperations</span> listKey <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
listKey<span class="token punctuation">.</span><span class="token function">leftPush</span><span class="token punctuation">(</span><span class="token string">"listLeftValue3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
listKey<span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span><span class="token string">"listRightValue4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3、通过ValueOperations设置值</span>
<span class="token class-name">ListOperations</span> opsList <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
opsList<span class="token punctuation">.</span><span class="token function">leftPush</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">,</span> <span class="token string">"listLeftValue5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
opsList<span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">,</span> <span class="token string">"listRightValue6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>将List放入缓存</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPushAll</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leftPushAll</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>设置过期时间(单独设置)</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundValueOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>获取List缓存全部内容（起始索引，结束索引）</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span> listKey1 <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>从左或从右弹出一个元素</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> listKey2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leftPop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//从左侧弹出一个元素</span>
<span class="token class-name">String</span> listKey3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//从右侧弹出一个元素</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>根据索引查询元素</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> listKey4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>获取List缓存的长度</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Long</span> size <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>根据索引修改List中的某条数据(key，索引，值) </p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">,</span><span class="token string">"listLeftValue3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>移除N个值为value(key,移除个数，值)</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundListOps</span><span class="token punctuation">(</span><span class="token string">"listKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">,</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Zset类型的相关操作-star"><a href="#Zset类型的相关操作-star" class="headerlink" title="Zset类型的相关操作 :star:"></a>Zset类型的相关操作 :star:</h2><blockquote>
<p>向集合中插入元素，并设置分数</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//1、通过redisTemplate设置值</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"zSetVaule"</span><span class="token punctuation">,</span> <span class="token number">100D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2、通过BoundValueOperations设置值</span>
<span class="token class-name">BoundZSetOperations</span> zSetKey <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
zSetKey<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"zSetVaule"</span><span class="token punctuation">,</span> <span class="token number">100D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3、通过ValueOperations设置值</span>
<span class="token class-name">ZSetOperations</span> zSetOps <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
zSetOps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">,</span> <span class="token string">"zSetVaule"</span><span class="token punctuation">,</span> <span class="token number">100D</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>向集合中插入多个元素,并设置分数</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultTypedTuple</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultTypedTuple</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token string">"zSetVaule1"</span><span class="token punctuation">,</span> <span class="token number">2.1D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DefaultTypedTuple</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultTypedTuple</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token string">"zSetVaule2"</span><span class="token punctuation">,</span> <span class="token number">3.3D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>按照排名先后(从小到大)打印指定区间内的元素, -1为打印全部</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> range <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>获得指定元素的分数</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Double</span> score <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">score</span><span class="token punctuation">(</span><span class="token string">"zSetVaule"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>返回集合内的成员个数</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Long</span> size <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>返回集合内指定分数范围的成员个数（Double类型）</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Long</span> COUNT <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token number">0D</span><span class="token punctuation">,</span> <span class="token number">2.2D</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>返回集合内元素在指定分数范围内的排名（从小到大）</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Set</span> byScore <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rangeByScore</span><span class="token punctuation">(</span><span class="token number">0D</span><span class="token punctuation">,</span> <span class="token number">2.2D</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>带偏移量和个数，(key，起始分数，最大分数，偏移量，个数)</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> ranking2 <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rangeByScore</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">,</span> <span class="token number">0D</span><span class="token punctuation">,</span> <span class="token number">2.2D</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>返回集合内元素的排名，以及分数（从小到大）</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TypedTuple</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span><span class="token punctuation">></span></span> tuples <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rangeWithScores</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">,</span> <span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TypedTuple</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> tuple <span class="token operator">:</span> tuples<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tuple<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" : "</span> <span class="token operator">+</span> tuple<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>ss<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>返回指定成员的排名</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//从小到大</span>
<span class="token class-name">Long</span> startRank <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token string">"zSetVaule"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//从大到小</span>
<span class="token class-name">Long</span> endRank <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverseRank</span><span class="token punctuation">(</span><span class="token string">"zSetVaule"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>从集合中删除指定元素</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"zSetVaule"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>删除指定索引范围的元素（Long类型）</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeRange</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">,</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>删除指定分数范围内的元素（Double类型）</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeRangeByScorssse</span><span class="token punctuation">(</span><span class="token number">0D</span><span class="token punctuation">,</span><span class="token number">2.2D</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p> 为指定元素加分（Double类型）</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Double</span> score <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundZSetOps</span><span class="token punctuation">(</span><span class="token string">"zSetKey"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">incrementScore</span><span class="token punctuation">(</span><span class="token string">"zSetVaule"</span><span class="token punctuation">,</span><span class="token number">1.1D</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="10-Redis-事务-锁机制-秒杀"><a href="#10-Redis-事务-锁机制-秒杀" class="headerlink" title="10 **Redis_****事务_**锁机制_秒杀"></a>10 **Redis_****事务_**<strong>锁机制</strong>_<strong>秒杀</strong></h1><h2 id="10-1-Redis的事务定义"><a href="#10-1-Redis的事务定义" class="headerlink" title="10.1     Redis的事务定义"></a>10.1     Redis的事务定义</h2><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152203788.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152203788.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328194912878"></p>
<p>Redis事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。<code>事务在执行的过程中，不会被其他客户端发送来的命令请求所打断</code>。</p>
<p>Redis事务的主要作用就是<code>串联多个命令</code>,<code>防止别的命令插队</code>。</p>
<h2 id="10-2-Multi、Exec、discard"><a href="#10-2-Multi、Exec、discard" class="headerlink" title="10.2   Multi、Exec、discard"></a>10.2   Multi、Exec、discard</h2><p><code>从输入Multi命令开始，输入的命令都会依次进入命令队列中，但不会执行，直到输入Exec后，Redis会将之前的命令队列中的命令依次执行</code>。</p>
<p>组队的过程中可以<code>通过discard来放弃组队</code>。 </p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152203266.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152203266.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328195014402"></p>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152209969.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152209969.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329090657019"></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210916.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210916.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329090806783"></p>
<hr>
<p>案例:</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210442.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210442.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328195035168"></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210779.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210779.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328195058694"></p>
<hr>
<hr>
<h2 id="10-3-事务的错误处理"><a href="#10-3-事务的错误处理" class="headerlink" title="10.3  事务的错误处理"></a>10.3  事务的错误处理</h2><p><code>组队中某个命令出现了报告错误，执行时整个的所有队列都会被取消。</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210401.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210401.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328195147832"></p>
<p><code>如果执行阶段某个命令报出了错误，则只有报错的命令不会被执行，而其他的命令都会执行，不会回滚。</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210609.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210609.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328195208298"></p>
<hr>
<h2 id="10-4-为什么要做成事务"><a href="#10-4-为什么要做成事务" class="headerlink" title="10.4 为什么要做成事务"></a>10.4 为什么要做成事务</h2><p>想想一个场景：有很多人有你的账户,同时去参加双十一抢购</p>
<h2 id="10-5-事务冲突的问题"><a href="#10-5-事务冲突的问题" class="headerlink" title="10.5 事务冲突的问题"></a>10.5 事务冲突的问题</h2><h4 id="10-5-1-例子"><a href="#10-5-1-例子" class="headerlink" title="10.5.1 例子"></a>10.5.1 例子</h4><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210342.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210342.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328195322691"></p>
<h3 id="10-5-2-悲观锁"><a href="#10-5-2-悲观锁" class="headerlink" title="10.5.2 悲观锁"></a>10.5.2 悲观锁</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210927.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210927.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328195342702"></p>
<hr>
<p><strong>悲观锁(Pessimistic Lock)</strong>, 顾名思义，就是很悲观，每次去拿数据的时候都<code>认为别人会修改，所以每次在拿数据的时候都会上锁</code>，这样别人想拿这个数据就会block直到它拿到锁。<strong>传统的关系型数据库里边就用到了很多这种锁机制</strong>，比如<strong>行锁</strong>，<strong>表锁</strong>等，<strong>读锁</strong>，<strong>写锁</strong>等，都是在做操作之前先上锁。</p>
<h3 id="10-5-3-乐观锁"><a href="#10-5-3-乐观锁" class="headerlink" title="10.5.3 乐观锁"></a>10.5.3 乐观锁</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210410.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210410.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328195410126"><br><strong>乐观锁(Optimistic Lock),</strong> 顾名思义，就是很乐观，每次去拿数据的时候都<code>认为别人不会修改，所以不会上锁</code>，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。<strong>乐观锁适用于多读的应用类型，这样可以提高吞吐量</strong>。Redis就是利用这种check-and-set机制实现事务的。</p>
<h3 id="10-5-4-1-1-1-WATCH-key-key-…"><a href="#10-5-4-1-1-1-WATCH-key-key-…" class="headerlink" title="10.5.4  1.1.1.  WATCH key [key …]"></a>10.5.4  <strong>1.1.1.</strong>  <strong>WATCH</strong> <strong>key</strong> <strong>[key …]</strong></h3><p><code>在执行multi之前，先执行watch key1 [key2]</code>,<code>可以监视一个(或多个) key</code> ，<code>如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。</code></p>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210271.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210271.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329094816231"></p>
<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210408.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210408.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329094914730"></p>
<hr>
<h3 id="10-5-5-unwatch"><a href="#10-5-5-unwatch" class="headerlink" title="10.5.5 unwatch"></a>10.5.5 unwatch</h3><p><code>取消 WATCH 命令对所有 key 的监视。</code></p>
<p>如果在执行 WATCH 命令之后，EXEC 命令或DISCARD 命令先被执行了的话，那么就不需要再执行UNWATCH 了。</p>
<p><a target="_blank" rel="noopener" href="http://doc.redisfans.com/transaction/exec.html">http://doc.redisfans.com/transaction/exec.html</a></p>
<h2 id="10-6-Redis事务三特性"><a href="#10-6-Redis事务三特性" class="headerlink" title="10.6    Redis事务三特性"></a>10.6    Redis事务三特性</h2><ul>
<li><p><code>单独的隔离操作</code> </p>
<ul>
<li>事务中的所有命令都会序列化、按顺序 地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。 </li>
</ul>
</li>
<li><p> <strong><code>没有隔离级别的概念</code></strong> </p>
</li>
<li><p>队列中的命令没有提交之前都不会实际被执行，因为事务提交前任何指令都不会被实际执行</p>
</li>
<li><p><strong><code>不保证原子性</code></strong> </p>
<ul>
<li><code>事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚 </code></li>
</ul>
</li>
</ul>
<h1 id="11-Redis-事务-秒杀案例"><a href="#11-Redis-事务-秒杀案例" class="headerlink" title="11.    **Redis_**事务_秒杀案例"></a>11.    **Redis_**<strong>事务</strong>_<strong>秒杀案例</strong></h1><h2 id="11-1-解决计数器和人员记录的事务操作"><a href="#11-1-解决计数器和人员记录的事务操作" class="headerlink" title="11.1 解决计数器和人员记录的事务操作"></a>11.1 解决计数器和人员记录的事务操作</h2><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210106.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152210106.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328200006326"></p>
<h2 id="11-2-Redis事务–秒杀并发模拟"><a href="#11-2-Redis事务–秒杀并发模拟" class="headerlink" title="11.2      Redis事务–秒杀并发模拟"></a>11.2      Redis事务–秒杀并发模拟</h2><p>使用工具ab模拟测试</p>
<p>CentOS6 默认安装</p>
<p>CentOS7需要手动安装</p>
<h3 id="11-2-1-联网"><a href="#11-2-1-联网" class="headerlink" title="11.2.1 联网"></a>11.2.1 联网</h3><p><strong><code>yum install httpd-tools</code></strong></p>
<h3 id="11-2-2-无网络"><a href="#11-2-2-无网络" class="headerlink" title="11.2.2 无网络"></a>11.2.2 无网络</h3><p>(1) 进入cd /run/media/root/CentOS 7 x86_64/Packages（路径跟centos6不同）</p>
<p>(2) 顺序安装</p>
<p>apr-1.4.8-3.el7.x86_64.rpm</p>
<p>apr-util-1.5.2-6.el7.x86_64.rpm</p>
<p>httpd-tools-2.4.6-67.el7.centos.x86_64.rpm</p>
<h3 id="11-2-3-测试及结果"><a href="#11-2-3-测试及结果" class="headerlink" title="11.2.3 测试及结果"></a>11.2.3 测试及结果</h3><h4 id="11-2-3-1-通过ab测试"><a href="#11-2-3-1-通过ab测试" class="headerlink" title="11.2.3.1 通过ab测试"></a>11.2.3.1 通过ab测试</h4><p>vim postfile 模拟表单提交参数,以&amp;符号结尾;存放当前目录。</p>
<p>内容：prodid=0101&amp;</p>
<p>ab -n 2000 -c 200 -k -p ~/postfile -T application/x-www-form-urlencoded <a target="_blank" rel="noopener" href="http://192.168.2.115:8081/Seckill/doseckill">http://192.168.2.115:8081/Seckill/doseckill</a></p>
<h4 id="11-2-3-2-超卖"><a href="#11-2-3-2-超卖" class="headerlink" title="11.2.3.2 超卖"></a>11.2.3.2 超卖</h4><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211856.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211856.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328200324215"></p>
<hr>
<h2 id="11-3-超卖问题"><a href="#11-3-超卖问题" class="headerlink" title="11.3 超卖问题"></a>11.3 超卖问题</h2><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211877.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211877.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328200346216"></p>
<hr>
<hr>
<h2 id="11-4-利用乐观锁淘汰用户，解决超卖问题。"><a href="#11-4-利用乐观锁淘汰用户，解决超卖问题。" class="headerlink" title="11.4      利用乐观锁淘汰用户，解决超卖问题。"></a>11.4      利用乐观锁淘汰用户，解决超卖问题。</h2><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211874.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211874.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328200423001"></p>
<hr>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211897.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211897.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328200449099" style="zoom:80%;" />

<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211127.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211127.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328200533256" style="zoom:80%;" />

<hr>
<h2 id="11-5-继续增加并发测试"><a href="#11-5-继续增加并发测试" class="headerlink" title="11.5 继续增加并发测试"></a>11.5 继续增加并发测试</h2><h3 id="11-5-1-连接有限制"><a href="#11-5-1-连接有限制" class="headerlink" title="11.5.1 连接有限制"></a>11.5.1 连接有限制</h3><p>ab -n 2000 -c 200 -k -p postfile -T ‘application/x-www-form-urlencoded’ <a target="_blank" rel="noopener" href="http://192.168.140.1:8080/seckill/doseckill">http://192.168.140.1:8080/seckill/doseckill</a></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211441.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211441.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328200626695"></p>
<p>增加-r参数，-r  Don’t exit on socket receive errors.</p>
<p><strong>ab -n 2000 -c 100 -r -p postfile -T ‘application/x-www-form-urlencoded’</strong> <a target="_blank" rel="noopener" href="http://192.168.140.1:8080/seckill/doseckill"><strong>http://192.168.140.1:8080/seckill/doseckill</strong></a></p>
<h3 id="11-5-2-已经秒光，可是还有库存"><a href="#11-5-2-已经秒光，可是还有库存" class="headerlink" title="11.5.2  已经秒光，可是还有库存"></a>11.5.2  <strong>已经秒光，可是还有库存</strong></h3><p>ab -n 2000 -c 100 -p postfile -T ‘application/x-www-form-urlencoded’ <a target="_blank" rel="noopener" href="http://192.168.137.1:8080/seckill/doseckill">http://192.168.137.1:8080/seckill/doseckill</a></p>
<p>已经秒光，可是还有库存。原因，就是乐观锁导致很多请求都失败。先点的没秒到，后点的可能秒到了。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211226.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211226.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328200716957"></p>
<hr>
<h3 id="11-5-3-连接超时，通过连接池解决"><a href="#11-5-3-连接超时，通过连接池解决" class="headerlink" title="11.5.3    连接超时，通过连接池解决"></a>11.5.3    <strong>连接超时，通过连接池解决</strong></h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211643.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211643.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328200759630"></p>
<h3 id="11-5-4-连接池"><a href="#11-5-4-连接池" class="headerlink" title="11.5.4 连接池"></a>11.5.4 连接池</h3><p>节省每次连接redis服务带来的消耗，把连接好的实例反复利用。</p>
<p>通过参数管理连接的行为</p>
<p>代码见项目中</p>
<ul>
<li>链接池参数<ul>
<li>MaxTotal：控制一个pool可分配多少个jedis实例，通过pool.getResource()来获取；如果赋值为-1，则表示不限制；如果pool已经分配了MaxTotal个jedis实例，则此时pool的状态为exhausted</li>
<li>maxIdle：控制一个pool最多有多少个状态为idle(空闲)的jedis实例；</li>
<li>MaxWaitMillis：表示当borrow一个jedis实例时，最大的等待毫秒数，如果超过等待时间，则直接抛JedisConnectionException；</li>
<li>testOnBorrow：获得一个jedis实例的时候是否检查连接可用性（ping()）；如果为true，则得到的jedis实例均是可用的；</li>
</ul>
</li>
</ul>
<h2 id="11-6-解决库存遗留问题"><a href="#11-6-解决库存遗留问题" class="headerlink" title="11.6 解决库存遗留问题"></a>11.6 解决库存遗留问题</h2><h3 id="11-6-1-LUA脚本"><a href="#11-6-1-LUA脚本" class="headerlink" title="11.6.1 LUA脚本"></a>11.6.1 <strong>LUA</strong>脚本</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211318.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211318.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328202821201"></p>
<hr>
<p>Lua 是一个小巧的<a target="_blank" rel="noopener" href="http://baike.baidu.com/item/%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80">脚本语言</a>，Lua脚本可以很容易的被C/C++ 代码调用，也可以反过来调用C/C++的函数，Lua并没有提供强大的库，一个完整的Lua解释器不过200k，所以Lua不适合作为开发独立应用程序的语言，而是作为嵌入式脚本语言。</p>
<p>很多应用程序、游戏使用LUA作为自己的嵌入式脚本语言，以此来实现可配置性、可扩展性。</p>
<p>这其中包括魔兽争霸地图、魔兽世界、博德之门、愤怒的小鸟等众多游戏插件或外挂。</p>
<p><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/lua/">https://www.w3cschool.cn/lua/</a></p>
<h3 id="11-6-2-LUA脚本在Redis中的优势"><a href="#11-6-2-LUA脚本在Redis中的优势" class="headerlink" title="11.6.2    LUA脚本在Redis中的优势"></a>11.6.2    <strong>LUA</strong>脚本在<strong>Redis</strong>中的优势</h3><p>将复杂的或者多步的redis操作，写为一个脚本，一次提交给redis执行，减少反复连接redis的次数。提升性能。</p>
<p>LUA脚本是类似redis事务，有一定的原子性，不会被其他命令插队，可以完成一些redis事务性的操作。</p>
<p>但是注意redis的lua脚本功能，只有在Redis 2.6以上的版本才可以使用。</p>
<p>利用lua脚本淘汰用户，解决超卖问题。</p>
<p>redis 2.6版本以后，通过lua脚本解决<strong>争抢问题</strong>，实际上是<strong>redis</strong> <strong>利用其单线程的特性，用任务队列的方式解决多任务并发问题</strong>。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211153.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211153.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220328203007281"></p>
<hr>
<h2 id="11-7-Redis-事务-秒杀案例-代码"><a href="#11-7-Redis-事务-秒杀案例-代码" class="headerlink" title="11.7    Redis_事务_秒杀案例_代码"></a>11.7    Redis_事务_秒杀案例_代码</h2><h1 id="12-Redis6持久化"><a href="#12-Redis6持久化" class="headerlink" title="12.Redis6持久化"></a>12.Redis6持久化</h1><h2 id="12-1-总体介绍"><a href="#12-1-总体介绍" class="headerlink" title="12.1 总体介绍"></a>12.1 总体介绍</h2><p>官网介绍：<a target="_blank" rel="noopener" href="http://www.redis.io/">http://www.redis.io</a></p>
<p><code>Redis 提供了2个不同形式的持久化方式。</code></p>
<ul>
<li>RDB（Redis DataBase）</li>
<li>AOF(Append Of File)</li>
</ul>
<h2 id="12-2-总结"><a href="#12-2-总结" class="headerlink" title="12.2 总结"></a>12.2 总结</h2><blockquote>
<p>①用哪个好</p>
</blockquote>
<p>官方推荐两个都启用。</p>
<p>如果对数据不敏感，可以选单独用RDB。</p>
<p>不建议单独用 AOF，因为可能会出现Bug。</p>
<p>如果只是做纯内存缓存，可以都不用</p>
<blockquote>
<p>⑤官网建议</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211308.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152211308.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329143823560"></p>
<ul>
<li><p>RDB持久化方式能够在指定的时间间隔能对你的数据进行快照存储</p>
</li>
<li><p>AOF持久化方式记录每次对服务器写的操作,当服务器重启的时候会重新执行这些命令来恢复原始的数据,AOF命令以redis协议追加保存每次写的操作到文件末尾. </p>
</li>
<li><p>Redis还能对AOF文件进行后台重写,使得AOF文件的体积不至于过大</p>
</li>
<li><p>只做缓存：如果你只希望你的数据在服务器运行的时候存在,你也可以不使用任何持久化方式.</p>
</li>
<li><p>同时开启两种持久化方式</p>
</li>
<li><p>在这种情况下,当redis重启的时候会优先载入AOF文件来恢复原始的数据, 因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整.</p>
</li>
<li><p>RDB的数据不实时，同时使用两者时服务器重启也只会找AOF文件。那要不要只使用AOF呢？ </p>
</li>
<li><p>建议不要，因为RDB更适合用于备份数据库(AOF在不断变化不好备份)， 快速重启，而且不会有AOF可能潜在的bug，留着作为一个万一的手段。</p>
</li>
<li><p>性能建议</p>
</li>
</ul>
<p>因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够了，只保留save 900 1这条规则。</p>
<p>如果使用AOF，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自己的AOF文件就可以了。</p>
<p>代价,一是带来了持续的IO，二是AOF rewrite的最后将rewrite过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。</p>
<p>只要硬盘许可，应该尽量减少AOF rewrite的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上。</p>
<p>默认超过原大小100%大小时重写可以改到适当的数值。</p>
<h1 id="13-RDB-Redis-DataBase"><a href="#13-RDB-Redis-DataBase" class="headerlink" title="13.RDB(Redis DataBase)"></a>13.RDB(<strong>Redis DataBase</strong>)</h1><h2 id="13-1-RDB是什么"><a href="#13-1-RDB是什么" class="headerlink" title="13.1  RDB是什么"></a>13.1  RDB是什么</h2><p><code>在指定的时间间隔内将内存中的数据集快照写入磁盘</code>， 也就是行话讲的<code>Snapshot快照</code>，它恢复时是将快照文件<code>直接读到内存里</code></p>
<p>时间间隔:每隔多长时间</p>
<p>数据集快照:略</p>
<h2 id="13-2-备份是如何执行的"><a href="#13-2-备份是如何执行的" class="headerlink" title="13.2 备份是如何执行的"></a>13.2 备份是如何执行的</h2><p>Redis会<code>单独创建一个子进程（fork)</code>来进行持久化，会先将数据写入到 一个<code>临时文件</code>中，<code>待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件</code>。 整个过程中，主进程是不进行任何IO操作的，这就确保了极高的性能 如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。</p>
<p><strong>RDB</strong>的缺点是<code>最后一次持久化后的数据可能丢失</code>。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212477.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212477.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329164125626"></p>
<h2 id="13-3-Fork"><a href="#13-3-Fork" class="headerlink" title="13.3  Fork"></a>13.3  Fork</h2><ul>
<li><p>Fork的作用是<code>复制一个与当前进程一样的进程</code>。新进程的<code>所有数据</code>（变量、环境变量、程序计数器等） 数值都<code>和原进程一致</code>，但是是一个全新的进程，并作为原进程的子进程</p>
</li>
<li><p>在Linux程序中，<code>fork()会产生一个和父进程完全相同的子进程</code>，但子进程在此后多会exec系统调用，出于效率考虑，Linux中引入了“**<code>写时复制技术</code>**”</p>
</li>
<li><p><strong>一般情况父进程和子进程会共用同一段物理内存</strong>，只有进程空间的各段的内容要发生变化时，才会将父进程的内容复制一份给子进程。</p>
</li>
</ul>
<h2 id="13-4-RDB持久化流程"><a href="#13-4-RDB持久化流程" class="headerlink" title="13.4      RDB持久化流程"></a>13.4      RDB持久化流程</h2><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212632.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212632.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329113016318"></p>
<hr>
<hr>
<h2 id="13-5-dump-rdb文件"><a href="#13-5-dump-rdb文件" class="headerlink" title="13.5    dump.rdb文件"></a>13.5    dump.rdb文件</h2><p>在redis.conf中配置文件名称，<code>默认为dump.rdb</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212431.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212431.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329165530714"></p>
<h2 id="13-6-配置位置"><a href="#13-6-配置位置" class="headerlink" title="13.6 配置位置"></a>13.6 配置位置</h2><p>rdb文件的保存路径，也可以修改。<code>默认为Redis启动时命令行所在的目录下</code>       ./&lt;=&gt;当前路径</p>
<p>dir “/myredis/“</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212398.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212398.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329165819281"></p>
<h2 id="13-7-如何触发RDB快照-保持策略"><a href="#13-7-如何触发RDB快照-保持策略" class="headerlink" title="13.7 如何触发RDB快照;保持策略"></a>13.7 如何触发RDB快照;保持策略</h2><h3 id="①配置文件中默认的快照配置"><a href="#①配置文件中默认的快照配置" class="headerlink" title="①配置文件中默认的快照配置"></a>①<strong>配置文件中默认的快照配置</strong></h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212869.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212869.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329113406718"></p>
<h3 id="②-命令save-VS-bgsave"><a href="#②-命令save-VS-bgsave" class="headerlink" title="② 命令save VS bgsave"></a>② <strong>命令</strong>save VS bgsave</h3><p>save ：save时只管保存，其它不管，全部阻塞。<code>手动保存</code>。不建议。</p>
<p><strong>bgsave</strong>：Redis会在后台异步进行快照操作，<strong>快照同时还可以响应客户端请求。</strong></p>
<p>可以通过lastsave 命令获取最后一次成功执行快照的时间</p>
<h3 id="③-flushall命令"><a href="#③-flushall命令" class="headerlink" title="③ flushall命令"></a>③ <strong>flushall</strong>命令</h3><p>执行flushall命令，也会产生dump.rdb文件，但里面是空的，无意义</p>
<h3 id="④SNAPSHOTTING快照"><a href="#④SNAPSHOTTING快照" class="headerlink" title="④SNAPSHOTTING快照"></a>④<strong>SNAPSHOTTING</strong>快照</h3><h3 id="⑤Save"><a href="#⑤Save" class="headerlink" title="⑤Save"></a>⑤<strong>Save</strong></h3><p>格式：save 秒钟 写操作次数</p>
<p>RDB是整个内存的压缩过的Snapshot，RDB的数据结构，可以配置复合的快照触发条件，</p>
<p><strong>默认是1</strong>分钟内改了<strong>1</strong>万次，或<strong>5</strong>分钟内改了<strong>10</strong>次，或<strong>15</strong>分钟内改了<strong>1</strong>次。</p>
<p>禁用</p>
<p>不设置save指令，或者给save传入空字符串</p>
<h3 id="⑥-stop-writes-on-bgsave-error"><a href="#⑥-stop-writes-on-bgsave-error" class="headerlink" title="⑥ stop-writes-on-bgsave-error"></a>⑥ <strong>stop-writes-on-bgsave-error</strong></h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212873.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212873.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329170408777"></p>
<p>当Redis无法写入磁盘的话，直接关掉Redis的写操作。推荐yes.</p>
<p><code>yes===&gt;关闭写操作</code></p>
<h3 id="⑦-rdbcompression-压缩文件"><a href="#⑦-rdbcompression-压缩文件" class="headerlink" title="⑦ rdbcompression 压缩文件"></a>⑦ <strong>rdbcompression</strong> <strong>压缩文件</strong></h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212178.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212178.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329113939203"></p>
<p>对于存储到磁盘中的快照，可以设置是否进行压缩存储。如果是的话，redis会采用LZF算法进行压缩。</p>
<p>如果你不想消耗CPU来进行压缩的话，可以设置为关闭此功能。推荐yes.</p>
<h3 id="⑧-rdbchecksum-检查完整性"><a href="#⑧-rdbchecksum-检查完整性" class="headerlink" title="⑧ rdbchecksum 检查完整性"></a>⑧ <strong>rdbchecksum</strong> <strong>检查完整性</strong></h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212253.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212253.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329114112269"></p>
<p>在存储快照后，还可以让redis使用CRC64算法来进行数据校验，</p>
<p>但是这样做会增加大约10%的性能消耗，如果希望获取到最大的性能提升，可以关闭此功能</p>
<p>推荐yes.</p>
<h3 id="⑨-rdb的备份"><a href="#⑨-rdb的备份" class="headerlink" title="⑨ rdb的备份"></a>⑨ r<strong>db</strong>的备份</h3><p>先通过config get dir 查询rdb文件的目录 </p>
<p>将*.rdb的文件拷贝到别的地方</p>
<p>rdb的恢复</p>
<ul>
<li>关闭Redis</li>
<li>先把备份的文件拷贝到工作目录下 cp dump2.rdb dump.rdb</li>
<li>启动Redis, 备份数据会直接加载</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212432.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212432.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220330111116452"></p>
<p>然后把redis停掉,把dump.rgb删掉</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212229.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212229.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220330111542242"></p>
<p>然后做恢复,把新加的那个改名回原先那个,然后启动redis==&gt;自动恢复<br><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212521.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212521.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220330111831210"></p>
<hr>
<hr>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212143.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212143.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220330104727474" style="zoom:80%;" />


<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212737.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212737.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220330104804792"></p>
<p>数据大小发生了变化==&gt;做了持久化</p>
<h2 id="13-8-优势"><a href="#13-8-优势" class="headerlink" title="13.8 优势"></a>13.8 优势</h2><ul>
<li><p>适合大规模的数据恢复</p>
</li>
<li><p>对数据完整性和一致性要求不高更适合使用</p>
</li>
<li><p>节省磁盘空间</p>
</li>
<li><p>恢复速度快</p>
</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212245.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212245.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329114331228"></p>
<h2 id="13-9-劣势"><a href="#13-9-劣势" class="headerlink" title="13.9 劣势"></a>13.9 劣势</h2><ul>
<li><p>Fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑</p>
</li>
<li><p>虽然Redis在fork时使用了<strong>写时拷贝技术</strong>,但是如果数据庞大时还是比较消耗性能。</p>
</li>
<li><p>在备份周期在一定间隔时间做一次备份，所以如果Redis意外down掉的话，就会丢失最后一次快照后的所有修改。</p>
</li>
</ul>
<h2 id="13-10-如何停止"><a href="#13-10-如何停止" class="headerlink" title="13.10  如何停止"></a>13.10  如何停止</h2><p>动态停止RDB：redis-cli config set save “”#save后给空值，表示禁用保存策略</p>
<h2 id="13-11-小总结"><a href="#13-11-小总结" class="headerlink" title="13.11 小总结"></a>13.11 小总结</h2><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212136.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152212136.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329114450079"></p>
<h1 id="14-AOF-（Append-Only-File）"><a href="#14-AOF-（Append-Only-File）" class="headerlink" title="14.AOF （Append Only File）"></a>14.AOF <strong>（Append Only File）</strong></h1><h2 id="14-1-是什么"><a href="#14-1-是什么" class="headerlink" title="14.1   是什么"></a>14.1   是什么</h2><p><code>以日志的形式来记录每个写操作</code>（增量保存），将Redis执行过的所有<code>写指令记录下来(读操作不记录)</code>， **<code>只许追加文件但不可以改写文件</code>**，redis启动之初会读取该文件重新构建数据，换言之，<code>redis 重启的话就根据日志文件的内容将写指令从前到后执行一次 以完成数据的恢复工作</code></p>
<h2 id="14-2-AOF持久化流程"><a href="#14-2-AOF持久化流程" class="headerlink" title="14.2 AOF持久化流程"></a>14.2 AOF持久化流程</h2><p>（1）客户端的请求写命令会被append追加到AOF缓冲区内；</p>
<p>（2）AOF缓冲区根据AOF持久化策略[always,everysec,no]将操作sync同步到磁盘的AOF文件中；</p>
<p>（3）AOF文件大小超过重写策略或手动重写时，会对AOF文件rewrite重写，压缩AOF文件容量；</p>
<p>（4）Redis服务重启时，会重新load加载AOF文件中的写操作达到数据恢复的目的；</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213910.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213910.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329142110663"></p>
<h2 id="14-3-AOF默认不开启"><a href="#14-3-AOF默认不开启" class="headerlink" title="14.3    AOF默认不开启"></a>14.3    AOF默认不开启</h2><p>可以在redis.conf中配置文件名称，默认为 <code>appendonly.aof</code></p>
<p><code>AOF文件的保存路径，同RDB的路径一致</code>。</p>
<h2 id="14-4-AOF和RDB同时开启-redis听谁的？"><a href="#14-4-AOF和RDB同时开启-redis听谁的？" class="headerlink" title="14.4     AOF和RDB同时开启,redis听谁的？"></a>14.4     AOF和RDB同时开启,redis听谁的？</h2><p><code>AOF和RDB同时开启，系统默认取AOF的数据（数据不会存在丢失）</code></p>
<h2 id="14-5-AOF启动-修复-恢复"><a href="#14-5-AOF启动-修复-恢复" class="headerlink" title="14.5         AOF启动/修复/恢复"></a>14.5         AOF启动/修复/恢复</h2><ul>
<li><p>AOF的备份机制和性能虽然和RDB不同, 但是备份和恢复的操作同RDB一样，都是拷贝备份文件，需要恢复时再拷贝到Redis工作目录下，启动系统即加载。</p>
</li>
<li><p>正常恢复</p>
<ul>
<li>修改默认的appendonly no，改为yes</li>
<li>将有数据的aof文件复制一份保存到对应目录(查看目录：config get dir)</li>
<li>恢复：重启redis然后重新加载</li>
</ul>
</li>
<li><p>异常恢复</p>
<ul>
<li>修改默认的appendonly no，改为yes</li>
<li>如遇到<strong>AOF</strong>文件损坏**，通过/usr/local/bin/<strong>redis-check-aof–fix appendonly.aof</strong>进行恢复</li>
<li>备份被写坏的AOF文件</li>
<li>恢复：重启redis，然后重新加载</li>
</ul>
</li>
</ul>
<h2 id="14-6-AOF同步频率设置"><a href="#14-6-AOF同步频率设置" class="headerlink" title="14.6       AOF同步频率设置"></a>14.6       AOF同步频率设置</h2><p>appendfsync always</p>
<p>始终同步，每次Redis的写入都会立刻记入日志；性能较差但数据完整性比较好</p>
<p>appendfsync everysec</p>
<p>每秒同步，每秒记入日志一次，如果宕机，本秒的数据可能丢失。</p>
<p>appendfsync no</p>
<p>redis不主动进行同步，把同步时机交给操作系统。</p>
<h2 id="14-7-Rewrite压缩"><a href="#14-7-Rewrite压缩" class="headerlink" title="14.7      Rewrite压缩"></a>14.7      Rewrite压缩</h2><blockquote>
<p>1是什么：</p>
</blockquote>
<p>AOF采用文件追加方式，文件会越来越大为避免出现此种情况，新增了重写机制, 当AOF文件的大小超过所设定的阈值时，Redis就会启动AOF文件的内容压缩， 只保留可以恢复数据的最小指令集.可以使用命令bgrewriteaof</p>
<blockquote>
<p>2重写原理，如何实现重写</p>
</blockquote>
<p>AOF文件持续增长而过大时，会fork出一条新进程来将文件重写(也是先写临时文件最后再rename)，redis4.0版本后的重写，是指上就是把rdb 的快照，以二级制的形式附在新的aof头部，作为已有的历史数据，替换掉原来的流水账操作。</p>
<p>no-appendfsync-on-rewrite：</p>
<p>如果 no-appendfsync-on-rewrite=yes ,不写入aof文件只写入缓存，用户请求不会阻塞，但是在这段时间如果宕机会丢失这段时间的缓存数据。（降低数据安全性，提高性能）</p>
<p>   如果 no-appendfsync-on-rewrite=no, 还是会把数据往磁盘里刷，但是遇到重写操作，可能会发生阻塞。（数据安全，但是性能降低）</p>
<p>触发机制，何时重写</p>
<p>Redis会记录上次重写时的AOF大小，默认配置是当AOF文件大小是上次rewrite后大小的一倍且文件大于64M时触发</p>
<p>重写虽然可以节约大量磁盘空间，减少恢复时间。但是每次重写还是有一定的负担的，因此设定Redis要满足一定条件才会进行重写。 </p>
<p>auto-aof-rewrite-percentage：设置重写的基准值，文件达到100%时开始重写（文件是原来重写后文件的2倍时触发）</p>
<p>auto-aof-rewrite-min-size：设置重写的基准值，最小文件64MB。达到这个值开始重写。</p>
<p>例如：文件达到70MB开始重写，降到50MB，下次什么时候开始重写？100MB</p>
<p>系统载入时或者上次重写完毕时，Redis会记录此时AOF大小，设为base_size,</p>
<p>如果Redis的AOF当前大小&gt;= base_size +base_size*100% (默认)且当前大小&gt;=64mb(默认)的情况下，Redis会对AOF进行重写。 </p>
<blockquote>
<p>3、重写流程</p>
</blockquote>
<p>（1）bgrewriteaof触发重写，判断是否当前有bgsave或bgrewriteaof在运行，如果有，则等待该命令结束后再继续执行。</p>
<p>（2）主进程fork出子进程执行重写操作，保证主进程不会阻塞。</p>
<p>（3）子进程遍历redis内存中数据到临时文件，客户端的写请求同时写入aof_buf缓冲区和aof_rewrite_buf重写缓冲区保证原AOF文件完整以及新AOF文件生成期间的新的数据修改动作不会丢失。</p>
<p>（4）1).子进程写完新的AOF文件后，向主进程发信号，父进程更新统计信息。2).主进程把aof_rewrite_buf中的数据写入到新的AOF文件。</p>
<p>（5）使用新的AOF文件覆盖旧的AOF文件，完成AOF重写。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213902.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213902.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329143004521"></p>
<h2 id="14-8-优势"><a href="#14-8-优势" class="headerlink" title="14.8 优势"></a>14.8 优势</h2><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213971.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213971.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329143216688"></p>
<hr>
<hr>
<ul>
<li><p>备份机制更稳健，丢失数据概率更低。</p>
</li>
<li><p>可读的日志文本，通过操作AOF稳健，可以处理误操作</p>
</li>
</ul>
<h2 id="14-9-劣势"><a href="#14-9-劣势" class="headerlink" title="14.9 劣势"></a>14.9 劣势</h2><ul>
<li><p>比起RDB占用更多的磁盘空间。</p>
</li>
<li><p>恢复备份速度要慢。</p>
</li>
<li><p>每次读 写都同步的话，有一定的性能压力。</p>
</li>
<li><p>存在个别Bug，造成恢复不能。</p>
</li>
</ul>
<h2 id="14-10-小总结"><a href="#14-10-小总结" class="headerlink" title="14.10 小总结"></a>14.10 小总结</h2><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213026.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213026.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329143355012"></p>
<h1 id="15-Redis6的主从复制"><a href="#15-Redis6的主从复制" class="headerlink" title="15.Redis6的主从复制"></a>15.Redis6的主从复制</h1><h2 id="15-1-是什么"><a href="#15-1-是什么" class="headerlink" title="15.1 是什么"></a>15.1 是什么</h2><p><code>主机数据更新后根据配置和策略， 自动同步到备机的master/slaver机制</code>，**<code>Master</code>**<code>以写为主</code>，<code>Slave以读为主</code></p>
<h2 id="15-2-能干什么"><a href="#15-2-能干什么" class="headerlink" title="15.2 能干什么"></a>15.2 能干什么</h2><ul>
<li><p><code>读写分离，性能扩展</code>;主里面做写操作,从里面做读操作</p>
</li>
<li><p><code>容灾快速恢复</code>:当你一台从挂掉了,快速去找其他从</p>
<pre><code>                         ==&gt;`一主多从`==&gt;必须只能有一台主服务器 
                         ==&gt;那么主机要是挂了怎么办====&gt;`集群`
</code></pre>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213289.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213289.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220330113811118"></p>
</li>
</ul>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213579.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213579.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329153131343"></p>
<h2 id="15-3-怎么做-做一个一主两从的案例"><a href="#15-3-怎么做-做一个一主两从的案例" class="headerlink" title="15.3 怎么做(做一个一主两从的案例)"></a>15.3 怎么做(做一个一主两从的案例)</h2><h3 id="1-创建-myredis文件夹"><a href="#1-创建-myredis文件夹" class="headerlink" title="1 .创建/myredis文件夹"></a>1 .创建/myredis文件夹</h3><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213165.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213165.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423161338530" style="zoom:200%;" />

<h3 id="2-复制redis-conf到文件夹中-作为公共文件"><a href="#2-复制redis-conf到文件夹中-作为公共文件" class="headerlink" title="2 .复制redis.conf到文件夹中(作为公共文件)"></a>2 .复制redis.conf到文件夹中(作为公共文件)</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">cp <span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf <span class="token operator">/</span>myredis<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213232.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213232.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423161605991"></p>
<h3 id="3-配置一主两从-创建三个配置文件-在三个配置文件中写入内容"><a href="#3-配置一主两从-创建三个配置文件-在三个配置文件中写入内容" class="headerlink" title="3 .配置一主两从,创建三个配置文件,在三个配置文件中写入内容"></a>3 .配置一主两从,创建三个配置文件,在三个配置文件中写入内容</h3><p>首先:关闭AOF</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213880.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213880.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423162918298"><br>改为<code>no</code>,保存,退出</p>
<hr>
<hr>
<p>一主两从,要用不同端口启动,木的办法,因为我们是在同一个电脑里面</p>
<p><code>redis6379.conf</code></p>
<ol>
<li><p>使用vim创建配置文件</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">vi redis6379<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>使用vim编写配置文件,通过include形式引入基础部分,其他的我们自己配</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">include <span class="token operator">/</span>myredis<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf  
 #通过include引入公共文件

pidfile <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>redis_6379<span class="token punctuation">.</span>pid
#配置pid的一个位置

port <span class="token number">6379</span>
# 端口

dbfilename dump6379<span class="token punctuation">.</span>rdb 
#rdb文件的名称<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213740.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213740.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423164621636"></p>
</li>
<li><p>保存退出<br><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213147.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213147.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423164655300"></p>
</li>
<li><p>根据这个配置文件复制出另外两个</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">cp redis6379<span class="token punctuation">.</span>conf redis6380<span class="token punctuation">.</span>conf

cp redis6379<span class="token punctuation">.</span>conf redis6381<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213354.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213354.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423165432256"></p>
</li>
<li><p>然后去两个文件中更改内容<br><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213537.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152213537.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423185335287"><br>改成和文件名里数字相对应的</p>
<h3 id="4-启动redis服务-首先要进到-myredis"><a href="#4-启动redis服务-首先要进到-myredis" class="headerlink" title="4.启动redis服务(首先要进到/myredis)"></a>4.启动redis服务(首先要进到/myredis)</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214539.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214539.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423190103241"></p>
</li>
</ol>
<p>这三个服务虽然启动了,但是并没有主从的效果,这三个是独立的</p>
<h3 id="5-连上并查看三台主机运行情况"><a href="#5-连上并查看三台主机运行情况" class="headerlink" title="5.连上并查看三台主机运行情况"></a>5.连上并查看三台主机运行情况</h3><blockquote>
<p>分别连上这三个服务进行查看</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">redis<span class="token operator">-</span>cli <span class="token operator">-</span>p <span class="token number">6379</span>

redis<span class="token operator">-</span>cli <span class="token operator">-</span>p <span class="token number">6380</span>

redis<span class="token operator">-</span>cli <span class="token operator">-</span>p <span class="token number">6381</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214444.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214444.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423195143070" style="zoom:67%;" />

<hr>
<hr>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">info replication<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面这个命令可以查看主从</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214634.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214634.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423195518915" style="zoom:67%;" />

<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214450.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214450.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423195749006" style="zoom:67%;" />

<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214772.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214772.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423195909394" style="zoom:67%;" />

<p>===&gt;<strong><code>都是相互独立的,没有主从效果,都是主机</code></strong></p>
<h3 id="6配从-库-不配主-库"><a href="#6配从-库-不配主-库" class="headerlink" title="6配从(库)不配主(库)"></a>6<strong>配从(库</strong>)不配主(库)</h3><blockquote>
<p>弄出主从效果来</p>
</blockquote>
<p>成为某个实例的从服务器:</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">slaveof <span class="token operator">&lt;</span>ip<span class="token operator">></span><span class="token operator">&lt;</span>port<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ip是<code>主机</code>ip    <strong><code>这个ip不是linux的,而是windows的127.0.0.1</code></strong>    </p>
<p>port是<code>主机</code>端口号</p>
<blockquote>
<p>1、在从机上(6380和6381)执行: slaveof 127.0.0.1 6379</p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214458.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214458.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423201422534" style="zoom:67%;" />

<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214813.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214813.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423201751409" style="zoom:67%;" />

<p>去主机里面看看</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214848.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214848.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423202207664" style="zoom:67%;" />

<h3 id="7-在主机上写，在从机上可以读取数据"><a href="#7-在主机上写，在从机上可以读取数据" class="headerlink" title="7.在主机上写，在从机上可以读取数据"></a>7.在主机上写，在从机上可以读取数据</h3><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214064.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214064.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423202917906" style="zoom:67%;" />

<hr>
<p><code>主机:</code></p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214600.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214600.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423204623219" style="zoom:67%;" />

<hr>
<p><code>从机</code>:</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214284.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214284.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423204723109" style="zoom:67%;" />

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214284.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152214284.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423204751288"></p>
<blockquote>
<p><strong><code>强调:从机里面只能做读操作!!主机读写都可以,但是一般只用来写,读从机来分担服务器压力</code></strong></p>
</blockquote>
<hr>
<blockquote>
<p>主机挂掉，重启就行，一切如初</p>
</blockquote>
<blockquote>
<p>从机重启需重设：slaveof 127.0.0.1 6379</p>
</blockquote>
<p>可以将配置增加到文件中。永久生效。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215036.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215036.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329155943977"></p>
<h2 id="15-4-常用三招"><a href="#15-4-常用三招" class="headerlink" title="15.4   常用三招"></a>15.4   常用三招</h2><h3 id="①一主二仆"><a href="#①一主二仆" class="headerlink" title="①一主二仆"></a>①一主二仆</h3><p>切入点问题？slave1、slave2是从头开始复制还是从切入点开始复制?比如从k4进来，那之前的k1,k2,k3是否也可以复制？</p>
<p>从机是否可以写？set可否？ </p>
<p>主机shutdown后情况如何？从机是上位还是原地待命？</p>
<p>主机又回来了后，主机新增记录，从机还能否顺利复制？ </p>
<p>其中一台从机down后情况如何？依照原有它能跟上大部队吗？</p>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215371.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215371.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329160332024"></p>
<hr>
<blockquote>
<p>把一个从机挂掉,主机进行写操作</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215906.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215906.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423211957738"></p>
<hr>
<blockquote>
<p>把挂掉的从机重启</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215069.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215069.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423212308659"></p>
<p><strong><code>重启之后又变成了主服务器</code></strong></p>
<blockquote>
<p>把挂掉又重启的服务器变成从机,然后查询</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215391.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215391.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220423212532183"></p>
<hr>
<hr>
<hr>
<blockquote>
<p>把主服务器挂掉</p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215575.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152215575.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424094706047" style="zoom:67%;" />

<blockquote>
<p>去从服务器里面看看内容</p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216275.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216275.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424094845650" style="zoom:50%;" />

<p><code>从机是忠心耿耿啊</code></p>
<blockquote>
<p>把主服务器重启启动起来</p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216354.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216354.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424095238870" style="zoom:80%;" />

<p><code>重启之后还是主服务器</code></p>
<h3 id="②-薪火相传"><a href="#②-薪火相传" class="headerlink" title="② 薪火相传"></a>② 薪火相传</h3><p>上一个Slave可以是下一个slave的Master，Slave同样可以接收其他 slaves的连接和同步请求，那么该slave作为了链条中下一个的master, 可以有效减轻master的写压力,去中心化降低风险。</p>
<p>用 slaveof <ip><port></p>
<p>中途变更转向:会清除之前的数据，重新建立拷贝最新的</p>
<p>风险是一旦某个slave宕机，后面的slave都没法备份</p>
<p>主机挂了，从机还是从机，无法写数据了</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216168.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216168.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329160356274"></p>
<hr>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216584.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216584.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424100226680" style="zoom:50%;" />

<hr>
<blockquote>
<p>把6380变成6381的从服务器</p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216432.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216432.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424100900824" style="zoom:80%;" />

<p>特点和一主二仆类似:</p>
<p><code>主服务器挂掉了,从服务器还是从服务器,主服务器重启之后依旧是主服务器</code></p>
<h3 id="③-反客为主"><a href="#③-反客为主" class="headerlink" title="③  反客为主"></a>③  反客为主</h3><p><code>当一个master宕机后，后面的slave可以立刻升为master，其后面的slave不用做任何修改。</code></p>
<blockquote>
<p>用<code>slaveof no one</code> 将从机变为主机。</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216072.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216072.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329160441859"></p>
<p><code>缺点:这是手动完成的</code></p>
<p>自动完成场景:</p>
<p>在运行状态,服务器主机挂掉了,运营人员能够马上知道并且重启==&gt;太难了,很麻烦</p>
<p>==&gt;<code>自动完成</code>==&gt;<strong><code>哨兵模式</code></strong></p>
<h2 id="15-5-复制原理"><a href="#15-5-复制原理" class="headerlink" title="15.5 复制原理"></a>15.5 复制原理</h2><ul>
<li><p>Slave启动成功连接到master后会发送一个sync命令</p>
</li>
<li><p>Master接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令， 在后台进程执行完毕之后，master将传送整个数据文件到slave,以完成一次完全同步</p>
</li>
<li><p>全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。</p>
</li>
<li><p>增量复制：Master继续将新的所有收集到的修改命令依次传给slave,完成同步</p>
</li>
<li><p>但是只要是重新连接master,一次完全同步（全量复制)将被自动执行</p>
</li>
</ul>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216603.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216603.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329160539577"></p>
<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216784.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216784.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424095641536"></p>
<hr>
<hr>
<h2 id="15-6-哨兵模式-sentinel"><a href="#15-6-哨兵模式-sentinel" class="headerlink" title="15.6 哨兵模式  (sentinel)"></a>15.6 哨兵模式  (sentinel)</h2><h3 id="①是什么"><a href="#①是什么" class="headerlink" title="①是什么"></a>①是什么</h3><p><strong>反客为主的自动版</strong>，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216191.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216191.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329160704907"></p>
<h3 id="②使用步骤"><a href="#②使用步骤" class="headerlink" title="②使用步骤"></a>②使用步骤</h3><blockquote>
<p>1 .<strong>调整为一主二仆模式，</strong>6379<strong>带着6380</strong>、6381</p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216752.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216752.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424104523562" style="zoom:80%;" />

<blockquote>
<p>2 .<strong>自定义的</strong>/myredis目录下新建sentinel.conf文件，名字绝不能错</p>
</blockquote>
<p>为了明显,再打开一个客户端的连接,在里面创建文件</p>
<pre class="line-numbers language-kot" data-language="kot"><code class="language-kot">cd &#x2F;myredis
vi sentinel.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216356.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216356.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424104905405" style="zoom:80%;" />

<blockquote>
<p>3 .配置哨兵,填写内容</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">sentinel monitor mymaster <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span> <span class="token number">1</span>

sentinel monitor 给监控对象起的名称 主机 端口号 <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>其中mymaster为监控对象起的服务器名称</p>
<p><code> 1 为至少有多少个哨兵同意迁移的数量</code>例如本例一主二仆,1就表示主机挂了,一个从机同意就可以切换</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216600.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216600.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424105449683"></p>
<blockquote>
<p>4 .启动哨兵</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">redis<span class="token operator">-</span>sentinel sentinel<span class="token punctuation">.</span>conf <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216751.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216751.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424110249631" style="zoom:50%;" />

<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216381.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152216381.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424110444622" style="zoom:50%;" />



<blockquote>
<p>5 .当主机挂掉,从机制选举中产生新的主机</p>
</blockquote>
<p>(大概10秒左右可以看到哨兵窗口日志，切换了新的主机)</p>
<p>哪个从机会被选举为主机呢？</p>
<p><code>根据优先级别：slave-priority </code></p>
<p><code>原主机重启后会变为从机。</code></p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217028.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217028.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424110835062" style="zoom:67%;" />

<hr>
<blockquote>
<p>6 .复制延时</p>
</blockquote>
<p>由于所有的写操作都是先在Master上操作，然后同步更新到Slave上，所以从Master同步到Slave机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加 严重，Slave机器数量的增加也会使这个问题更加严重。</p>
<h3 id="③-故障恢复"><a href="#③-故障恢复" class="headerlink" title="③  故障恢复"></a>③  故障恢复</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217736.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217736.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220329161407724"></p>
<p>优先级在redis.conf中默认：slave-priority 100，值越小优先级越高</p>
<p>偏移量是指获得原主机数据最全的</p>
<p>每个redis实例启动后都会随机生成一个40位的runid</p>
<h3 id="④主从复制"><a href="#④主从复制" class="headerlink" title="④主从复制"></a>④主从复制</h3><blockquote>
<p>写java代码识别哪个是主哪个是从?==&gt;改一下连接池</p>
</blockquote>
<p>sentinelSet.add(“192.168.11.103:26379”);</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">JedisSentinelPool</span> jedisSentinelPool<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span>  <span class="token class-name">Jedis</span> <span class="token function">getJedisFromSentinel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>jedisSentinelPool<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> sentinelSet<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sentinelSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"192.168.11.103:26379"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">JedisPoolConfig</span> jedisPoolConfig <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">JedisPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//最大可用连接数</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//最大闲置连接数</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMinIdle</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//最小闲置连接数</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setBlockWhenExhausted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//连接耗尽是否等待</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//等待时间</span>
jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setTestOnBorrow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//取连接的时候进行一下测试 ping pong</span>

jedisSentinelPool<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">JedisSentinelPool</span><span class="token punctuation">(</span><span class="token string">"mymaster"</span><span class="token punctuation">,</span>sentinelSet<span class="token punctuation">,</span>jedisPoolConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> jedisSentinelPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
<span class="token keyword">return</span> jedisSentinelPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="15-7-关闭主从复制"><a href="#15-7-关闭主从复制" class="headerlink" title="15.7 关闭主从复制"></a>15.7 关闭主从复制</h2><p><strong><code>就是让它挂掉就ok了</code></strong>:star::star:</p>
<p>1.<code>redis-cli -p 端口号</code>  进去</p>
<p>2.shutdown   exit</p>
<p><strong><code>直接×掉是不会关闭主从复制的,再次打开依旧是主从复制状态</code></strong></p>
<blockquote>
<p>和关闭redis一样</p>
</blockquote>
<h1 id="16-Redis6集群"><a href="#16-Redis6集群" class="headerlink" title="16.Redis6集群"></a>16.Redis6集群</h1><h2 id="16-1-问题"><a href="#16-1-问题" class="headerlink" title="16.1 问题"></a>16.1 问题</h2><p>容量不够，redis如何进行扩容？</p>
<p>并发写操作， redis如何分摊？</p>
<blockquote>
<p>另外，主从模式，薪火相传模式，主机宕机，导致ip地址发生变化，应用程序中配置需要修改对应的主机地址、端口等信息。</p>
</blockquote>
<p>之前通过代理主机来解决</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217107.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217107.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424113736995" style="zoom:50%;" />

<p>但是redis3.0中提供了解决方案。就是**<code>无中心化集群配置</code>**。</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217570.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217570.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424113943510" style="zoom:67%;" />

<p><code>任何一台服务器都可以作为集群的入口,他们之间互相连通</code></p>
<h2 id="16-2-什么是集群"><a href="#16-2-什么是集群" class="headerlink" title="16.2.什么是集群"></a>16.2.什么是集群</h2><blockquote>
<p>Redis 集群实现了对Redis的水平扩容，即启动N个redis节点，将整个数据库分布存储在这N个节点中，每个节点存储总数据的1/N。</p>
</blockquote>
<p>Redis 集群通过分区（partition）来提供一定程度的可用性（availability）： 即使集群中有一部分节点失效或者无法进行通讯， 集群也可以继续处理命令请求。</p>
<h2 id="16-3-搭建redis集群"><a href="#16-3-搭建redis集群" class="headerlink" title="16.3 搭建redis集群"></a>16.3 搭建redis集群</h2><blockquote>
<p>用六台服务器搭建出来一个redis的集群</p>
</blockquote>
<h3 id="16-3-1-删除持久化数据"><a href="#16-3-1-删除持久化数据" class="headerlink" title="16.3. 1 删除持久化数据"></a>16.3. 1 删除持久化数据</h3><p>将rdb,aof文件都删除掉。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217955.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217955.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424141945141"></p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">rm <span class="token operator">-</span>rf dump63<span class="token operator">*</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217971.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217971.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424142139945"></p>
<h3 id="16-3-2-制作6个实例，6379-6380-6381-6389-6390-6391"><a href="#16-3-2-制作6个实例，6379-6380-6381-6389-6390-6391" class="headerlink" title="16.3.2  制作6个实例，6379,6380,6381,6389,6390,6391"></a>16.3.2  制作6个实例，6379,6380,6381,6389,6390,6391</h3><h4 id="16-3-2-1-配置基本信息"><a href="#16-3-2-1-配置基本信息" class="headerlink" title="16.3.2.1.  配置基本信息"></a><strong>16.3.2.1.</strong>  <strong>配置基本信息</strong></h4><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217367.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217367.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424142808336"></p>
<h4 id="16-3-2-2-redis-cluster配置修改"><a href="#16-3-2-2-redis-cluster配置修改" class="headerlink" title="16.3.2.2.  redis cluster配置修改"></a><strong>16.3.2.2.</strong>  <strong>redis cluster</strong>配置修改</h4><blockquote>
<p>用vim打开配置文件在里面修改</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">cluster<span class="token operator">-</span>enabled yes  #打开集群模式

cluster<span class="token operator">-</span>config<span class="token operator">-</span>file nodes<span class="token operator">-</span><span class="token number">6379</span><span class="token punctuation">.</span>conf #设定节点配置文件名

 
cluster<span class="token operator">-</span>node<span class="token operator">-</span>timeout <span class="token number">15000</span>  #设定节点失联时间，超过该时间（毫秒），集群自动进行主从切换。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217341.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217341.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424143119324"></p>
<h4 id="16-3-2-3-删除redis6380-conf和redis6381-conf"><a href="#16-3-2-3-删除redis6380-conf和redis6381-conf" class="headerlink" title="16.3.2.3 删除redis6380.conf和redis6381.conf"></a>16.3.2.3 删除redis6380.conf和redis6381.conf</h4><p> <code>这两个是在学习主从复制的时候创建的</code></p>
 <pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">rm <span class="token operator">-</span>rf redis6380<span class="token punctuation">.</span>conf

rm <span class="token operator">-</span>rf redis6381<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217811.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217811.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424143641446" style="zoom:67%;" />

<h4 id="16-3-2-4-修改好redis6379-conf文件，拷贝多个redis-conf文件"><a href="#16-3-2-4-修改好redis6379-conf文件，拷贝多个redis-conf文件" class="headerlink" title="16.3.2.4.  修改好redis6379.conf文件，拷贝多个redis.conf文件"></a><strong>16.3.2.4.</strong>  <strong>修改好redis6379</strong>.conf文件，拷贝多个redis.conf文件</h4><blockquote>
<p>通过上面几步,已经创建好一个配置文件了,再复制出5个来</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">cp redis6379<span class="token punctuation">.</span>conf redis6380<span class="token punctuation">.</span>conf

cp redis6379<span class="token punctuation">.</span>conf redis6381<span class="token punctuation">.</span>conf

cp redis6379<span class="token punctuation">.</span>conf redis6389<span class="token punctuation">.</span>conf

cp redis6379<span class="token punctuation">.</span>conf redis6390<span class="token punctuation">.</span>conf

cp redis6379<span class="token punctuation">.</span>conf redis6391<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217909.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217909.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424144449840" style="zoom:67%;" />

<blockquote>
<p>去复制出来的文件里面修改端口号,,,,,,</p>
</blockquote>
<p><strong><code>使用vim打开配置文件,使用命令替换</code></strong></p>
<p>先输冒号进入..模式,然后再输入下面内容</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token operator">%</span>s<span class="token operator">/</span><span class="token number">6379</span><span class="token operator">/</span><span class="token number">6380</span>
#把<span class="token number">6379</span>替换成<span class="token number">6380</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>以相同方式替换掉另外四个</p>
<h3 id="16-3-3-启动6个redis服务"><a href="#16-3-3-启动6个redis服务" class="headerlink" title="16.3.3  启动6个redis服务"></a><strong>16.3.3</strong>  <strong>启动6个</strong>redis服务</h3><p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217221.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152217221.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424151917705"></p>
<hr>
<p>保证启动都是成功的,通过ps命令查看进程</p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">ps <span class="token operator">-</span>ef | grep redis<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218378.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218378.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424153911328"></p>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218384.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218384.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424155013401" style="zoom:200%;" />

<blockquote>
<p><code>没成功,79,80,81没有cluster和nodes文件,是主从复制的时候配置的主从关系还在,先解除主从关系</code></p>
</blockquote>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218732.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218732.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424160728872" style="zoom: 67%;" />

<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218079.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218079.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424160832890"></p>
<blockquote>
<p>果然是因为这个,关闭</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218406.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218406.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424160940680"></p>
<p>然后重启,ok</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218381.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152218381.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424161322675" style="zoom:67%;" />

<h3 id="16-3-4-将六个节点合成一个集群"><a href="#16-3-4-将六个节点合成一个集群" class="headerlink" title="16.3.4  将六个节点合成一个集群"></a>16.3.4  将六个节点合成一个集群</h3><p><code>组合之前，请确保所有redis实例启动后，nodes-xxxx.conf文件都生成正常。</code></p>
<blockquote>
<p>合体：</p>
</blockquote>
<p><strong><code>第一步,进入src目录下</code></strong></p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">cd <span class="token operator">/</span>home<span class="token operator">/</span>gy<span class="token operator">/</span>redis6<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">6.2</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">/</span>src<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>如果用的是比较老旧的版本,需要额外装一个环境,但是我们用的是最新版6.2.1,就不需要装了,他帮我们装好了</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219503.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219503.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424185005703"></p>
<p> <strong><code>第二步,输入一下命令</code></strong></p>
 <pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">redis<span class="token operator">-</span>cli <span class="token operator">--</span>cluster  create <span class="token operator">--</span>cluster<span class="token operator">-</span>replicas <span class="token number">1</span> ip1<span class="token operator">:</span>端口号<span class="token number">1</span> ip2<span class="token operator">:</span>端口号<span class="token number">2</span>  ip3<span class="token operator">:</span>端口号<span class="token number">3</span> ip4<span class="token operator">:</span>端口号<span class="token number">4</span> ip5<span class="token operator">:</span>端口号<span class="token number">5</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">redis<span class="token operator">-</span>cli <span class="token operator">--</span>cluster  create <span class="token operator">--</span>cluster<span class="token operator">-</span>replicas <span class="token number">1</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">88.3</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">88.3</span><span class="token operator">:</span><span class="token number">6380</span>  <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">88.3</span><span class="token operator">:</span><span class="token number">6381</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">88.3</span><span class="token operator">:</span><span class="token number">6389</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">88.3</span><span class="token operator">:</span><span class="token number">6390</span>  <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">88.3</span><span class="token operator">:</span><span class="token number">6391</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>此处不要用127.0.0.1， 请用真实IP地址</p>
</blockquote>
<p>我自己的电脑的linux是192.168.88.3</p>
<blockquote>
<p>–replicas 1 采用最简单的方式配置集群，一台主机，一台从机，6台服务器,正好三组。</p>
</blockquote>
<p><strong><code>1代表一个主机有一个从机,如果是2就代表一个主机有两个从机</code></strong></p>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219004.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219004.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424210040686" style="zoom:200%;" />

<hr>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219670.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219670.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424210143913" style="zoom:80%;" />

<p><strong><code>ok</code></strong></p>
<p> 16384 slots covered</p>
<h3 id="16-3-5-c-采用集群策略连接，设置数据会自动切换到相应的写主机"><a href="#16-3-5-c-采用集群策略连接，设置数据会自动切换到相应的写主机" class="headerlink" title="16.3.5     -c 采用集群策略连接，设置数据会自动切换到相应的写主机"></a><strong>16.3.5</strong>     <strong>-c</strong> <strong>采用集群策略连接，设置数据会自动切换到相应的写主机</strong></h3><blockquote>
<p>普通方式登录</p>
</blockquote>
<p>可能直接进入读主机，存储数据时，会出现MOVED重定向操作。所以，应该以<code>集群方式登录(在src目录下)</code>。</p>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219485.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219485.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424211155545"></p>
<blockquote>
<p>进入src目录下,执行以下命令</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">cd <span class="token operator">/</span>home<span class="token operator">/</span>gy<span class="token operator">/</span>redis6<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">6.2</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">/</span>src<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">redis<span class="token operator">-</span>cli <span class="token operator">-</span>c <span class="token operator">-</span>p 端口号<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong><code>通过以上命令就可以进行集群连接,连接的话用任何结点/端口号都是可以的</code></strong></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219528.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219528.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424211825704"></p>
<h3 id="16-3-6-通过-cluster-nodes-命令查看集群信息"><a href="#16-3-6-通过-cluster-nodes-命令查看集群信息" class="headerlink" title="16.3.6  通过 cluster nodes 命令查看集群信息"></a><strong>16.3.6</strong>  <strong>通过 cluster nodes 命令查看集群信息</strong></h3><blockquote>
<p>前提是进到主机中</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219237.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219237.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424212721328"></p>
<h3 id="16-3-7-关闭redis集群"><a href="#16-3-7-关闭redis集群" class="headerlink" title="16.3.7 关闭redis集群"></a>16.3.7 关闭redis集群</h3><blockquote>
<p>集群关闭直接将各个节点的进程kill掉即可</p>
</blockquote>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">kill <span class="token operator">-</span><span class="token number">9</span> PID # PID是进程号<span class="token punctuation">,</span>查看进程时会显示<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219339.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219339.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425103546922" style="zoom:80%;" />

<h2 id="16-4-集群操作和数据恢复"><a href="#16-4-集群操作和数据恢复" class="headerlink" title="16.4 集群操作和数据恢复"></a>16.4 集群操作和数据恢复</h2><h3 id="16-4-1-redis-cluster-如何分配这六个节点"><a href="#16-4-1-redis-cluster-如何分配这六个节点" class="headerlink" title="16.4.1  redis cluster 如何分配这六个节点?"></a><strong>16.4.1</strong>  <strong>redis cluster</strong> <strong>如何分配这六个节点?</strong></h3><p>一个集群至少要有三个主节点。</p>
<p>选项 –cluster-replicas 1 表示我们希望为集群中的每个主节点创建一个从节点。</p>
<blockquote>
<p>分配原则尽量保证每个主数据库运行在不同的ip地址,每个从库和主库不在一个ip地址上</p>
</blockquote>
<p>其实是强调集群中的每个redis服务尽量不要在同一个服务器下,不是强调ip不同</p>
<h3 id="16-4-2-什么是slots"><a href="#16-4-2-什么是slots" class="headerlink" title="16.4.2  什么是slots"></a><strong>16.4.2</strong>  <strong>什么是</strong>slots</h3><blockquote>
<p>一个 Redis 集群包含 16384 个插槽（hash slot）， 数据库中的每个键都属于这 16384 个插槽的其中一个</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219258.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219258.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424214125586"></p>
<hr>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219758.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219758.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424213959741"></p>
<hr>
<hr>
<blockquote>
<p>集群使用公式 CRC16(key) % 16384 来计算键 key 属于哪个槽， 其中 CRC16(key) 语句用于计算键 key 的 CRC16 校验和 集群中的每个节点负责处理一部分插槽。</p>
</blockquote>
<p> 举个例子， 如果一个集群可以有主节点， 其中：</p>
<p>节点 A 负责处理 0 号至 5460 号插槽。</p>
<p>节点 B 负责处理 5461 号至 10922 号插槽。</p>
<p>节点 C 负责处理 10923 号至 16383 号插槽。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219457.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152219457.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424214813294"></p>
<hr>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220135.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220135.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220424214125586"></p>
<hr>
<h3 id="16-4-3-在集群中录入值"><a href="#16-4-3-在集群中录入值" class="headerlink" title="16.4.3   在集群中录入值"></a><strong>16.4.3</strong>   <strong>在集群中录入值</strong></h3><p>在redis-cli每次录入、查询键值，redis都会计算出该key应该送往的插槽，如果不是该客户端对应服务器的插槽，redis会报错，并告知应前往的redis实例地址和端口。</p>
<p>redis-cli客户端提供了 –c 参数实现自动重定向。</p>
<p>如 redis-cli -c –p 6379 登入后，再录入、查询键值对可以自动重定向。</p>
<blockquote>
<p>不在一个slot下的键值，是不能使用mget,mset等多键操作。</p>
</blockquote>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220020.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220020.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425103717133"></p>
<blockquote>
<p><code>可以通过&#123;&#125;来定义组的概念，从而使key中&#123;&#125;内相同内容的键值对放到一个slot中去</code>。</p>
</blockquote>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220831.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220831.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425103938083"></p>
<h3 id="16-4-4-查询集群中的值"><a href="#16-4-4-查询集群中的值" class="headerlink" title="16.4.4   查询集群中的值"></a><strong>16.4.4</strong>   <strong>查询集群中的值</strong></h3><blockquote>
<p>CLUSTER GETKEYSINSLOT <slot><count> </p>
</blockquote>
<p>返回 count 个 slot 槽中的键。</p>
<ol>
<li>计算key的插槽值<br><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220263.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220263.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425104924261"></li>
<li>计算插槽值里面有几个key或者有几个键<br><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220180.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220180.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425105247292"><br>449是插槽值</li>
<li>返回插槽中键的数量<br><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220713.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220713.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425105458220"></li>
</ol>
<h3 id="16-4-5-故障恢复"><a href="#16-4-5-故障恢复" class="headerlink" title="16.4.5   故障恢复"></a><strong>16.4.5</strong>   <strong>故障恢复</strong></h3><p>如果主节点下线？从节点能否自动升为主节点？注意：<strong>15</strong>秒超时</p>
<p>主节点恢复后，主从关系会如何？<code>主节点回来变成从机。</code></p>
<blockquote>
<p>①把主机挂掉</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220639.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220639.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425110035934"></p>
<blockquote>
<p>②再连上,然后查看</p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220909.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220909.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425110233817"><br>6379挂了,主机是6389</p>
<p><code>6379再启动起来,会成为6389的小弟</code></p>
<hr>
<hr>
<p>如果所有某一段插槽的主从节点都宕掉，redis服务是否还能继续?</p>
<blockquote>
<p><code>如果某一段插槽的主从都挂掉，而cluster-require-full-coverage 为yes ，那么 ，整个集群都挂掉</code></p>
</blockquote>
<blockquote>
<p>如果某一段插槽的主从都挂掉，而cluster-require-full-coverage 为no ,那么,该插槽数据全都不能使用，也无法存储。</p>
<p>只是该段,其他插槽依旧可以使用</p>
</blockquote>
<p>redis.conf中的参数 cluster-require-full-coverage</p>
<h2 id="16-5-集群的开发"><a href="#16-5-集群的开发" class="headerlink" title="16.5  集群的开发"></a>16.5  集群的开发</h2><blockquote>
<p><code>即使连接的不是主机，集群会自动切换主机存储。主机写，从机读。</code></p>
</blockquote>
<blockquote>
<p><code>无中心化主从集群。无论从哪台主机写的数据，其他主机上都能读到数据。</code></p>
</blockquote>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220788.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220788.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425111217722"></p>
<h2 id="16-6-Redis集群提供了以下好处"><a href="#16-6-Redis集群提供了以下好处" class="headerlink" title="16.6   Redis集群提供了以下好处"></a>16.6   Redis集群提供了以下好处</h2><blockquote>
<p>实现扩容</p>
</blockquote>
<blockquote>
<p>分摊压力</p>
</blockquote>
<blockquote>
<p>无中心配置相对简单</p>
</blockquote>
<h2 id="16-7Redis集群的不足"><a href="#16-7Redis集群的不足" class="headerlink" title="16.7Redis集群的不足"></a>16.7Redis集群的不足</h2><p>多键操作是不被支持的 </p>
<p>多键的Redis事务是不被支持的。lua脚本不被支持</p>
<p>由于集群方案出现较晚，很多公司已经采用了其他的集群方案，而代理或者客户端分片的方案想要迁移至redis cluster，需要整体迁移而不是逐步过渡，复杂度较大。</p>
<h1 id="17-Redis6应用问题解决"><a href="#17-Redis6应用问题解决" class="headerlink" title="17.Redis6应用问题解决"></a>17.Redis6应用问题解决</h1><h2 id="17-1-缓存穿透"><a href="#17-1-缓存穿透" class="headerlink" title="17.1 缓存穿透"></a>17.1 缓存穿透</h2><h3 id="17-1-1-问题描述"><a href="#17-1-1-问题描述" class="headerlink" title="17.1.1.  问题描述"></a><strong>17.1.1.</strong>  <strong>问题描述</strong></h3><p>key对应的数据在数据源并不存在，每次针对此key的请求从缓存获取不到，请求都会压到数据源，从而可能压垮数据源。比如用一个不存在的用户id获取用户信息，不论缓存还是数据库都没有，若黑客利用此漏洞进行攻击可能压垮数据库。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220130.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152220130.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425113602757"></p>
<h3 id="17-1-2-解决方案"><a href="#17-1-2-解决方案" class="headerlink" title="17.1.2.  解决方案"></a><strong>17.1.2.</strong>  <strong>解决方案</strong></h3><p><code>一个一定不存在缓存及查询不到的数据，由于缓存是不命中时被动写的，并且出于容错考虑，如果从存储层查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到存储层去查询，失去了缓存的意义。</code></p>
<p>解决方案：</p>
<p>（1）  <strong><code>对空值缓存</code>：</strong>如果一个查询返回的数据为空（不管是数据是否不存在），我们仍然把这个空结果（null）进行缓存，设置空结果的过期时间会很短，最长不超过五分钟</p>
<p>（2）  <strong><code>设置可访问的名单（白名单）</code>：</strong></p>
<p>使用<code>bitmaps类型</code>定义一个可以访问的名单，<code>名单id作为bitmaps的偏移量，每次访问和bitmap里面的id进行比较，如果访问id不在bitmaps里面，进行拦截，不允许访问</code>。</p>
<p>（3）  **<code>采用布隆过滤器</code>**：(布隆过滤器（Bloom Filter）是1970年由布隆提出的。它实际上是一个很长的二进制向量(位图)和一系列随机映射函数（哈希函数）。</p>
<p>布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都远远超过一般的算法，缺点是有一定的误识别率和删除困难。)</p>
<p>将所有可能存在的数据哈希到一个足够大的bitmaps中，一个一定不存在的数据会被 这个bitmaps拦截掉，从而避免了对底层存储系统的查询压力。</p>
<p><strong>（4）</strong>  <strong><code>进行实时监控</code>：</strong>当发现Redis的命中率开始急速降低，需要排查访问对象和访问的数据，和运维人员配合，可以设置黑名单限制服务</p>
<hr>
<hr>
<p>一般是黑客搞得==&gt;报警,交给网警</p>
<h2 id="17-2-缓存击穿"><a href="#17-2-缓存击穿" class="headerlink" title="17.2  缓存击穿"></a>17.2  缓存击穿</h2><h3 id="17-2-1-问题描述"><a href="#17-2-1-问题描述" class="headerlink" title="17.2.1.  问题描述"></a><strong>17.2.1.</strong>  <strong>问题描述</strong></h3><p>key对应的数据存在，但在redis中过期，此时若有大量并发请求过来，这些请求发现缓存过期一般都会从后端DB加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把后端DB压垮。</p>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221960.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221960.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425114629264"></p>
<h3 id="17-2-2-解决方案"><a href="#17-2-2-解决方案" class="headerlink" title="17.2.2.  解决方案"></a><strong>17.2.2.</strong>  <strong>解决方案</strong></h3><p>key可能会在某些时间点被超高并发地访问，是一种非常“热点”的数据。这个时候，需要考虑一个问题：缓存被“击穿”的问题。</p>
<p>解决问题：</p>
<p><strong>（1</strong>）**<code>预先设置热门数据</code>**：在redis高峰访问之前，把一些热门数据提前存入到redis里面，加大这些热门数据key的时长</p>
<p><strong>（2</strong>）**<code>实时调整</code>**：现场监控哪些数据热门，实时调整key的过期时长</p>
<p><strong>（3</strong>）**<code>使用锁</code>**：</p>
<p>（1）  就是在缓存失效的时候（判断拿出来的值为空），不是立即去load db。</p>
<p>（2）  先使用缓存工具的某些带成功操作返回值的操作（比如Redis的SETNX）去set一个mutex key</p>
<p>（3）  当操作返回成功时，再进行load db的操作，并回设缓存,最后删除mutex key；</p>
<p>（4）  当操作返回失败，证明有线程在load db，当前线程睡眠一段时间再重试整个get缓存的方法。</p>
<h2 id="17-3-缓存雪崩"><a href="#17-3-缓存雪崩" class="headerlink" title="17.3 缓存雪崩"></a>17.3 缓存雪崩</h2><h3 id="17-3-1-问题描述"><a href="#17-3-1-问题描述" class="headerlink" title="17.3.1.  问题描述"></a><strong>17.3.1.</strong>  <strong>问题描述</strong></h3><p>key对应的数据存在，但在redis中过期，此时若有大量并发请求过来，这些请求发现缓存过期一般都会从后端DB加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把后端DB压垮。</p>
<blockquote>
<p>缓存雪崩与缓存击穿的区别在于这里针对很多key缓存，前者则是某一个key</p>
</blockquote>
<p>正常访问</p>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221537.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221537.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425115527012"></p>
<p>缓存失效瞬间</p>
<p> <img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221329.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221329.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425115507543"></p>
<hr>
<h3 id="17-3-2-解决方案"><a href="#17-3-2-解决方案" class="headerlink" title="17.3.2.  解决方案"></a><strong>17.3.2.</strong>  <strong>解决方案</strong></h3><p>缓存失效时的雪崩效应对底层系统的冲击非常可怕！</p>
<p>解决方案：</p>
<p><strong>（1）</strong>  <strong>构建多级缓存架构：</strong>nginx缓存 + redis缓存 +其他缓存（ehcache等）</p>
<p><strong>（2）</strong>  <strong>使用锁或队列：</strong></p>
<p>用加锁或者队列的方式保证来保证不会有大量的线程对数据库一次性进行读写，从而避免失效时大量的并发请求落到底层存储系统上。不适用高并发情况</p>
<p><strong>（3）</strong>  <strong>设置过期标志更新缓存：</strong></p>
<p>记录缓存数据是否过期（设置提前量），如果过期会触发通知另外的线程在后台去更新实际key的缓存。</p>
<p><strong>（4）</strong>  <strong>将缓存失效时间分散开：</strong></p>
<p>比如我们可以在原有的失效时间基础上增加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件。</p>
<h2 id="17-4-分布式锁"><a href="#17-4-分布式锁" class="headerlink" title="17.4 分布式锁"></a>17.4 分布式锁</h2><h3 id="17-4-1-问题描述"><a href="#17-4-1-问题描述" class="headerlink" title="17.4.1.  问题描述"></a><strong>17.4.1.</strong>  <strong>问题描述</strong></h3><p>随着业务发展的需要，<code>原单体单机部署的系统被演化成分布式集群系统</code>后，由于<code>分布式系统多线程、多进程并且分布在不同机器上</code>，这将<code>使原单机部署情况下的并发控制锁策略失效</code>，单纯的Java API并不能提供分布式锁的能力。为了解决这个问题就**<code>需要一种跨JVM的互斥机制来控制共享资源的访问，这就是分布式锁要解决的问题！</code>**</p>
<blockquote>
<p>分布式锁主流的实现方案：</p>
</blockquote>
<ol>
<li><p>基于数据库实现分布式锁</p>
</li>
<li><p>基于缓存（Redis等）</p>
</li>
<li><p>基于Zookeeper</p>
</li>
</ol>
<blockquote>
<p>每一种分布式锁解决方案都有各自的优缺点：</p>
</blockquote>
<ol>
<li><p>性能：redis最高</p>
</li>
<li><p>可靠性：zookeeper最高</p>
</li>
</ol>
<p>这里，我们就基于redis实现分布式锁。</p>
<h3 id="17-4-2-分布式锁-设置锁和过期时间"><a href="#17-4-2-分布式锁-设置锁和过期时间" class="headerlink" title="17.4.2.  分布式锁:设置锁和过期时间"></a><strong>17.4.2.</strong>  <strong>分布式锁:设置锁和过期时间</strong></h3><blockquote>
<p><strong><code>setnx</code></strong></p>
</blockquote>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221004.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221004.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425133545720"></p>
<hr>
<p><code>setnx相当于加了一把锁,只有当上一个释放了,下一个才能继续</code></p>
<blockquote>
<p>怎么释放?</p>
</blockquote>
<p>==&gt;<code>删掉</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221509.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221509.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425133829361"></p>
<blockquote>
<p><strong><code>设置key过期时间,自动释放</code></strong></p>
</blockquote>
<p>缺点:</p>
<p>如果上一个一直不释放,那下一个就进不去了</p>
<p>==&gt;设置过期时间</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221957.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221957.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425134210049" style="zoom:80%;" />

<blockquote>
<p>上锁同时设置过期时间</p>
</blockquote>
<p>为了防止上锁之后,设置过期时间之前断电了或者说服务器挂了等等导致设置过期时间没有成功</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221316.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152221316.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425134837085"></p>
<p>NX ：只在键不存在时，才对键进行设置操作。 SET key value NX 效果等同于 SETNX key value 。</p>
<p>EX second ：设置键的过期时间为 second 秒。 SET key value EX second 效果等同于 SETEX key second value 。</p>
<p>PX millisecond ：设置键的过期时间为 millisecond 毫秒。 SET key value PX millisecond 效果等同于 PSETEX key millisecond value 。</p>
<p>XX ：只在键已经存在时，才对键进行设置操作。</p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222079.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222079.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425140106998"></p>
<ol>
<li><p>多个客户端同时获取锁（setnx）</p>
</li>
<li><p>获取成功，执行业务逻辑{从db获取数据，放入缓存}，执行完成释放锁（del）</p>
</li>
<li><p>其他客户端等待重试</p>
</li>
</ol>
<h3 id="17-4-3-编写代码-UUID防止误删"><a href="#17-4-3-编写代码-UUID防止误删" class="headerlink" title="17.4.3  编写代码:UUID防止误删"></a>17.4.3  <strong>编写代码</strong>:UUID防止误删</h3><h4 id="17-4-3-1-java代码-增加过期时间"><a href="#17-4-3-1-java代码-增加过期时间" class="headerlink" title="17.4.3.1 java代码:增加过期时间"></a>17.4.3.1 java代码:增加过期时间</h4><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222156.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222156.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425143341807"></p>
<p><code>设置key三秒以后过期</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/redisTest"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisTestController</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"testLock"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//1获取锁，setne</span>
        <span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">"lock"</span><span class="token punctuation">,</span> <span class="token string">"111"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2获取锁成功、查询num的值</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">Object</span> value <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.1判断num为空return</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">//2.2有值就转成成int</span>
            <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>value<span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.3把redis的num加1</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">,</span> <span class="token operator">++</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.4释放锁，del</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"lock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token comment">//3获取锁失败、每隔0.1秒再获取</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">testLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>接下来把代码做个测试,这个测试直接访问就可以了</p>
<h4 id="17-4-3-2-但是为了更加明显-还是使用一下ab测试的方式来测试一下代码"><a href="#17-4-3-2-但是为了更加明显-还是使用一下ab测试的方式来测试一下代码" class="headerlink" title="17.4.3.2 但是为了更加明显,还是使用一下ab测试的方式来测试一下代码"></a>17.4.3.2 但是为了更加明显,还是使用一下ab测试的方式来测试一下代码</h4><p><strong><code>ab工具简介</code></strong></p>
<p>ab全称为：apache bench</p>
<ul>
<li>在官网上的解释如下：</li>
</ul>
<p><code>ab是Apache超文本传输协议(HTTP)的性能测试工具。其设计意图是描绘当前所安装的Apache的执行性能，主要是显示你安装的Apache每秒可以处理多少个请求。</code></p>
<ul>
<li>其他网站解释：</li>
</ul>
<p><code>ab是apache自带的压力测试工具。ab非常实用，它不仅可以对apache服务器进行网站访问压力测试，也可以对或其它类型的服务器进行压力测试。比如nginx、tomcat、IIS等。</code></p>
<p><strong>ab命令</strong></p>
<p><code>ab -n 1000 -c 100 http链接地址</code></p>
<p><code>其中-n表示请求数，-c表示并发数</code></p>
<p>eg:    上面java代码的ab命令    </p>
<p>​        ab -n 1000 -c 100 <a target="_blank" rel="noopener" href="http://192.168.88.3:8080/redisTest/testLock">http://192.168.88.3:8080/redisTest/testLock</a></p>
<hr>
<hr>
<p><strong>①<code>设置num为0:  set num 0;通过代码每次加1</code></strong></p>
<p><code>上述代码是针对num的,先去看看num</code></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222960.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222960.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425140929866"></p>
<p><strong>②<code>ab测试</code></strong></p>
<pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">ab <span class="token operator">-</span>n <span class="token number">1000</span> <span class="token operator">-</span>c <span class="token number">100</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">88.3</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>redisTest<span class="token operator">/</span>testLock<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222679.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222679.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425142112282"></p>
<hr>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222995.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222995.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425143026955" style="zoom:50%;" />

<hr>
<hr>
<p><strong>③<code>再去get一下num</code></strong></p>
<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222512.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222512.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425143135918"></p>
<p><code>因为上面ab命令是1000次请求,每次请求执行的是加一,所以结束后num应该是1000</code></p>
<h4 id="17-4-3-3-存在问题"><a href="#17-4-3-3-存在问题" class="headerlink" title="17.4.3.3 存在问题"></a>17.4.3.3 存在问题</h4><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222978.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222978.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425144024804" style="zoom:67%;" />

<hr>
<hr>
<p>问题:a释放了b的锁</p>
<p><strong><code>解决方案:使用uuid防止误删</code></strong></p>
<h4 id="17-4-3-4-java代码-使用uuid防止误删"><a href="#17-4-3-4-java代码-使用uuid防止误删" class="headerlink" title="17.4.3.4 java代码:使用uuid防止误删"></a>17.4.3.4 java代码:使用uuid防止误删</h4><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222173.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222173.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425144408033" style="zoom:50%;" />

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/redisTest"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisTestController</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"testLock"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> uuid<span class="token operator">=</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1获取锁，setne</span>
        <span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">"lock"</span><span class="token punctuation">,</span> uuid<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2获取锁成功、查询num的值</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">Object</span> value <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.1判断num为空return</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">//2.2有值就转成成int</span>
            <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>value<span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.3把redis的num加1</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">,</span> <span class="token operator">++</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.4释放锁，del</span>
            <span class="token comment">//判断比较uuid值是否一样</span>
            <span class="token class-name">String</span> lockUuid<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"lock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>lockUuid<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>uuid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"lock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token comment">//3获取锁失败、每隔0.1秒再获取</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">testLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222825.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222825.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425145224969"></p>
<h3 id="17-4-6-LUA脚本保证删除的原子性"><a href="#17-4-6-LUA脚本保证删除的原子性" class="headerlink" title="17.4.6.  LUA脚本保证删除的原子性"></a><strong>17.4.6.</strong>  LUA脚本保证删除的原子性</h3><p> 问题:删除操作缺乏原子性</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222324.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222324.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425145720104" style="zoom:50%;" />

<hr>
<hr>
<p>===&gt;使用lua脚本</p>
<img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222143.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152222143.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425150404078" style="zoom:80%;" />

<p>Lua 是一个小巧的脚本语言，Lua脚本可以很容易的被C/C++ 代码调用，也可以反过来调用C/C++的函数，Lua并没有提供强大的库，一个完整的Lua解释器不过200k，所以Lua不适合作为开发独立应用程序的语言，而是作为嵌入式脚本语言。</p>
<p>很多应用程序、游戏使用LUA作为自己的嵌入式脚本语言，以此来实现可配置性、可扩展性。</p>
<p>这其中包括魔兽争霸地图、魔兽世界、博德之门、愤怒的小鸟等众多游戏插件或外挂。</p>
<p><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/lua/">https://www.w3cschool.cn/lua/</a></p>
<h4 id="17-4-6-1-lua在redis中的优势"><a href="#17-4-6-1-lua在redis中的优势" class="headerlink" title="17.4.6.1  lua在redis中的优势"></a>17.4.6.1  lua在redis中的优势</h4><p>将复杂的或者多步的redis操作，写为一个脚本，一次提交给redis执行，减少反复连接redis的次数。提升性能。</p>
<blockquote>
<p>LUA脚本是类似redis事务，有一定的原子性，不会被其他命令插队，可以完成一些redis事务性的操作。</p>
</blockquote>
<p>但是注意redis的lua脚本功能，只有<code>在Redis 2.6以上的版本才可以使用</code>。</p>
<blockquote>
<p>redis 2.6版本以后，通过lua脚本解决<strong>争抢问题</strong>，实际上是<strong>redis</strong> <strong>利用其单线程的特性，用任务队列的方式解决多任务并发问题</strong>。:star::star:</p>
</blockquote>
<h4 id="17-4-6-2-代码"><a href="#17-4-6-2-代码" class="headerlink" title="17.4.6.2 代码"></a>17.4.6.2 代码</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/redisTest"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisTestController</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"testLockLua"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testLockLua</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//1 声明一个uuid ,将做为一个value 放入我们的key所对应的值中</span>
        <span class="token class-name">String</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2 定义一个锁：lua 脚本可以使用同一把锁，来实现删除！</span>
        <span class="token class-name">String</span> skuId <span class="token operator">=</span> <span class="token string">"25"</span><span class="token punctuation">;</span> <span class="token comment">// 访问skuId 为25号的商品 100008348542</span>
        <span class="token class-name">String</span> locKey <span class="token operator">=</span> <span class="token string">"lock:"</span> <span class="token operator">+</span> skuId<span class="token punctuation">;</span> <span class="token comment">// 锁住的是每个商品的数据</span>

        <span class="token comment">// 3 获取锁</span>
        <span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>locKey<span class="token punctuation">,</span> uuid<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 第一种： lock 与过期时间中间不写任何的代码。</span>
        <span class="token comment">// redisTemplate.expire("lock",10, TimeUnit.SECONDS);//设置过期时间</span>
        <span class="token comment">// 如果true</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 执行的业务逻辑开始</span>
            <span class="token comment">// 获取缓存中的num 数据</span>
            <span class="token class-name">Object</span> value <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 如果是空直接返回</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">// 不是空 如果说在这出现了异常！ 那么delete 就删除失败！ 也就是说锁永远存在！</span>
            <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 使num 每次+1 放入缓存</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token operator">++</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/*使用lua脚本来锁*/</span>
            <span class="token comment">// 定义lua 脚本</span>
            <span class="token class-name">String</span> script <span class="token operator">=</span> <span class="token string">"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end"</span><span class="token punctuation">;</span>
            <span class="token comment">// 使用redis执行lua执行</span>
            <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> redisScript <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            redisScript<span class="token punctuation">.</span><span class="token function">setScriptText</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置一下返回值类型 为Long</span>
            <span class="token comment">// 因为删除判断的时候，返回的0,给其封装为数据类型。如果不封装那么默认返回String 类型，</span>
            <span class="token comment">// 那么返回字符串与0 会有发生错误。</span>
            redisScript<span class="token punctuation">.</span><span class="token function">setResultType</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 第一个要是script 脚本 ，第二个需要判断的key，第三个就是key所对应的值。</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>redisScript<span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>locKey<span class="token punctuation">)</span><span class="token punctuation">,</span> uuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 其他线程等待</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 睡眠</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 睡醒了之后，调用方法。</span>
                <span class="token function">testLockLua</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="17-4-7-总结"><a href="#17-4-7-总结" class="headerlink" title="17.4.7.  总结"></a><strong>17.4.7.</strong>  <strong>总结</strong></h3><p>1、加锁</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 1. 从redis中获取锁,set k1 v1 px 20000 nx</span>
<span class="token class-name">String</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Boolean</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">"lock"</span><span class="token punctuation">,</span> uuid<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、使用lua释放锁</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 2. 释放锁 del</span>
<span class="token class-name">String</span> script <span class="token operator">=</span> <span class="token string">"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end"</span><span class="token punctuation">;</span>
<span class="token comment">// 设置lua脚本返回的数据类型</span>
<span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> redisScript <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置lua脚本返回类型为Long</span>
redisScript<span class="token punctuation">.</span><span class="token function">setResultType</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
redisScript<span class="token punctuation">.</span><span class="token function">setScriptText</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>redisScript<span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"lock"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>uuid<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、重试</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">testLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>为了确保分布式锁可用，我们至少要确保锁的实现同时<strong>满足以下四个条件</strong>：</p>
<ul>
<li>互斥性。在任意时刻，只有一个客户端能持有锁。</li>
<li>不会发生死锁。即使有一个客户端在持有锁的期间崩溃而没有主动解锁，也能保证后续其他客户端能加锁。</li>
<li> 解铃还须系铃人。加锁和解锁必须是同一个客户端，客户端自己不能把别人加的锁给解了。</li>
<li>加锁和解锁必须具有原子性。</li>
</ul>
<h1 id="18-Redis6新功能"><a href="#18-Redis6新功能" class="headerlink" title="18.Redis6新功能"></a>18.Redis6新功能</h1><h2 id="18-1-ACL"><a href="#18-1-ACL" class="headerlink" title="18.1 ACL"></a>18.1 ACL</h2><h2 id="18-2-IO多线程"><a href="#18-2-IO多线程" class="headerlink" title="18.2 IO多线程"></a>18.2 IO多线程</h2><h1 id="19-redis-gui客户端"><a href="#19-redis-gui客户端" class="headerlink" title="19.redis gui客户端"></a>19.redis gui客户端</h1><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223426.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223426.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425161509999"></p>
<hr>
<hr>
<p><strong>Redis Desktop Manager是一款简单快速、跨平台的Redis桌面管理工具，也被称作Redis可视化工具；支持命令控制台操作，以及常用，查询key，rename，delete等操作。</strong></p>
<h2 id="①安装"><a href="#①安装" class="headerlink" title="①安装"></a>①安装</h2><p><strong><code>傻瓜式安装</code></strong></p>
<h2 id="②使用"><a href="#②使用" class="headerlink" title="②使用"></a>②使用</h2><h3 id="1-进入RedisDesktopManager的主界面"><a href="#1-进入RedisDesktopManager的主界面" class="headerlink" title="1.进入RedisDesktopManager的主界面"></a>1.进入RedisDesktopManager的主界面</h3><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223113.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223113.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425161943512" style="zoom:50%;" />

<h3 id="2-1-新建连接（Name：给该连接起一个名字，Host：redis服务器的ip地址，Port-redis服务器的端口号，Auth-密码字段，如果redis服务器设置了密码验证，则需要填写，没有设置，为空即可，填写完再点击”Test-Connection”进行测试，没有问题再点击OK完成连接）"><a href="#2-1-新建连接（Name：给该连接起一个名字，Host：redis服务器的ip地址，Port-redis服务器的端口号，Auth-密码字段，如果redis服务器设置了密码验证，则需要填写，没有设置，为空即可，填写完再点击”Test-Connection”进行测试，没有问题再点击OK完成连接）" class="headerlink" title="2.1.新建连接（Name：给该连接起一个名字，Host：redis服务器的ip地址，Port:redis服务器的端口号，Auth:密码字段，如果redis服务器设置了密码验证，则需要填写，没有设置，为空即可，填写完再点击”Test Connection”进行测试，没有问题再点击OK完成连接）"></a>2.1.新建连接（Name：给该连接起一个名字，Host：redis服务器的ip地址，Port:redis服务器的端口号，Auth:密码字段，如果redis服务器设置了密码验证，则需要填写，没有设置，为空即可，填写完再点击”Test Connection”进行测试，没有问题再点击OK完成连接）</h3><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223561.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223561.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425162102872" style="zoom:50%;" />

<h3 id="3-如果正常连接到Redis服务器，则会提示如下图。"><a href="#3-如果正常连接到Redis服务器，则会提示如下图。" class="headerlink" title="3.如果正常连接到Redis服务器，则会提示如下图。"></a>3.<strong>如果正常连接到Redis服务器，则会提示如下图。</strong></h3><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223232.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223232.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425162203581" style="zoom:80%;" />

<h3 id="4-该工具支持根据筛选条件查询add-new-key，key，reload等"><a href="#4-该工具支持根据筛选条件查询add-new-key，key，reload等" class="headerlink" title="4.该工具支持根据筛选条件查询add new key，key，reload等"></a>4.<strong>该工具支持根据筛选条件查询add new key，key，reload等</strong></h3><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223351.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223351.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425162248237" style="zoom:80%;" />

<h3 id="5-支持常用redis操作；如针对目标key执行rename，delete，addrow，reload-value操作。"><a href="#5-支持常用redis操作；如针对目标key执行rename，delete，addrow，reload-value操作。" class="headerlink" title="5.支持常用redis操作；如针对目标key执行rename，delete，addrow，reload value操作。"></a>5.支持常用redis操作；如针对目标key执行rename，delete，addrow，reload value操作。</h3><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223845.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223845.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425162339929"></p>
<h3 id="6支持命令控制台操作"><a href="#6支持命令控制台操作" class="headerlink" title="6支持命令控制台操作"></a>6支持命令控制台操作</h3><h4 id="6-1redis最常用的几个命令，如增删改查"><a href="#6-1redis最常用的几个命令，如增删改查" class="headerlink" title="6.1redis最常用的几个命令，如增删改查"></a>6.1<strong>redis最常用的几个命令，如增删改查</strong></h4><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223677.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223677.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425162456124"></p>
<h4 id="6-2-查看key的类型和数据库中key的数量以及服务器的信息"><a href="#6-2-查看key的类型和数据库中key的数量以及服务器的信息" class="headerlink" title="6.2 查看key的类型和数据库中key的数量以及服务器的信息"></a>6.2 查看key的类型和数据库中key的数量以及服务器的信息</h4><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223255.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223255.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425162611932"></p>
<h4 id="6-3-查看日志信息"><a href="#6-3-查看日志信息" class="headerlink" title="6.3 查看日志信息"></a>6.3 查看日志信息</h4><p><img src="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223685.png" class="lazyload placeholder" data-srcset="https://gy-blog.oss-cn-beijing.aliyuncs.com/pic/202210152223685.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220425162636700"></p>

      </div>
      <div class="post-tags-categories">
        
        <div class="tags">
          
            <a href="/tags/redis/" class="">
              redis
            </a>
          
            <a href="/tags/NoSQL/" class="">
              NoSQL
            </a>
          
        </div>
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>作者:  </strong>高小天</a>
    </li>
    <li class="post-copyright-link">
    <strong>文章链接:  </strong>
    <a href="/2019/08/27/redis6/" target="_blank" title="Redis">https://gaoyang.world/2019/08/27/redis6/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明:   </strong>
      本网站所有文章除特别声明外,均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      许可协议。转载请注明出处!
    </li>
  </ul>
<div>
      
    </article>
    <!-- 上一篇文章和下一篇文章 -->
    
      <!-- 文章详情页的上一页和下一页 -->
<div class="post-nav">



  
  <div class="post-nav-prev post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="/medias/12.jpg" class="lazyload placeholder" data-srcset="/medias/12.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="">
    </div>
    <a href="/2019/08/27/IO%E6%B5%81/" class="post-nav-link">
      <div class="title">
        <i class="fas fa-angle-left"></i> 上一篇:
        <div class="title-text">IO流</div>
      </div>
      
      <!-- <div class="content">
        IO流
即使再小的帆也能远航~

一.目录File类IO流概念缓冲流转换流对象流打印流内存流,数据流读写流压缩流NIO二
      </div> -->
    </a>
  </div>



  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="/medias/4.jpg" class="lazyload placeholder" data-srcset="/medias/4.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" src="" alt="">
    </div>
    <a href="/2019/01/20/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/" class="post-nav-link">
      <div class="title">
        下一篇: <i class="fas fa-angle-right"></i>
        <div class="title-text">微服务架构</div>
      </div>
      <!-- <div class="content">
        一文详解微服务架构本文将介绍微服务架构和相关的组件，介绍他们是什么以及为什么要使用微服务架构和这些组件。本文侧重于简明地
      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- 打赏 -->
    
      <div id="appDonate" class="post-donate">
  <div id="donate_board" class="donate_bar center" ref="donate">
    <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏" @click="showDialogDrawer()"></a>
  </div>
  <transition name="fade">
    <div 
      class="donate-box-mask"
      v-cloak 
      v-show="visible"
      @click="cancelDialogDrawer()"
    >
    </div>
  </transition>
  <transition name="bounce">
    <div class="donate-box" v-cloak v-show="visible">
      <div class="donate-box_close">
        <i class="fas fa-times" aria-hidden="true" @click="cancelDialogDrawer" pointer></i>
      </div>
      <div class="donate-box_title">
        <h4>
          你的赏识是我前进的动力
        </h4>
      </div>
      <div class="donate-box_tab">
        <div class="Alipay" pointer :class="{'active': tabActive === 'Alipay'}" @click="changeTabActive('Alipay')">
          支付宝
        </div>
        <div class="WeChatpay" pointer :class="{'active': tabActive === 'WeChatpay'}" @click="changeTabActive('WeChatpay')">
          微信
        </div>
      </div>
      <div class="donate-box_img">
        <div class="AlipayImg" v-show="tabActive === 'Alipay'">
          <img src="/medias/zfb.jpg" class="lazyload placeholder" data-srcset="/medias/zfb.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="支付宝打赏" />
        </div> 
        <div class="WeChatpayImg" v-show="tabActive === 'WeChatpay'">
          <img src="/medias/wx.jpg" class="lazyload placeholder" data-srcset="/medias/wx.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="微信打赏" />
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDonate',
    data: {
      visible: false,
      tabActive: 'Alipay',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        // function getScroll() {
        //   return {
        //     left: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0,
        //     top: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0
        //   };
        // }
        this.top = $(document).scrollTop() // or getScroll().top
        // console.log('aa', $('.main-content'));
        body.style.cssText = 'overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
      changeTabActive(name) {
        this.tabActive = name;
      }
    },
    created() {}
  })
</script>
    

    <!-- 分享 -->
    
      <!-- https://github.com/overtrue/share.js -->
<!-- 文章详情页的分享 -->
<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>

<script src="/js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- 评论 -->
    <!-- 评论 -->

  <div id="myComment">
    
      <div id="gitment-container"></div>

    
  </div>

<!-- comment script in themes\hexo-theme-bamboo\layout\_partial\scripts\index.ejs -->


  </div>

  <!-- 目录 -->
  <!-- 文章详情页右侧目录 -->


<script>
  function closeToc(init) {
    $(".toc-aside").css({'width': 0, 'padding': 0, 'transition': init ?  'noe' : 'width 0.3s' });
    $(".toc-content").css({'width': 0});
    $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
    $(".main-content").css({'width': '75%', 'margin': '10px auto'});
  };
  function openToc() {
    $(".main-content").css({'width': '65%', 'margin-right': '10px', 'margin-left': 'calc(35% - 350px)'});
    $(".toc-aside").css({'width': '300px', 'padding': '0 10px', 'transition': 'width 0.3s'});
    $(".toc-content").css({'width': '300px'});
    $(".toc-aside-title span, .toc-aside-title i").css({'display': 'inline-block'});
  }
  function openBtnClickFn () {
    let openOrCloseBtn = $('.toc-aside .toc-aside-title .toc-open-close');
    let open = eval('false' || 'true');
    openOrCloseBtn.click(function() {
      if (open) {
        closeToc();
        open = false;
      } else {
        openToc();
        open = true;
      }
    });
  };
  openBtnClickFn();
  initCloseTocWidth(true);

  function initCloseTocWidth(init) {
    if (window.innerWidth >= 992) {
      let isClose = true;
      isClose && closeToc(init)
    }
  }

  document.addEventListener('pjax:complete', function () {
    $(".toc-aside").css({'transition': 'no'});
  })
  document.addEventListener('pjax:complete', function () {
    openBtnClickFn();
  })
  
</script>

  <!-- 图片放大 Wrap images with fancybox support -->
  <script src="/js/wrapImage.js"></script>
</div>

<!-- 文章详情页背景图 -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;"
	:style="{'background-color': bgColor ? bgColor : 'transparent'}">
	<transition-group tag="ul" :name="names">
		<li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
			<img :src="image" class="bg-swiper-img no-lazy">
		</li>
	</transition-group>
</div>
<script>
	var vm = new Vue({
		el: '#appBgSwiper',
		data: {
			names: '' || 'fade' || 'fade', // translate-fade fade
			mark: 0,
			img: [],
			bgColor: '',
			time: null
		},
		methods: {   //添加方法
			change(i, m) {
				if (i > m) {
					// this.names = 'fade';
				} else if (i < m) {
					// this.names = 'fade';
				} else {
					return;
				}
				this.mark = i;
			},
			prev() {
				// this.names = 'fade';
				this.mark--;
				if (this.mark === -1) {
					this.mark = 3;
					return
				}
			},
			next() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			autoPlay() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			play() {
				let bgImgDelay = '' || '180000'
				let delay = parseInt(bgImgDelay) || 180000;
				this.time = setInterval(this.autoPlay, delay);
			},
			enter() {
				clearInterval(this.time);
			},
			leave() {
				this.play();
			}
		},
		created() {
			this.play()
		},
		beforeDestroy() {
			clearInterval(this.time);
		},
		mounted() {
			let prop = '' || '';
			let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://')
			if (isImg) {
				let img = prop.split(',');
				let configRoot = '/'
				let arrImg = [];
				img.forEach(el => {
					var Expression = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
					var objExp = new RegExp(Expression);

					if (objExp.test(el)) {
						// http or https
						arrImg.push(el);
					} else {
						// 非http or https开头
						// 本地文件
						let firstStr = el.charAt(0);
						if (firstStr == '/') {
							el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
						}
						el = configRoot + el;
						arrImg.push(el);
					}
				})
				this.img = arrImg;
			} else {
				this.bgColor = prop;
			}
		}
	})
</script>

<style>
	.bg-swiper-box {
		position: absolute;
		display: block;
		width: 100%;
		height: 100%;
	}

	.bg-swiper-img {
		object-fit: cover;
		width: 100%;
		height: 100%;
	}
</style>




  <script>
  function loadMermaid() {
    if (document.getElementsByClassName('mermaid').length) {
      if (window.mermaidJsLoad) mermaid.init()
      else {
        loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
          window.mermaidJsLoad = true
          mermaid.initialize({
            theme: 'default',
          })
          if ('true') {
            mermaid.init();
          }
        })
      }
    }
  };
  document.addEventListener("DOMContentLoaded", function () {
    loadMermaid();
  })

  document.addEventListener('pjax:complete', function () {
    loadMermaid();
  })
  
</script>


      </main>
    </div>

    <!-- 页脚 -->
    
  
  <div class="footer bg-color">
    <div class="footer-main">
      
        
          <div class="link">
            
          </div>
        
      
        
          <div class="footer-copyright">
            <p>Copyright © 2019 - 2020  </p>

          </div>
        
      
        
          
            <!-- 不蒜子统计 -->
            <!-- 不蒜子统计 -->
<span id="busuanzi_container_site_pv">
      <i class="fas fa-eye" aria-hidden="true"></i>本站总访问量：<span id="busuanzi_value_site_pv"></span> 次
</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv" style='display:none'>
      <i class="fas fa-users" aria-hidden="true"></i>本站访客数：<span id="busuanzi_value_site_uv"></span> 人
</span>

          
        
      
        
          <div class="footer-custom">
            
          </div>
        
      
    </div>
  </div>



    <!-- 渲染暗黑按钮 -->
    
      <div class="dark">
  <div class="dark-content">
    <i class="fas fa-moon" aria-hidden="true"></i>
    <!-- <span>关灯</span> -->
  </div>
  
</div>

<script>
  $(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-moon" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })
</script>
    
    <!-- 渲染回到顶部按钮 -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fas fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="/js/goTop.js"></script>

    
    <!-- 渲染左下角音乐播放器 -->
    
      <link rel="stylesheet" href="/js/aplayer/APlayer@1.10.1.min.css">
<style>
.aplayer .aplayer-lrc p {
  
  font-size: 12px;
  font-weight: 700;
  line-height: 16px !important;
}

.aplayer .aplayer-lrc p.aplayer-lrc-current {
  
  font-size: 15px;
  color: #42b983;
}


.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
  left: -66px !important;
}

.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
  left: 0px !important;
}


</style>
<meting-js  
  class=""
  server="tencent"
  type="playlist"
  id="8062553743"
  fixed='true'
  autoplay='false'
  theme='#42b983'
  loop='all'
  order='random'
  preload='auto'
  volume='0.7'
  list-folded='true'
>
</meting-js>

<!-- <style>
  #aplayer {
    position: fixed;
    left: 0;
    bottom: 300px;
  }
</style> -->
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    

    <!-- 图片放大 -->
    
      <script src="/js/fancybox/jquery.fancybox.min.js"></script>
    

    <!-- 百度解析 -->
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <!-- 背景彩带 -->
    
      <script type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="/js/ribbon.min.js"></script>
    

    <script src="/js/utils/index.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- 文章目录所需js -->
<link href="/js/tocbot/tocbot.css" rel="stylesheet">
<script src="/js/tocbot/tocbot.min.js"></script>

<script>
  var headerEl = 'h2, h3, h4',  //headers 
    content = '.post-detail',//文章容器
    idArr = {};  //标题数组以确定是否增加索引id
  //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -80,
    headingsOffset: -($(window).height() * 0.4 - 45),
    positionFixedSelector: '.toc-main',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    activeLinkClass: 'is-active-link',
    // onClick: function (e) {},
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      tocbot.init(option);
      mobileTocClick();
    });

  }

  window.tocScrollFn = function () {
    return bamboo.throttle(function () {
      findHeadPosition();
    }, 100)()
  }
  window.addEventListener('scroll', tocScrollFn);

  const findHeadPosition = function (top) {
    if ($('.toc-list').length <= 0) {
      return false;
    }
    setTimeout(() => {  // or DOMContentLoaded 
      autoScrollToc();
    }, 0);
  }

  const autoScrollToc = function () {
    const $activeItem = document.querySelector('.is-active-link');
    const $cardToc = document.querySelector('.toc-content');
    const activePosition = $activeItem.getBoundingClientRect().top
    const sidebarScrollTop = $cardToc.scrollTop
    if (activePosition > (document.documentElement.clientHeight - 100)) {
      $cardToc.scrollTop = sidebarScrollTop + 150
    }
    if (activePosition < 100) {
      $cardToc.scrollTop = sidebarScrollTop - 150
    }
  }

  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
      mobileTocClick();
    }
  });
  
  // 手机端toc按钮点击出现目录
  const mobileTocClick = function () {
    const $cardTocLayout = document.getElementsByClassName('toc-aside')[0];
    const $cardToc = $cardTocLayout.getElementsByClassName('toc-content')[0];
    let right = '45px';
    if (window.innerWidth >= 551 && window.innerWidth <= 992) {
      right = '100px'
    }
    const mobileToc = {
      open: () => {
        $cardTocLayout.style.cssText = 'animation: toc-open .3s; opacity: 1; right: ' + right
      },

      close: () => {
        $cardTocLayout.style.animation = 'toc-close .2s'
        setTimeout(() => {
          $cardTocLayout.style.cssText = "opacity:''; animation: ''; right: ''"
        }, 100)
      }
    }
    document.getElementById('toc-mobile-btn').addEventListener('click', () => {
      if (window.getComputedStyle($cardTocLayout).getPropertyValue('opacity') === '0') mobileToc.open()
      else mobileToc.close()
    })

    $cardToc.addEventListener('click', (e) => {
      if (window.innerWidth < 992) { // 小于992px的时候
        mobileToc.close()
      }
    })
  }
</script>

<style>
  .is-position-fixed {
    position: sticky !important;
    top: 74px;
  }

  .toc-main ul {
    counter-reset: show-list;
  }

  .toc-main ul li::before {
    content: counter(item)".";
    display: block;
    position: absolute;
    left: 12px;
    top: 0;
  }
</style> 

<!-- 设置导航背景 -->
<script>
  let setHeaderClass = () => {
    const headerMenuTransparent = true;
    if (!headerMenuTransparent) { return; }
    const nav = $('#navHeader');
    const navTop = nav.outerHeight();
    const winTop = $(window).scrollTop();
    if(winTop > navTop) {
      nav.addClass('header-bg-color');
    }
    else {
      nav.removeClass('header-bg-color');
    }
  };

  let scrollCollect = () => {
    return bamboo.throttle(function (e) {
      setHeaderClass();
    }, 200)()
  }

  let initHeaderBg = () => {
    setHeaderClass();
  }

  setHeaderClass();
  window.addEventListener('scroll', scrollCollect);

  document.addEventListener('pjax:send', function () {
    window.removeEventListener('scroll', scrollCollect)
  })
  document.addEventListener('pjax:complete', function () {
    window.addEventListener('scroll', scrollCollect);
    setHeaderClass();
  })
</script> 

<!-- 渲染issues标签里的内容 -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('/js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- 输入框打字特效 -->
<!-- 输入框打字特效 -->

  <script src="/js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // 打开随机颜色特效
    POWERMODE.shake = false;    // 关闭输入框抖动
    document.body.addEventListener('input', POWERMODE);//监听打字事件
  </script>


<!-- markdown代码一键复制功能 -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.css">
  <script src="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="/js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = '复制';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fas fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
          }
        })

        function doSomething() {
          that.$notify({
            title: "成功",
            content: "代码已复制，请遵守相关授权协议。",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>
  

<!-- 图片懒加载 -->
<script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>


<!-- 卡片滚动动画 -->
   

<!-- 评论所需js -->

  
    <script type="text/javascript">
  var utteranceCommon = {};

  function check_utterance() {
    let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');
    if (isDark) {
      utteranceCommon.Theme = 'github-dark';
    } else {
      utteranceCommon.Theme = 'github-light';
    }

    return document.getElementById("gitment-container");
  }
  comment_el = '#gitment-container';
  load_utterance = function () {
    if ($(comment_el).length) {
      // 匿名函数，防止污染全局变量
      const HEAD = check_utterance();

      var utterances = document.createElement('script');
      utterances.type = 'text/javascript';
      utterances.async = true;
      utterances.setAttribute('issue-term', 'pathname')
      utterances.setAttribute('theme', utteranceCommon.Theme)
      utterances.setAttribute('repo', '')
      utterances.crossorigin = 'anonymous';
      utterances.src = 'https://utteranc.es/client.js';
      // content 是要插入评论的地方
      document.getElementById('gitment-container').appendChild(utterances);

    }
  }

  function dark_utterance() {
    const HEAD = check_utterance();
    if (!HEAD) return;
    const message = {
      type: 'set-theme',
      theme: utteranceCommon.Theme
    };
    const utteranceIframe = document.querySelector('iframe');
    utteranceIframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }

  $(document).ready(load_utterance);
  document.addEventListener('pjax:complete', function () {
    load_utterance();
  });

  $('.dark').click(function () {
    setTimeout(() => {
      dark_utterance();
    });
  })

</script>

<style>
  .utterances {
    max-width: inherit !important;
  }
</style>
  


<!-- 鼠标点击特效 -->
<!-- 爱心点击 -->

  
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 999; pointer-events: none;" ></canvas>
    <script src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script src="/js/cursor/explosion.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script>


    <!-- pjax -->
    

<!-- pjax -->


  <script src="/js/pjax@0.2.8/index.js"></script>
  
    <!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // 拦截正常带链接的 a 标签
      selectors: ["#pjax-container","title"],                                   // 根据实际需要确认重载区域
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // 刷新不从顶部开始
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })
  </script>



  </body>
</html>